import{Buffer as nt}from"https://registry.koishi.chat/modules/buffer/index.js";import it from"https://registry.koishi.chat/modules/process/index.js";import{Binary as Y,camelize as ft,defineProperty as D,hyphenate as ct,is as J,isNonNullable as G,isNullable as C,makeArray as lt}from"https://registry.koishi.chat/modules/cosmokit/index.js";var st=Object.defineProperty,at=Object.getOwnPropertyNames,o=(O,m)=>st(O,"name",{value:m,configurable:!0}),ot=(O,m)=>function(){return m||(0,O[at(O)[0]])((m={exports:{}}).exports,m),m.exports},pt=ot({"src/index.ts"(O,m){var k=Symbol.for("satori.element"),F=class{static{o(this,"ElementConstructor")}get data(){return this.attrs}getTagName(){return this.type==="component"?this.attrs.is?.name??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([n,p])=>C(p)?"":(n=ct(n),p===!0?` ${n}`:p===!1?` no-${n}`:` ${n}="${y.escape(""+p,!0)}"`)).join("")}toString(n=!1){if(this.type==="text"&&"content"in this.attrs)return n?this.attrs.content:y.escape(this.attrs.content);let p=this.children.map(x=>x.toString(n)).join("");if(n)return p;let d=this.toAttrString(),h=this.getTagName();return this.children.length?`<${h}${d}>${p}</${h}>`:`<${h}${d}/>`}};D(F,"name","Element"),D(F.prototype,k,!0);function y(n,...p){let d=Object.create(F.prototype),h={},x=[];if(p[0]&&typeof p[0]=="object"&&!y.isElement(p[0])&&!Array.isArray(p[0])){let S=p.shift();for(let[b,w]of Object.entries(S))C(w)||(b==="children"?p.push(...lt(w)):h[ft(b)]=w)}for(let S of p)x.push(...y.toElementArray(S));return typeof n=="function"&&(h.is=n,n="component"),Object.assign(d,{type:n,attrs:h,children:x})}o(y,"Element");var P=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(n=>{n.jsx=n,n.jsxs=n,n.jsxDEV=n,n.Fragment="template";function p(t){return t&&typeof t=="object"&&t[k]}n.isElement=p,o(p,"isElement");function d(t){if(typeof t=="string"||typeof t=="number"||typeof t=="boolean"){if(t=""+t,t)return n("text",{content:t})}else{if(p(t))return t;if(!C(t))throw new TypeError(`Invalid content: ${t}`)}}n.toElement=d,o(d,"toElement");function h(t){return Array.isArray(t)?t.map(d).filter(G):[d(t)].filter(G)}n.toElementArray=h,o(h,"toElementArray");function x(t,e){return typeof t=="string"?v(t,e):h(t)}n.normalize=x,o(x,"normalize");function S(t,e=!1){let r=(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e?r.replace(/"/g,"&quot;"):r}n.escape=S,o(S,"escape");function b(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(e,r)=>r==="38"?e:String.fromCharCode(+r)).replace(/&#x([0-9a-f]+);/gi,(e,r)=>r==="26"?e:String.fromCharCode(parseInt(r,16))).replace(/&(amp|#38|#x26);/g,"&")}n.unescape=b,o(b,"unescape");function w(t,e={}){let r=v(t);return e.caret?e.type&&r[0]?.type!==e.type?void 0:r[0]:N(r,e.type||"*")[0]}n.from=w,o(w,"from");let H=/ *([ >+~]) */g;function B(t){return t.split(",").map(e=>{let r=[];e=e.trim();let i,s=" ";for(;i=H.exec(e);)r.push({type:e.slice(0,i.index),combinator:s}),s=i[1],e=e.slice(i.index+i[0].length);return r.push({type:e,combinator:s}),r})}n.parseSelector=B,o(B,"parseSelector");function N(t,e){if(!t||!e)return[];if(typeof t=="string"&&(t=v(t)),typeof e=="string"&&(e=B(e)),!e.length)return[];let r=[],i=[];for(let[s,a]of t.entries()){let c=[],u=[...e,...r];r=[];let f=!1;for(let l of u){let{type:g,combinator:_}=l[0];(g===a.type||g==="*")&&(l.length===1?f=!0:[" ",">"].includes(l[1].combinator)?c.push(l.slice(1)):l[1].combinator==="+"?r.push(l.slice(1)):e.push(l.slice(1))),_===" "&&c.push(l)}f&&i.push(t[s]),i.push(...N(a.children,c))}return i}n.select=N,o(N,"select");function T(t,e){if(t=t.trim(),!/^[\w.]+$/.test(t))return P(t,e)??"";let r=e;for(let i of t.split("."))if(r=r[i],C(r))return"";return r??""}n.interpolate=T,o(T,"interpolate");let K=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,Q=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,X=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,Z=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=\{(?<curly>[^}]+)\})?/g,L;(t=>{t[t.OPEN=0]="OPEN",t[t.CLOSE=1]="CLOSE",t[t.EMPTY=2]="EMPTY",t[t.CONTINUE=3]="CONTINUE"})(L||(L={}));function v(t,e){let r=[];function i(f){f&&r.push(f)}o(i,"pushText");let s=e?Q:K,a,c=!0;for(;a=s.exec(t);){let{curly:f,comment:l,derivative:g}=a.groups,_=!f;u(t.slice(0,a.index),c,_),c=_,t=t.slice(a.index+a[0].length);let[E,,,q,tt,et,rt]=a;if(!l){if(f){let V="",W=2;g&&(V=g.slice(1),W={"@":2,"#":0,"/":1,":":3}[g[0]]),r.push({type:"curly",name:V,position:W,source:f,extra:f.slice(1+(g??"").length,-1)});continue}r.push({type:"angle",source:E,name:tt||n.Fragment,position:q?1:rt?2:0,extra:et})}}u(t,c,!0);function u(f,l,g){f=b(f),l&&(f=f.replace(/^\s*\n\s*/,"")),g&&(f=f.replace(/\s*\n\s*$/,"")),i(f)}return o(u,"parseContent"),A(M(r),e)}n.parse=v,o(v,"parse");function M(t){let e=[[{type:"angle",name:n.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function r(...i){let[s,a]=e[0];s.children[a].push(...i)}o(r,"pushToken");for(let i of t){if(typeof i=="string"){r(i);continue}let{name:s,position:a}=i;a===1?e[0][0].name===s&&e.shift():a===3?(e[0][0].children[s]=[],e[0][1]=s):a===0?(r(i),i.children={default:[]},e.unshift([i,"default"])):r(i)}return e[e.length-1][0].children.default}o(M,"foldTokens");function A(t,e){let r=[];for(let i of t)if(typeof i=="string")r.push(n("text",{content:i}));else if(i.type==="angle"){let s={},a=e?Z:X,c;for(;c=a.exec(i.extra);){let[,u,f,l=f,g]=c;g?s[u]=T(g,e):C(l)?u.startsWith("no-")?s[u.slice(3)]=!1:s[u]=!0:s[u]=b(l)}r.push(n(i.name,s,i.children&&A(i.children.default,e)))}else if(!i.name)r.push(...h(T(i.extra,e)));else if(i.name==="if")P(i.extra,e)?r.push(...A(i.children.default,e)):r.push(...A(i.children.else||[],e));else if(i.name==="each"){let[s,a]=i.extra.split(/\s+as\s+/),c=T(s,e);if(!c||!c[Symbol.iterator])continue;for(let u of c)r.push(...A(i.children.default,{...e,[a]:u}))}return r}o(A,"parseTokens");function R(t,e,r){let{type:i,attrs:s,children:a}=t;if(typeof e=="function")return e(t,r);{let c=e[typeof i=="string"?i:""]??e.default??!0;return typeof c=="function"&&(c=c(s,a,r)),c}}o(R,"visit");function z(t,e,r){let i=typeof t=="string"?v(t):t,s=[];return i.forEach(a=>{let{type:c,attrs:u,children:f}=a,l=R(a,e,r);l===!0?s.push(n(c,u,z(f,e,r))):l!==!1&&s.push(...h(l))}),typeof t=="string"?s.join(""):s}n.transform=z,o(z,"transform");async function I(t,e,r){let i=typeof t=="string"?v(t):t,s=(await Promise.all(i.map(async a=>{let{type:c,attrs:u,children:f}=a,l=await R(a,e,r);return l===!0?[n(c,u,await I(f,e,r))]:l!==!1?h(l):[]}))).flat(1);return typeof t=="string"?s.join(""):s}n.transformAsync=I,o(I,"transformAsync");function $(t,...e){return(...r)=>{let i=n(t);return e.forEach((s,a)=>{C(r[a])||(i.attrs[s]=r[a])}),r[e.length]&&Object.assign(i.attrs,r[e.length]),i}}o($,"createFactory"),n.warn=o(()=>{},"warn");function j(t){return(e,...r)=>{let i="base64://";return typeof r[0]=="string"&&(i=`data:${r.shift()};base64,`),J("Buffer",e)?e=i+e.toString("base64"):J("ArrayBuffer",e)?e=i+Y.toBase64(e):ArrayBuffer.isView(e)&&(e=i+Y.toBase64(e.buffer)),e.startsWith("base64://")&&(0,n.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),n(t,{...r[0],src:e})}}o(j,"createAssetFactory"),n.text=$("text","content"),n.at=$("at","id"),n.sharp=$("sharp","id"),n.quote=$("quote","id"),n.image=j("img"),n.img=j("img"),n.video=j("video"),n.audio=j("audio"),n.file=j("file");function U(t,e){return n("i18n",typeof t=="string"?{path:t}:t,e)}n.i18n=U,o(U,"i18n")})(y||(y={})),m.exports=y}}),mt=pt();export{mt as default};
