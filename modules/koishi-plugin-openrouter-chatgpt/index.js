var zs=Object.defineProperty;var to=Object.getOwnPropertyDescriptor;var ro=Object.getOwnPropertyNames;var no=Object.prototype.hasOwnProperty;var Qs=(t,e)=>()=>(t&&(e=t(t=0)),e);var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Pn=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ro(e))!no.call(t,s)&&s!==r&&zs(t,s,{get:()=>e[s],enumerable:!(n=to(e,s))||n.enumerable});return t},$t=(t,e,r)=>(Pn(t,e,"default"),r&&Pn(r,e,"default"));var so=t=>Pn(zs({},"__esModule",{value:!0}),t);import{Buffer as h}from"https://registry.koishi.chat/modules/buffer/index.js";import d from"https://registry.koishi.chat/modules/process/index.js";var o=Qs(()=>{});var rt={};import*as Vf from"https://registry.koishi.chat/modules/koishi/index.js";var Gs=Qs(()=>{o();$t(rt,Vf)});var Ys=m(Nt=>{"use strict";o();Object.defineProperty(Nt,"__esModule",{value:!0});Nt.VERSION=void 0;Nt.VERSION="4.68.4"});var Zs=m(w=>{"use strict";o();Object.defineProperty(w,"__esModule",{value:!0});w.setShims=w.isFsReadStream=w.fileFromPath=w.getDefaultAgent=w.getMultipartRequestOptions=w.ReadableStream=w.File=w.Blob=w.FormData=w.Headers=w.Response=w.Request=w.fetch=w.kind=w.auto=void 0;w.auto=!1;w.kind=void 0;w.fetch=void 0;w.Request=void 0;w.Response=void 0;w.Headers=void 0;w.FormData=void 0;w.Blob=void 0;w.File=void 0;w.ReadableStream=void 0;w.getMultipartRequestOptions=void 0;w.getDefaultAgent=void 0;w.fileFromPath=void 0;w.isFsReadStream=void 0;function io(t,e={auto:!1}){if(w.auto)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(w.kind)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${w.kind}'\``);w.auto=e.auto,w.kind=t.kind,w.fetch=t.fetch,w.Request=t.Request,w.Response=t.Response,w.Headers=t.Headers,w.FormData=t.FormData,w.Blob=t.Blob,w.File=t.File,w.ReadableStream=t.ReadableStream,w.getMultipartRequestOptions=t.getMultipartRequestOptions,w.getDefaultAgent=t.getDefaultAgent,w.fileFromPath=t.fileFromPath,w.isFsReadStream=t.isFsReadStream}w.setShims=io});var ks=m(xt=>{"use strict";o();Object.defineProperty(xt,"__esModule",{value:!0});xt.MultipartBody=void 0;var On=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};xt.MultipartBody=On});var ei=m(Lt=>{"use strict";o();Object.defineProperty(Lt,"__esModule",{value:!0});Lt.getRuntime=void 0;var ao=ks();function oo({manuallyImported:t}={}){let e=t?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",r,n,s,i;try{r=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:r,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,u)=>({...u,body:new ao.MultipartBody(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Lt.getRuntime=oo});var ti=m(Ye=>{"use strict";o();var uo=Ye&&Ye.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),co=Ye&&Ye.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&uo(e,t,r)};Object.defineProperty(Ye,"__esModule",{value:!0});co(ei(),Ye)});var Ot=m(ri=>{o();var Ut=Zs(),lo=ti();Ut.kind||Ut.setShims(lo.getRuntime(),{auto:!0});for(let t of Object.keys(Ut))Object.defineProperty(ri,t,{get(){return Ut[t]}})});var ni=m(Ht=>{"use strict";o();Object.defineProperty(Ht,"__esModule",{value:!0});Ht.LineDecoder=void 0;var vn=we(),vt=class t{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let r=this.decodeText(e);if(this.trailingCR&&(r="\r"+r,this.trailingCR=!1),r.endsWith("\r")&&(this.trailingCR=!0,r=r.slice(0,-1)),!r)return[];let n=t.NEWLINE_CHARS.has(r[r.length-1]||""),s=r.split(t.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof h<"u"){if(e instanceof h)return e.toString();if(e instanceof Uint8Array)return h.from(e).toString();throw new vn.OpenAIError(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new vn.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new vn.OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Ht.LineDecoder=vt;vt.NEWLINE_CHARS=new Set([`
`,"\r"]);vt.NEWLINE_REGEXP=/\r\n|[\n\r]/g});var Wt=m(Te=>{"use strict";o();Object.defineProperty(Te,"__esModule",{value:!0});Te.readableStreamAsyncIterable=Te._decodeChunks=Te._iterSSEMessages=Te.Stream=void 0;var fo=Ot(),ho=we(),Sn=ni(),si=we(),An=class t{constructor(e,r){this.iterator=e,this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of ii(e,r))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let u;try{u=JSON.parse(a.data)}catch(l){throw l}if(u&&u.error)throw new si.APIError(void 0,u.error,void 0,void 0);yield u}else{let u;try{u=JSON.parse(a.data)}catch(l){throw l}if(a.event=="error")throw new si.APIError(void 0,u.error,u.message,void 0);yield{event:a.event,data:u}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||r.abort()}}return new t(s,r)}static fromReadableStream(e,r){let n=!1;async function*s(){let a=new Sn.LineDecoder,u=En(e);for await(let l of u)for(let p of a.decode(l))yield p;for(let l of a.flush())yield l}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let u of s())a||u&&(yield JSON.parse(u));a=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{a||r.abort()}}return new t(i,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),r.push(a)}return i.shift()}});return[new t(()=>s(e),this.controller),new t(()=>s(r),this.controller)]}toReadableStream(){let e=this,r,n=new TextEncoder;return new fo.ReadableStream({async start(){r=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await r.next();if(a)return s.close();let u=n.encode(JSON.stringify(i)+`
`);s.enqueue(u)}catch(i){s.error(i)}},async cancel(){await r.return?.()}})}};Te.Stream=An;async function*ii(t,e){if(!t.body)throw e.abort(),new ho.OpenAIError("Attempted to iterate over a response with no body");let r=new Cn,n=new Sn.LineDecoder,s=En(t.body);for await(let i of po(s))for(let a of n.decode(i)){let u=r.decode(a);u&&(yield u)}for(let i of n.flush()){let a=r.decode(i);a&&(yield a)}}Te._iterSSEMessages=ii;async function*po(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=_o(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function _o(t){for(let n=0;n<t.length-2;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var Cn=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,s]=go(e,":");return s.startsWith(" ")&&(s=s.substring(1)),r==="event"?this.event=s:r==="data"&&this.data.push(s),null}};function mo(t){let e=new Sn.LineDecoder,r=[];for(let n of t)r.push(...e.decode(n));return r}Te._decodeChunks=mo;function go(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}function En(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Te.readableStreamAsyncIterable=En});var Jt=m(S=>{"use strict";o();Object.defineProperty(S,"__esModule",{value:!0});S.createForm=S.multipartFormRequestOptions=S.maybeMultipartFormRequestOptions=S.isMultipartBody=S.toFile=S.isUploadable=S.isBlobLike=S.isFileLike=S.isResponseLike=S.fileFromPath=void 0;var nt=Ot(),bo=Ot();Object.defineProperty(S,"fileFromPath",{enumerable:!0,get:function(){return bo.fileFromPath}});var yo=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";S.isResponseLike=yo;var wo=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&(0,S.isBlobLike)(t);S.isFileLike=wo;var Po=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function";S.isBlobLike=Po;var Oo=t=>(0,S.isFileLike)(t)||(0,S.isResponseLike)(t)||(0,nt.isFsReadStream)(t);S.isUploadable=Oo;async function ai(t,e,r){if(t=await t,(0,S.isFileLike)(t))return t;if((0,S.isResponseLike)(t)){let s=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=(0,S.isBlobLike)(s)?[await s.arrayBuffer()]:[s];return new nt.File(i,e,r)}let n=await vo(t);if(e||(e=Co(t)??"unknown_file"),!r?.type){let s=n[0]?.type;typeof s=="string"&&(r={...r,type:s})}return new nt.File(n,e,r)}S.toFile=ai;async function vo(t){let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if((0,S.isBlobLike)(t))e.push(await t.arrayBuffer());else if(So(t))for await(let r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${t?.constructor?.name}; props: ${Ao(t)}`);return e}function Ao(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}function Co(t){return Rn(t.name)||Rn(t.filename)||Rn(t.path)?.split(/[\\/]/).pop()}var Rn=t=>{if(typeof t=="string")return t;if(typeof h<"u"&&t instanceof h)return String(t)},So=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Eo=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";S.isMultipartBody=Eo;var Ro=async t=>{if(!In(t.body))return t;let e=await(0,S.createForm)(t.body);return(0,nt.getMultipartRequestOptions)(e,t)};S.maybeMultipartFormRequestOptions=Ro;var Io=async t=>{let e=await(0,S.createForm)(t.body);return(0,nt.getMultipartRequestOptions)(e,t)};S.multipartFormRequestOptions=Io;var Mo=async t=>{let e=new nt.FormData;return await Promise.all(Object.entries(t||{}).map(([r,n])=>Mn(e,r,n))),e};S.createForm=Mo;var In=t=>{if((0,S.isUploadable)(t))return!0;if(Array.isArray(t))return t.some(In);if(t&&typeof t=="object"){for(let e in t)if(In(t[e]))return!0}return!1},Mn=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if((0,S.isUploadable)(r)){let n=await ai(r);t.append(e,n)}else if(Array.isArray(r))await Promise.all(r.map(n=>Mn(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,s])=>Mn(t,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}}});var F=m(f=>{"use strict";o();var jo=f&&f.__classPrivateFieldSet||function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Fo=f&&f.__classPrivateFieldGet||function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Vt;Object.defineProperty(f,"__esModule",{value:!0});f.isObj=f.toBase64=f.getHeader=f.getRequiredHeader=f.isHeadersProtocol=f.isRunningInBrowser=f.debug=f.hasOwn=f.isEmptyObj=f.maybeCoerceBoolean=f.maybeCoerceFloat=f.maybeCoerceInteger=f.coerceBoolean=f.coerceFloat=f.coerceInteger=f.readEnv=f.ensurePresent=f.castToError=f.sleep=f.safeJSON=f.isRequestOptions=f.createResponseHeaders=f.PagePromise=f.AbstractPage=f.APIClient=f.APIPromise=f.createForm=f.multipartFormRequestOptions=f.maybeMultipartFormRequestOptions=void 0;var st=Ys(),qo=Wt(),_e=we(),jn=Ot(),Fn=Jt(),Dn=Jt();Object.defineProperty(f,"maybeMultipartFormRequestOptions",{enumerable:!0,get:function(){return Dn.maybeMultipartFormRequestOptions}});Object.defineProperty(f,"multipartFormRequestOptions",{enumerable:!0,get:function(){return Dn.multipartFormRequestOptions}});Object.defineProperty(f,"createForm",{enumerable:!0,get:function(){return Dn.createForm}});async function fi(t){let{response:e}=t;if(t.options.stream)return Ze("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):qo.Stream.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let r=e.headers.get("content-type");if(r?.includes("application/json")||r?.includes("application/vnd.api+json")){let i=await e.json();return Ze("response",e.status,e.url,e.headers,i),di(i,e)}let s=await e.text();return Ze("response",e.status,e.url,e.headers,s),s}function di(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var At=class t extends Promise{constructor(e,r=fi){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new t(this.responsePromise,async r=>di(e(await this.parseResponse(r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};f.APIPromise=At;var Tn=class{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=qn("maxRetries",r),this.timeout=qn("timeout",n),this.httpAgent=s,this.fetch=i??jn.fetch}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...xo(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${ko()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async s=>{let i=s&&(0,Fn.isBlobLike)(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:r,...s,body:i}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof h<"u")return h.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:r=0}={}){let{method:n,path:s,query:i,headers:a={}}=e,u=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:(0,Fn.isMultipartBody)(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(u),p=this.buildURL(s,i);"timeout"in e&&qn("timeout",e.timeout);let v=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??(0,jn.getDefaultAgent)(p),g=v+1e3;typeof c?.options?.timeout=="number"&&g>(c.options.timeout??0)&&(c.options.timeout=g),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let _=this.buildHeaders({options:e,headers:a,contentLength:l,retryCount:r});return{req:{method:n,...u&&{body:u},headers:_,...c&&{agent:c},signal:e.signal??null},url:p,timeout:v}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:s}){let i={};n&&(i["content-length"]=n);let a=this.defaultHeaders(e);return li(i,a),li(i,r),(0,Fn.isMultipartBody)(e.body)&&jn.kind!=="node"&&delete i["content-type"],(0,f.getHeader)(a,"x-stainless-retry-count")===void 0&&(0,f.getHeader)(r,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,r),i}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,s){return _e.APIError.generate(e,r,n,s)}request(e,r=null){return new At(this.makeRequest(e,r))}async makeRequest(e,r){let n=await e,s=n.maxRetries??this.maxRetries;r==null&&(r=s),await this.prepareOptions(n);let{req:i,url:a,timeout:u}=this.buildRequest(n,{retryCount:s-r});if(await this.prepareRequest(i,{url:a,options:n}),Ze("request",a,n,i.headers),n.signal?.aborted)throw new _e.APIUserAbortError;let l=new AbortController,p=await this.fetchWithTimeout(a,i,u,l).catch(f.castToError);if(p instanceof Error){if(n.signal?.aborted)throw new _e.APIUserAbortError;if(r)return this.retryRequest(n,r);throw p.name==="AbortError"?new _e.APIConnectionTimeoutError:new _e.APIConnectionError({cause:p})}let v=(0,f.createResponseHeaders)(p.headers);if(!p.ok){if(r&&this.shouldRetry(p)){let D=`retrying, ${r} attempts remaining`;return Ze(`response (error; ${D})`,p.status,a,v),this.retryRequest(n,r,v)}let c=await p.text().catch(D=>(0,f.castToError)(D).message),g=(0,f.safeJSON)(c),_=g?void 0:c;throw Ze(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,p.status,a,v,_),this.makeStatusError(p.status,g,_,v)}return{response:p,options:n,controller:l}}requestAPIList(e,r){let n=this.makeRequest(r,null);return new Xt(this,n,e)}buildURL(e,r){let n=Ho(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return $n(s)||(r={...s,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new _e.OpenAIError(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,s){let{signal:i,...a}=r||{};i&&i.addEventListener("abort",()=>s.abort());let u=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(u)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let s,i=n?.["retry-after-ms"];if(i){let u=parseFloat(i);Number.isNaN(u)||(s=u)}let a=n?.["retry-after"];if(a&&!s){let u=parseFloat(a);Number.isNaN(u)?s=Date.parse(a)-Date.now():s=u*1e3}if(!(s&&0<=s&&s<60*1e3)){let u=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,u)}return await(0,f.sleep)(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){let i=r-e,a=Math.min(.5*Math.pow(2,i),8),u=1-Math.random()*.25;return a*u*1e3}getUserAgent(){return`${this.constructor.name}/JS ${st.VERSION}`}};f.APIClient=Tn;var Bn=class{constructor(e,r,n,s){Vt.set(this,void 0),jo(this,Vt,e,"f"),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new _e.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){let n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(let[s,i]of n)e.url.searchParams.set(s,i);r.query=void 0,r.path=e.url.toString()}return await Fo(this,Vt,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Vt=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}};f.AbstractPage=Bn;var Xt=class extends At{constructor(e,r,n){super(r,async s=>new n(e,s.response,await fi(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}};f.PagePromise=Xt;var To=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){let n=r.toString();return e[n.toLowerCase()]||e[n]}});f.createResponseHeaders=To;var Bo={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Do=t=>typeof t=="object"&&t!==null&&!$n(t)&&Object.keys(t).every(e=>Nn(Bo,e));f.isRequestOptions=Do;var $o=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st.VERSION,"X-Stainless-OS":ui(Deno.build.os),"X-Stainless-Arch":oi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":d.version};if(Object.prototype.toString.call(typeof d<"u"?d:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st.VERSION,"X-Stainless-OS":ui(d.platform),"X-Stainless-Arch":oi(d.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":d.version};let t=No();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":st.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function No(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var oi=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",ui=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),ci,xo=()=>ci??(ci=$o()),Lo=t=>{try{return JSON.parse(t)}catch{return}};f.safeJSON=Lo;var Uo=new RegExp("^(?:[a-z]+:)?//","i"),Ho=t=>Uo.test(t),Wo=t=>new Promise(e=>setTimeout(e,t));f.sleep=Wo;var qn=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new _e.OpenAIError(`${t} must be an integer`);if(e<0)throw new _e.OpenAIError(`${t} must be a positive integer`);return e},Jo=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)};f.castToError=Jo;var Vo=t=>{if(t==null)throw new _e.OpenAIError(`Expected a value to be given but received ${t} instead.`);return t};f.ensurePresent=Vo;var Xo=t=>{if(typeof d<"u")return d.env?.[t]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(t)?.trim()};f.readEnv=Xo;var Ko=t=>{if(typeof t=="number")return Math.round(t);if(typeof t=="string")return parseInt(t,10);throw new _e.OpenAIError(`Could not coerce ${t} (type: ${typeof t}) into a number`)};f.coerceInteger=Ko;var zo=t=>{if(typeof t=="number")return t;if(typeof t=="string")return parseFloat(t);throw new _e.OpenAIError(`Could not coerce ${t} (type: ${typeof t}) into a number`)};f.coerceFloat=zo;var Qo=t=>typeof t=="boolean"?t:typeof t=="string"?t==="true":!!t;f.coerceBoolean=Qo;var Go=t=>{if(t!==void 0)return(0,f.coerceInteger)(t)};f.maybeCoerceInteger=Go;var Yo=t=>{if(t!==void 0)return(0,f.coerceFloat)(t)};f.maybeCoerceFloat=Yo;var Zo=t=>{if(t!==void 0)return(0,f.coerceBoolean)(t)};f.maybeCoerceBoolean=Zo;function $n(t){if(!t)return!0;for(let e in t)return!1;return!0}f.isEmptyObj=$n;function Nn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}f.hasOwn=Nn;function li(t,e){for(let r in e){if(!Nn(e,r))continue;let n=r.toLowerCase();if(!n)continue;let s=e[r];s===null?delete t[n]:s!==void 0&&(t[n]=s)}}function Ze(t,...e){typeof d<"u"&&d?.env?.DEBUG}f.debug=Ze;var ko=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),eu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";f.isRunningInBrowser=eu;var tu=t=>typeof t?.get=="function";f.isHeadersProtocol=tu;var ru=(t,e)=>{let r=(0,f.getHeader)(t,e);if(r===void 0)throw new Error(`Could not find ${e} header`);return r};f.getRequiredHeader=ru;var nu=(t,e)=>{let r=e.toLowerCase();if((0,f.isHeadersProtocol)(t)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,i,a)=>i+a.toUpperCase());for(let s of[e,r,e.toUpperCase(),n]){let i=t.get(s);if(i)return i}}for(let[n,s]of Object.entries(t))if(n.toLowerCase()===r)return Array.isArray(s)?(s.length<=1,s[0]):s};f.getHeader=nu;var su=t=>{if(!t)return"";if(typeof h<"u")return h.from(t).toString("base64");if(typeof btoa<"u")return btoa(t);throw new _e.OpenAIError("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")};f.toBase64=su;function iu(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}f.isObj=iu});var we=m(E=>{"use strict";o();Object.defineProperty(E,"__esModule",{value:!0});E.ContentFilterFinishReasonError=E.LengthFinishReasonError=E.InternalServerError=E.RateLimitError=E.UnprocessableEntityError=E.ConflictError=E.NotFoundError=E.PermissionDeniedError=E.AuthenticationError=E.BadRequestError=E.APIConnectionTimeoutError=E.APIConnectionError=E.APIUserAbortError=E.APIError=E.OpenAIError=void 0;var au=F(),it=class extends Error{};E.OpenAIError=it;var me=class t extends it{constructor(e,r,n,s){super(`${t.makeMessage(e,r,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"];let i=r;this.error=i,this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,r,n){let s=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,r,n,s){if(!e)return new Ct({message:n,cause:(0,au.castToError)(r)});let i=r?.error;return e===400?new Kt(e,i,n,s):e===401?new zt(e,i,n,s):e===403?new Qt(e,i,n,s):e===404?new Gt(e,i,n,s):e===409?new Yt(e,i,n,s):e===422?new Zt(e,i,n,s):e===429?new kt(e,i,n,s):e>=500?new er(e,i,n,s):new t(e,i,n,s)}};E.APIError=me;var xn=class extends me{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}};E.APIUserAbortError=xn;var Ct=class extends me{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,r&&(this.cause=r)}};E.APIConnectionError=Ct;var Ln=class extends Ct{constructor({message:e}={}){super({message:e??"Request timed out."})}};E.APIConnectionTimeoutError=Ln;var Kt=class extends me{constructor(){super(...arguments),this.status=400}};E.BadRequestError=Kt;var zt=class extends me{constructor(){super(...arguments),this.status=401}};E.AuthenticationError=zt;var Qt=class extends me{constructor(){super(...arguments),this.status=403}};E.PermissionDeniedError=Qt;var Gt=class extends me{constructor(){super(...arguments),this.status=404}};E.NotFoundError=Gt;var Yt=class extends me{constructor(){super(...arguments),this.status=409}};E.ConflictError=Yt;var Zt=class extends me{constructor(){super(...arguments),this.status=422}};E.UnprocessableEntityError=Zt;var kt=class extends me{constructor(){super(...arguments),this.status=429}};E.RateLimitError=kt;var er=class extends me{};E.InternalServerError=er;var Un=class extends it{constructor(){super("Could not parse response content as the length limit was reached")}};E.LengthFinishReasonError=Un;var Hn=class extends it{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};E.ContentFilterFinishReasonError=Hn});var tr=m(Be=>{"use strict";o();Object.defineProperty(Be,"__esModule",{value:!0});Be.RFC3986=Be.RFC1738=Be.formatters=Be.default_format=void 0;Be.default_format="RFC3986";Be.formatters={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)};Be.RFC1738="RFC1738";Be.RFC3986="RFC3986"});var hi=m(N=>{"use strict";o();Object.defineProperty(N,"__esModule",{value:!0});N.maybe_map=N.combine=N.is_buffer=N.is_regexp=N.compact=N.encode=N.decode=N.assign_single_source=N.merge=void 0;var ou=tr(),Wn=Object.prototype.hasOwnProperty,ke=Array.isArray,De=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();function uu(t){for(;t.length>1;){let e=t.pop();if(!e)continue;let r=e.obj[e.prop];if(ke(r)){let n=[];for(let s=0;s<r.length;++s)typeof r[s]<"u"&&n.push(r[s]);e.obj[e.prop]=n}}}function cu(t,e){let r=e&&e.plainObjects?Object.create(null):{};for(let n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r}function Vn(t,e,r={}){if(!e)return t;if(typeof e!="object"){if(ke(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Wn.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);let n=t;return ke(t)&&!ke(e)&&(n=cu(t,r)),ke(t)&&ke(e)?(e.forEach(function(s,i){if(Wn.call(t,i)){let a=t[i];a&&typeof a=="object"&&s&&typeof s=="object"?t[i]=Vn(a,s,r):t.push(s)}else t[i]=s}),t):Object.keys(e).reduce(function(s,i){let a=e[i];return Wn.call(s,i)?s[i]=Vn(s[i],a,r):s[i]=a,s},n)}N.merge=Vn;function lu(t,e){return Object.keys(e).reduce(function(r,n){return r[n]=e[n],r},t)}N.assign_single_source=lu;function fu(t,e,r){let n=t.replace(/\+/g," ");if(r==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}}N.decode=fu;var Jn=1024,du=(t,e,r,n,s)=>{if(t.length===0)return t;let i=t;if(typeof t=="symbol"?i=Symbol.prototype.toString.call(t):typeof t!="string"&&(i=String(t)),r==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});let a="";for(let u=0;u<i.length;u+=Jn){let l=i.length>=Jn?i.slice(u,u+Jn):i,p=[];for(let v=0;v<l.length;++v){let c=l.charCodeAt(v);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||s===ou.RFC1738&&(c===40||c===41)){p[p.length]=l.charAt(v);continue}if(c<128){p[p.length]=De[c];continue}if(c<2048){p[p.length]=De[192|c>>6]+De[128|c&63];continue}if(c<55296||c>=57344){p[p.length]=De[224|c>>12]+De[128|c>>6&63]+De[128|c&63];continue}v+=1,c=65536+((c&1023)<<10|l.charCodeAt(v)&1023),p[p.length]=De[240|c>>18]+De[128|c>>12&63]+De[128|c>>6&63]+De[128|c&63]}a+=p.join("")}return a};N.encode=du;function hu(t){let e=[{obj:{o:t},prop:"o"}],r=[];for(let n=0;n<e.length;++n){let s=e[n],i=s.obj[s.prop],a=Object.keys(i);for(let u=0;u<a.length;++u){let l=a[u],p=i[l];typeof p=="object"&&p!==null&&r.indexOf(p)===-1&&(e.push({obj:i,prop:l}),r.push(p))}}return uu(e),t}N.compact=hu;function pu(t){return Object.prototype.toString.call(t)==="[object RegExp]"}N.is_regexp=pu;function _u(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}N.is_buffer=_u;function mu(t,e){return[].concat(t,e)}N.combine=mu;function gu(t,e){if(ke(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}N.maybe_map=gu});var gi=m(nr=>{"use strict";o();Object.defineProperty(nr,"__esModule",{value:!0});nr.stringify=void 0;var rr=hi(),at=tr(),bu=Object.prototype.hasOwnProperty,pi={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},$e=Array.isArray,yu=Array.prototype.push,_i=function(t,e){yu.apply(t,$e(e)?e:[e])},wu=Date.prototype.toISOString,H={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:rr.encode,encodeValuesOnly:!1,format:at.default_format,formatter:at.formatters[at.default_format],indices:!1,serializeDate(t){return wu.call(t)},skipNulls:!1,strictNullHandling:!1};function Pu(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var Xn={};function mi(t,e,r,n,s,i,a,u,l,p,v,c,g,_,R,y,D,L){let P=t,z=L,B=0,J=!1;for(;(z=z.get(Xn))!==void 0&&!J;){let $=z.get(t);if(B+=1,typeof $<"u"){if($===B)throw new RangeError("Cyclic object value");J=!0}typeof z.get(Xn)>"u"&&(B=0)}if(typeof p=="function"?P=p(e,P):P instanceof Date?P=g?.(P):r==="comma"&&$e(P)&&(P=(0,rr.maybe_map)(P,function($){return $ instanceof Date?g?.($):$})),P===null){if(i)return l&&!y?l(e,H.encoder,D,"key",_):e;P=""}if(Pu(P)||(0,rr.is_buffer)(P)){if(l){let $=y?e:l(e,H.encoder,D,"key",_);return[R?.($)+"="+R?.(l(P,H.encoder,D,"value",_))]}return[R?.(e)+"="+R?.(String(P))]}let Y=[];if(typeof P>"u")return Y;let Z;if(r==="comma"&&$e(P))y&&l&&(P=(0,rr.maybe_map)(P,l)),Z=[{value:P.length>0?P.join(",")||null:void 0}];else if($e(p))Z=p;else{let $=Object.keys(P);Z=v?$.sort(v):$}let V=u?String(e).replace(/\./g,"%2E"):String(e),X=n&&$e(P)&&P.length===1?V+"[]":V;if(s&&$e(P)&&P.length===0)return X+"[]";for(let $=0;$<Z.length;++$){let U=Z[$],Xs=typeof U=="object"&&typeof U.value<"u"?U.value:P[U];if(a&&Xs===null)continue;let wn=c&&u?U.replace(/\./g,"%2E"):U,eo=$e(P)?typeof r=="function"?r(X,wn):X:X+(c?"."+wn:"["+wn+"]");L.set(t,B);let Ks=new WeakMap;Ks.set(Xn,L),_i(Y,mi(Xs,eo,r,n,s,i,a,u,r==="comma"&&y&&$e(P)?null:l,p,v,c,g,_,R,y,D,Ks))}return Y}function Ou(t=H){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||H.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=at.default_format;if(typeof t.format<"u"){if(!bu.call(at.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=at.formatters[r],s=H.filter;(typeof t.filter=="function"||$e(t.filter))&&(s=t.filter);let i;if(t.arrayFormat&&t.arrayFormat in pi?i=t.arrayFormat:"indices"in t?i=t.indices?"indices":"repeat":i=H.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:H.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:H.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:H.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:H.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?H.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:H.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:H.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:H.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:H.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:H.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:H.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:H.strictNullHandling}}function vu(t,e={}){let r=t,n=Ou(e),s,i;typeof n.filter=="function"?(i=n.filter,r=i("",r)):$e(n.filter)&&(i=n.filter,s=i);let a=[];if(typeof r!="object"||r===null)return"";let u=pi[n.arrayFormat],l=u==="comma"&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);let p=new WeakMap;for(let g=0;g<s.length;++g){let _=s[g];n.skipNulls&&r[_]===null||_i(a,mi(r[_],_,u,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,p))}let v=a.join(n.delimiter),c=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),v.length>0?c+v:""}nr.stringify=vu});var bi=m(ot=>{"use strict";o();Object.defineProperty(ot,"__esModule",{value:!0});ot.formats=ot.stringify=void 0;var sr=tr(),Au={formatters:sr.formatters,RFC1738:sr.RFC1738,RFC3986:sr.RFC3986,default:sr.default_format};ot.formats=Au;var Cu=gi();Object.defineProperty(ot,"stringify",{enumerable:!0,get:function(){return Cu.stringify}})});var ge=m(ut=>{"use strict";o();Object.defineProperty(ut,"__esModule",{value:!0});ut.CursorPage=ut.Page=void 0;var yi=F(),Kn=class extends yi.AbstractPage{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};ut.Page=Kn;var zn=class extends yi.AbstractPage{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let r=Object.fromEntries(e.url.searchParams);return Object.keys(r).length?r:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let r=e[e.length-1]?.id;return r?{params:{after:r}}:null}};ut.CursorPage=zn});var I=m(ir=>{"use strict";o();Object.defineProperty(ir,"__esModule",{value:!0});ir.APIResource=void 0;var Qn=class{constructor(e){this._client=e}};ir.APIResource=Qn});var Gn=m(ct=>{"use strict";o();Object.defineProperty(ct,"__esModule",{value:!0});ct.Completions=void 0;var Su=I(),ar=class extends Su.APIResource{create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}};ct.Completions=ar;ar=ct.Completions||(ct.Completions={})});var Pi=m(Pe=>{"use strict";o();var Eu=Pe&&Pe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ru=Pe&&Pe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Iu=Pe&&Pe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Eu(e,t,r);return Ru(e,t),e};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.Chat=void 0;var Mu=I(),wi=Iu(Gn()),or=class extends Mu.APIResource{constructor(){super(...arguments),this.completions=new wi.Completions(this._client)}};Pe.Chat=or;(function(t){t.Completions=wi.Completions})(or=Pe.Chat||(Pe.Chat={}))});var Oi=m(lt=>{"use strict";o();Object.defineProperty(lt,"__esModule",{value:!0});lt.Chat=lt.Completions=void 0;var ju=Gn();Object.defineProperty(lt,"Completions",{enumerable:!0,get:function(){return ju.Completions}});var Fu=Pi();Object.defineProperty(lt,"Chat",{enumerable:!0,get:function(){return Fu.Chat}})});var Ai=m(vi=>{"use strict";o();Object.defineProperty(vi,"__esModule",{value:!0})});var Ci=m(ft=>{"use strict";o();Object.defineProperty(ft,"__esModule",{value:!0});ft.Speech=void 0;var qu=I(),ur=class extends qu.APIResource{create(e,r){return this._client.post("/audio/speech",{body:e,...r,__binaryResponse:!0})}};ft.Speech=ur;ur=ft.Speech||(ft.Speech={})});var Si=m(Oe=>{"use strict";o();var Tu=Oe&&Oe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Bu=Oe&&Oe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Du=Oe&&Oe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Tu(e,t,r);return Bu(e,t),e};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Transcriptions=void 0;var $u=I(),Nu=Du(F()),cr=class extends $u.APIResource{create(e,r){return this._client.post("/audio/transcriptions",Nu.multipartFormRequestOptions({body:e,...r}))}};Oe.Transcriptions=cr;cr=Oe.Transcriptions||(Oe.Transcriptions={})});var Ei=m(ve=>{"use strict";o();var xu=ve&&ve.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Lu=ve&&ve.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Uu=ve&&ve.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&xu(e,t,r);return Lu(e,t),e};Object.defineProperty(ve,"__esModule",{value:!0});ve.Translations=void 0;var Hu=I(),Wu=Uu(F()),lr=class extends Hu.APIResource{create(e,r){return this._client.post("/audio/translations",Wu.multipartFormRequestOptions({body:e,...r}))}};ve.Translations=lr;lr=ve.Translations||(ve.Translations={})});var ji=m(Ae=>{"use strict";o();var Ju=Ae&&Ae.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Vu=Ae&&Ae.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Yn=Ae&&Ae.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Ju(e,t,r);return Vu(e,t),e};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.Audio=void 0;var Xu=I(),Ri=Yn(Ci()),Ii=Yn(Si()),Mi=Yn(Ei()),fr=class extends Xu.APIResource{constructor(){super(...arguments),this.transcriptions=new Ii.Transcriptions(this._client),this.translations=new Mi.Translations(this._client),this.speech=new Ri.Speech(this._client)}};Ae.Audio=fr;(function(t){t.Transcriptions=Ii.Transcriptions,t.Translations=Mi.Translations,t.Speech=Ri.Speech})(fr=Ae.Audio||(Ae.Audio={}))});var Zn=m(te=>{"use strict";o();var Ku=te&&te.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),zu=te&&te.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Qu=te&&te.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Ku(e,t,r);return zu(e,t),e};Object.defineProperty(te,"__esModule",{value:!0});te.BatchesPage=te.Batches=void 0;var Gu=I(),Yu=F(),Zu=Qu(Zn()),ku=ge(),dr=class extends Gu.APIResource{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(`/batches/${e}`,r)}list(e={},r){return(0,Yu.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/batches",hr,{query:e,...r})}cancel(e,r){return this._client.post(`/batches/${e}/cancel`,r)}};te.Batches=dr;var hr=class extends ku.CursorPage{};te.BatchesPage=hr;(function(t){t.BatchesPage=Zu.BatchesPage})(dr=te.Batches||(te.Batches={}))});var kn=m(re=>{"use strict";o();var ec=re&&re.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),tc=re&&re.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),rc=re&&re.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ec(e,t,r);return tc(e,t),e};Object.defineProperty(re,"__esModule",{value:!0});re.AssistantsPage=re.Assistants=void 0;var nc=I(),sc=F(),ic=rc(kn()),ac=ge(),pr=class extends nc.APIResource{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/assistants/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},r){return(0,sc.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/assistants",_r,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,r){return this._client.delete(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}};re.Assistants=pr;var _r=class extends ac.CursorPage{};re.AssistantsPage=_r;(function(t){t.AssistantsPage=ic.AssistantsPage})(pr=re.Assistants||(re.Assistants={}))});var rs=m(Je=>{"use strict";o();Object.defineProperty(Je,"__esModule",{value:!0});Je.ParsingToolFunction=Je.ParsingFunction=Je.isRunnableFunctionWithParse=void 0;function oc(t){return typeof t.parse=="function"}Je.isRunnableFunctionWithParse=oc;var es=class{constructor(e){this.function=e.function,this.parse=e.parse,this.parameters=e.parameters,this.description=e.description,this.name=e.name}};Je.ParsingFunction=es;var ts=class{constructor(e){this.type="function",this.function=e}};Je.ParsingToolFunction=ts});var ns=m(Ne=>{"use strict";o();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.isPresent=Ne.isToolMessage=Ne.isFunctionMessage=Ne.isAssistantMessage=void 0;var uc=t=>t?.role==="assistant";Ne.isAssistantMessage=uc;var cc=t=>t?.role==="function";Ne.isFunctionMessage=cc;var lc=t=>t?.role==="tool";Ne.isToolMessage=lc;function fc(t){return t!=null}Ne.isPresent=fc});var as=m(Ve=>{"use strict";o();var Fe=Ve&&Ve.__classPrivateFieldSet||function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},T=Ve&&Ve.__classPrivateFieldGet||function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},ss,mr,gr,Et,Rt,br,It,Ue,Mt,yr,wr,dt,Fi;Object.defineProperty(Ve,"__esModule",{value:!0});Ve.EventStream=void 0;var St=we(),is=class{constructor(){ss.add(this),this.controller=new AbortController,mr.set(this,void 0),gr.set(this,()=>{}),Et.set(this,()=>{}),Rt.set(this,void 0),br.set(this,()=>{}),It.set(this,()=>{}),Ue.set(this,{}),Mt.set(this,!1),yr.set(this,!1),wr.set(this,!1),dt.set(this,!1),Fe(this,mr,new Promise((e,r)=>{Fe(this,gr,e,"f"),Fe(this,Et,r,"f")}),"f"),Fe(this,Rt,new Promise((e,r)=>{Fe(this,br,e,"f"),Fe(this,It,r,"f")}),"f"),T(this,mr,"f").catch(()=>{}),T(this,Rt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},T(this,ss,"m",Fi).bind(this))},0)}_connected(){this.ended||(T(this,gr,"f").call(this),this._emit("connect"))}get ended(){return T(this,Mt,"f")}get errored(){return T(this,yr,"f")}get aborted(){return T(this,wr,"f")}abort(){this.controller.abort()}on(e,r){return(T(this,Ue,"f")[e]||(T(this,Ue,"f")[e]=[])).push({listener:r}),this}off(e,r){let n=T(this,Ue,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===r);return s>=0&&n.splice(s,1),this}once(e,r){return(T(this,Ue,"f")[e]||(T(this,Ue,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{Fe(this,dt,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){Fe(this,dt,!0,"f"),await T(this,Rt,"f")}_emit(e,...r){if(T(this,Mt,"f"))return;e==="end"&&(Fe(this,Mt,!0,"f"),T(this,br,"f").call(this));let n=T(this,Ue,"f")[e];if(n&&(T(this,Ue,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...r))),e==="abort"){let s=r[0];!T(this,dt,"f")&&!n?.length&&Promise.reject(s),T(this,Et,"f").call(this,s),T(this,It,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=r[0];!T(this,dt,"f")&&!n?.length&&Promise.reject(s),T(this,Et,"f").call(this,s),T(this,It,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Ve.EventStream=is;mr=new WeakMap,gr=new WeakMap,Et=new WeakMap,Rt=new WeakMap,br=new WeakMap,It=new WeakMap,Ue=new WeakMap,Mt=new WeakMap,yr=new WeakMap,wr=new WeakMap,dt=new WeakMap,ss=new WeakSet,Fi=function(e){if(Fe(this,yr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new St.APIUserAbortError),e instanceof St.APIUserAbortError)return Fe(this,wr,!0,"f"),this._emit("abort",e);if(e instanceof St.OpenAIError)return this._emit("error",e);if(e instanceof Error){let r=new St.OpenAIError(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new St.OpenAIError(String(e)))}});var vr=m(x=>{"use strict";o();Object.defineProperty(x,"__esModule",{value:!0});x.validateInputTools=x.hasAutoParseableInput=x.shouldParseToolCall=x.parseChatCompletion=x.maybeParseChatCompletion=x.isAutoParsableTool=x.makeParseableTool=x.isAutoParsableResponseFormat=x.makeParseableResponseFormat=void 0;var Pr=we();function dc(t,e){let r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),r}x.makeParseableResponseFormat=dc;function qi(t){return t?.$brand==="auto-parseable-response-format"}x.isAutoParsableResponseFormat=qi;function hc(t,{parser:e,callback:r}){let n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:r,enumerable:!1}}),n}x.makeParseableTool=hc;function Or(t){return t?.$brand==="auto-parseable-tool"}x.isAutoParsableTool=Or;function pc(t,e){return!e||!Bi(e)?{...t,choices:t.choices.map(r=>({...r,message:{...r.message,parsed:null,tool_calls:r.message.tool_calls??[]}}))}:Ti(t,e)}x.maybeParseChatCompletion=pc;function Ti(t,e){let r=t.choices.map(n=>{if(n.finish_reason==="length")throw new Pr.LengthFinishReasonError;if(n.finish_reason==="content_filter")throw new Pr.ContentFilterFinishReasonError;return{...n,message:{...n.message,tool_calls:n.message.tool_calls?.map(s=>mc(e,s))??[],parsed:n.message.content&&!n.message.refusal?_c(e,n.message.content):null}}});return{...t,choices:r}}x.parseChatCompletion=Ti;function _c(t,e){return t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function mc(t,e){let r=t.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Or(r)?r.$parseRaw(e.function.arguments):r?.function.strict?JSON.parse(e.function.arguments):null}}}function gc(t,e){if(!t)return!1;let r=t.tools?.find(n=>n.function?.name===e.function.name);return Or(r)||r?.function.strict||!1}x.shouldParseToolCall=gc;function Bi(t){return qi(t.response_format)?!0:t.tools?.some(e=>Or(e)||e.type==="function"&&e.function.strict===!0)??!1}x.hasAutoParseableInput=Bi;function bc(t){for(let e of t??[]){if(e.type!=="function")throw new Pr.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Pr.OpenAIError(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}x.validateInputTools=bc});var hs=m(pt=>{"use strict";o();var ne=pt&&pt.__classPrivateFieldGet||function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},k,os,Ar,us,cs,ls,xi,fs;Object.defineProperty(pt,"__esModule",{value:!0});pt.AbstractChatCompletionRunner=void 0;var ht=we(),Di=rs(),He=ns(),yc=as(),$i=vr(),Ni=10,ds=class extends yc.EventStream{constructor(){super(...arguments),k.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let r=e.choices[0]?.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),((0,He.isFunctionMessage)(e)||(0,He.isToolMessage)(e))&&e.content)this._emit("functionCallResult",e.content);else if((0,He.isAssistantMessage)(e)&&e.function_call)this._emit("functionCall",e.function_call);else if((0,He.isAssistantMessage)(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ht.OpenAIError("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ne(this,k,"m",os).call(this)}async finalMessage(){return await this.done(),ne(this,k,"m",Ar).call(this)}async finalFunctionCall(){return await this.done(),ne(this,k,"m",us).call(this)}async finalFunctionCallResult(){return await this.done(),ne(this,k,"m",cs).call(this)}async totalUsage(){return await this.done(),ne(this,k,"m",ls).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let r=ne(this,k,"m",Ar).call(this);r&&this._emit("finalMessage",r);let n=ne(this,k,"m",os).call(this);n&&this._emit("finalContent",n);let s=ne(this,k,"m",us).call(this);s&&this._emit("finalFunctionCall",s);let i=ne(this,k,"m",cs).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",ne(this,k,"m",ls).call(this))}async _createChatCompletion(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ne(this,k,"m",xi).call(this,r);let i=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion((0,$i.parseChatCompletion)(i,r))}async _runChatCompletion(e,r,n){for(let s of r.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,r,n)}async _runFunctions(e,r,n){let s="function",{function_call:i="auto",stream:a,...u}=r,l=typeof i!="string"&&i?.name,{maxChatCompletions:p=Ni}=n||{},v={};for(let g of r.functions)v[g.name||g.function.name]=g;let c=r.functions.map(g=>({name:g.name||g.function.name,parameters:g.parameters,description:g.description}));for(let g of r.messages)this._addMessage(g,!1);for(let g=0;g<p;++g){let R=(await this._createChatCompletion(e,{...u,function_call:i,functions:c,messages:[...this.messages]},n)).choices[0]?.message;if(!R)throw new ht.OpenAIError("missing message in ChatCompletion response");if(!R.function_call)return;let{name:y,arguments:D}=R.function_call,L=v[y];if(L){if(l&&l!==y){let J=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:y,content:J});continue}}else{let J=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${c.map(Y=>JSON.stringify(Y.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:J});continue}let P;try{P=(0,Di.isRunnableFunctionWithParse)(L)?await L.parse(D):D}catch(J){this._addMessage({role:s,name:y,content:J instanceof Error?J.message:String(J)});continue}let z=await L.function(P,this),B=ne(this,k,"m",fs).call(this,z);if(this._addMessage({role:s,name:y,content:B}),l)return}}async _runTools(e,r,n){let s="tool",{tool_choice:i="auto",stream:a,...u}=r,l=typeof i!="string"&&i?.function?.name,{maxChatCompletions:p=Ni}=n||{},v=r.tools.map(_=>{if((0,$i.isAutoParsableTool)(_)){if(!_.$callback)throw new ht.OpenAIError("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),c={};for(let _ of v)_.type==="function"&&(c[_.function.name||_.function.function.name]=_.function);let g="tools"in r?v.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(let _ of r.messages)this._addMessage(_,!1);for(let _=0;_<p;++_){let y=(await this._createChatCompletion(e,{...u,tool_choice:i,tools:g,messages:[...this.messages]},n)).choices[0]?.message;if(!y)throw new ht.OpenAIError("missing message in ChatCompletion response");if(!y.tool_calls?.length)return;for(let D of y.tool_calls){if(D.type!=="function")continue;let L=D.id,{name:P,arguments:z}=D.function,B=c[P];if(B){if(l&&l!==P){let V=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:L,content:V});continue}}else{let V=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(c).map(X=>JSON.stringify(X)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:L,content:V});continue}let J;try{J=(0,Di.isRunnableFunctionWithParse)(B)?await B.parse(z):z}catch(V){let X=V instanceof Error?V.message:String(V);this._addMessage({role:s,tool_call_id:L,content:X});continue}let Y=await B.function(J,this),Z=ne(this,k,"m",fs).call(this,Y);if(this._addMessage({role:s,tool_call_id:L,content:Z}),l)return}}}};pt.AbstractChatCompletionRunner=ds;k=new WeakSet,os=function(){return ne(this,k,"m",Ar).call(this).content??null},Ar=function(){let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if((0,He.isAssistantMessage)(r)){let{function_call:n,...s}=r,i={...s,content:r.content??null,refusal:r.refusal??null};return n&&(i.function_call=n),i}}throw new ht.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},us=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if((0,He.isAssistantMessage)(r)&&r?.function_call)return r.function_call;if((0,He.isAssistantMessage)(r)&&r?.tool_calls?.length)return r.tool_calls.at(-1)?.function}},cs=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if((0,He.isFunctionMessage)(r)&&r.content!=null||(0,He.isToolMessage)(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(s=>s.type==="function"&&s.id===r.tool_call_id)))return r.content}},ls=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},xi=function(e){if(e.n!=null&&e.n>1)throw new ht.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},fs=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)}});var _s=m(Cr=>{"use strict";o();Object.defineProperty(Cr,"__esModule",{value:!0});Cr.ChatCompletionRunner=void 0;var wc=hs(),Pc=ns(),ps=class t extends wc.AbstractChatCompletionRunner{static runFunctions(e,r,n){let s=new t,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,i)),s}static runTools(e,r,n){let s=new t,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,i)),s}_addMessage(e,r=!0){super._addMessage(e,r),(0,Pc.isAssistantMessage)(e)&&e.content&&this._emit("content",e.content)}};Cr.ChatCompletionRunner=ps});var ki=m(Xe=>{"use strict";o();Object.defineProperty(Xe,"__esModule",{value:!0});Xe.MalformedJSON=Xe.PartialJSON=Xe.partialParse=void 0;var Li=1,Ui=2,Hi=4,Wi=8,Ji=16,Vi=32,Xi=64,Ki=128,zi=256,Qi=Ki|zi,Gi=Ji|Vi|Qi|Xi,Yi=Li|Ui|Gi,Zi=Hi|Wi,Oc=Yi|Zi,K={STR:Li,NUM:Ui,ARR:Hi,OBJ:Wi,NULL:Ji,BOOL:Vi,NAN:Xi,INFINITY:Ki,MINUS_INFINITY:zi,INF:Qi,SPECIAL:Gi,ATOM:Yi,COLLECTION:Zi,ALL:Oc},Sr=class extends Error{};Xe.PartialJSON=Sr;var Er=class extends Error{};Xe.MalformedJSON=Er;function vc(t,e=K.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return Ac(t.trim(),e)}var Ac=(t,e)=>{let r=t.length,n=0,s=g=>{throw new Sr(`${g} at position ${n}`)},i=g=>{throw new Er(`${g} at position ${n}`)},a=()=>(c(),n>=r&&s("Unexpected end of input"),t[n]==='"'?u():t[n]==="{"?l():t[n]==="["?p():t.substring(n,n+4)==="null"||K.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||K.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||K.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||K.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||K.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||K.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):v()),u=()=>{let g=n,_=!1;for(n++;n<r&&(t[n]!=='"'||_&&t[n-1]==="\\");)_=t[n]==="\\"?!_:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(g,++n-Number(_)))}catch(R){i(String(R))}else if(K.STR&e)try{return JSON.parse(t.substring(g,n-Number(_))+'"')}catch{return JSON.parse(t.substring(g,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,c();let g={};try{for(;t[n]!=="}";){if(c(),n>=r&&K.OBJ&e)return g;let _=u();c(),n++;try{let R=a();Object.defineProperty(g,_,{value:R,writable:!0,enumerable:!0,configurable:!0})}catch(R){if(K.OBJ&e)return g;throw R}c(),t[n]===","&&n++}}catch{if(K.OBJ&e)return g;s("Expected '}' at end of object")}return n++,g},p=()=>{n++;let g=[];try{for(;t[n]!=="]";)g.push(a()),c(),t[n]===","&&n++}catch{if(K.ARR&e)return g;s("Expected ']' at end of array")}return n++,g},v=()=>{if(n===0){t==="-"&&K.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(_){if(K.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}i(String(_))}}let g=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(K.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(g,n))}catch{t.substring(g,n)==="-"&&K.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(g,t.lastIndexOf("e")))}catch(R){i(String(R))}}},c=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return a()},Cc=t=>vc(t,K.ALL^K.NUM);Xe.partialParse=Cc});var jr=m(ze=>{"use strict";o();var _t=ze&&ze.__classPrivateFieldSet||function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},M=ze&&ze.__classPrivateFieldGet||function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},W,We,mt,Ke,ms,Rr,gs,bs,ys,Ir,ws,ea;Object.defineProperty(ze,"__esModule",{value:!0});ze.ChatCompletionStream=void 0;var se=we(),Sc=hs(),ta=Wt(),jt=vr(),ra=ki(),Ps=class t extends Sc.AbstractChatCompletionRunner{constructor(e){super(),W.add(this),We.set(this,void 0),mt.set(this,void 0),Ke.set(this,void 0),_t(this,We,e,"f"),_t(this,mt,[],"f")}get currentChatCompletionSnapshot(){return M(this,Ke,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let s=new t(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),M(this,W,"m",ms).call(this);let i=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of i)M(this,W,"m",gs).call(this,a);if(i.controller.signal?.aborted)throw new se.APIUserAbortError;return this._addChatCompletion(M(this,W,"m",Ir).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),M(this,W,"m",ms).call(this),this._connected();let s=ta.Stream.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(M(this,W,"m",Ir).call(this)),M(this,W,"m",gs).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new se.APIUserAbortError;return this._addChatCompletion(M(this,W,"m",Ir).call(this))}[(We=new WeakMap,mt=new WeakMap,Ke=new WeakMap,W=new WeakSet,ms=function(){this.ended||_t(this,Ke,void 0,"f")},Rr=function(r){let n=M(this,mt,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},M(this,mt,"f")[r.index]=n,n)},gs=function(r){if(this.ended)return;let n=M(this,W,"m",ea).call(this,r);this._emit("chunk",r,n);for(let s of r.choices){let i=n.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=M(this,W,"m",Rr).call(this,i);i.finish_reason&&(M(this,W,"m",ys).call(this,i),a.current_tool_call_index!=null&&M(this,W,"m",bs).call(this,i,a.current_tool_call_index));for(let u of s.delta.tool_calls??[])a.current_tool_call_index!==u.index&&(M(this,W,"m",ys).call(this,i),a.current_tool_call_index!=null&&M(this,W,"m",bs).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=u.index;for(let u of s.delta.tool_calls??[]){let l=i.message.tool_calls?.[u.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:u.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:u.function?.arguments??""}):(l?.type,void 0))}}},bs=function(r,n){if(M(this,W,"m",Rr).call(this,r).done_tool_calls.has(n))return;let i=r.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=M(this,We,"f")?.tools?.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:(0,jt.isAutoParsableTool)(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},ys=function(r){let n=M(this,W,"m",Rr).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let s=M(this,W,"m",ws).call(this);this._emit("content.done",{content:r.message.content,parsed:s?s.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},Ir=function(){if(this.ended)throw new se.OpenAIError("stream has ended, this shouldn't happen");let r=M(this,Ke,"f");if(!r)throw new se.OpenAIError("request ended without sending any chunks");return _t(this,Ke,void 0,"f"),_t(this,mt,[],"f"),Ec(r,M(this,We,"f"))},ws=function(){let r=M(this,We,"f")?.response_format;return(0,jt.isAutoParsableResponseFormat)(r)?r:null},ea=function(r){var n,s,i,a;let u=M(this,Ke,"f"),{choices:l,...p}=r;u?Object.assign(u,p):u=_t(this,Ke,{...p,choices:[]},"f");for(let{delta:v,finish_reason:c,index:g,logprobs:_=null,...R}of r.choices){let y=u.choices[g];if(y||(y=u.choices[g]={finish_reason:c,index:g,message:{},logprobs:_,...R}),_)if(!y.logprobs)y.logprobs=Object.assign({},_);else{let{content:Y,refusal:Z,...V}=_;Object.assign(y.logprobs,V),Y&&((n=y.logprobs).content??(n.content=[]),y.logprobs.content.push(...Y)),Z&&((s=y.logprobs).refusal??(s.refusal=[]),y.logprobs.refusal.push(...Z))}if(c&&(y.finish_reason=c,M(this,We,"f")&&(0,jt.hasAutoParseableInput)(M(this,We,"f")))){if(c==="length")throw new se.LengthFinishReasonError;if(c==="content_filter")throw new se.ContentFilterFinishReasonError}if(Object.assign(y,R),!v)continue;let{content:D,refusal:L,function_call:P,role:z,tool_calls:B,...J}=v;if(Object.assign(y.message,J),L&&(y.message.refusal=(y.message.refusal||"")+L),z&&(y.message.role=z),P&&(y.message.function_call?(P.name&&(y.message.function_call.name=P.name),P.arguments&&((i=y.message.function_call).arguments??(i.arguments=""),y.message.function_call.arguments+=P.arguments)):y.message.function_call=P),D&&(y.message.content=(y.message.content||"")+D,!y.message.refusal&&M(this,W,"m",ws).call(this)&&(y.message.parsed=(0,ra.partialParse)(y.message.content))),B){y.message.tool_calls||(y.message.tool_calls=[]);for(let{index:Y,id:Z,type:V,function:X,...$}of B){let U=(a=y.message.tool_calls)[Y]??(a[Y]={});Object.assign(U,$),Z&&(U.id=Z),V&&(U.type=V),X&&(U.function??(U.function={name:X.name??"",arguments:""})),X?.name&&(U.function.name=X.name),X?.arguments&&(U.function.arguments+=X.arguments,(0,jt.shouldParseToolCall)(M(this,We,"f"),U)&&(U.function.parsed_arguments=(0,ra.partialParse)(U.function.arguments)))}}}return u},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ta.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};ze.ChatCompletionStream=Ps;function Ec(t,e){let{id:r,choices:n,created:s,model:i,system_fingerprint:a,...u}=t,l={...u,id:r,choices:n.map(({message:p,finish_reason:v,index:c,logprobs:g,..._})=>{if(!v)throw new se.OpenAIError(`missing finish_reason for choice ${c}`);let{content:R=null,function_call:y,tool_calls:D,...L}=p,P=p.role;if(!P)throw new se.OpenAIError(`missing role for choice ${c}`);if(y){let{arguments:z,name:B}=y;if(z==null)throw new se.OpenAIError(`missing function_call.arguments for choice ${c}`);if(!B)throw new se.OpenAIError(`missing function_call.name for choice ${c}`);return{..._,message:{content:R,function_call:{arguments:z,name:B},role:P,refusal:p.refusal??null},finish_reason:v,index:c,logprobs:g}}return D?{..._,index:c,finish_reason:v,logprobs:g,message:{...L,role:P,content:R,refusal:p.refusal??null,tool_calls:D.map((z,B)=>{let{function:J,type:Y,id:Z,...V}=z,{arguments:X,name:$,...U}=J||{};if(Z==null)throw new se.OpenAIError(`missing choices[${c}].tool_calls[${B}].id
${Mr(t)}`);if(Y==null)throw new se.OpenAIError(`missing choices[${c}].tool_calls[${B}].type
${Mr(t)}`);if($==null)throw new se.OpenAIError(`missing choices[${c}].tool_calls[${B}].function.name
${Mr(t)}`);if(X==null)throw new se.OpenAIError(`missing choices[${c}].tool_calls[${B}].function.arguments
${Mr(t)}`);return{...V,id:Z,type:Y,function:{...U,name:$,arguments:X}}})}}:{..._,message:{...L,content:R,role:P,refusal:p.refusal??null},finish_reason:v,index:c,logprobs:g}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return(0,jt.maybeParseChatCompletion)(l,e)}function Mr(t){return JSON.stringify(t)}});var vs=m(Fr=>{"use strict";o();Object.defineProperty(Fr,"__esModule",{value:!0});Fr.ChatCompletionStreamingRunner=void 0;var Rc=jr(),Os=class t extends Rc.ChatCompletionStream{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runFunctions(e,r,n){let s=new t(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,i)),s}static runTools(e,r,n){let s=new t(r),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,i)),s}};Fr.ChatCompletionStreamingRunner=Os});var oa=m(ie=>{"use strict";o();Object.defineProperty(ie,"__esModule",{value:!0});ie.Completions=ie.ChatCompletionStream=ie.ParsingToolFunction=ie.ParsingFunction=ie.ChatCompletionStreamingRunner=ie.ChatCompletionRunner=void 0;var Ic=I(),na=_s(),Mc=_s();Object.defineProperty(ie,"ChatCompletionRunner",{enumerable:!0,get:function(){return Mc.ChatCompletionRunner}});var sa=vs(),jc=vs();Object.defineProperty(ie,"ChatCompletionStreamingRunner",{enumerable:!0,get:function(){return jc.ChatCompletionStreamingRunner}});var aa=rs();Object.defineProperty(ie,"ParsingFunction",{enumerable:!0,get:function(){return aa.ParsingFunction}});Object.defineProperty(ie,"ParsingToolFunction",{enumerable:!0,get:function(){return aa.ParsingToolFunction}});var Fc=jr(),ia=vr(),qc=jr();Object.defineProperty(ie,"ChatCompletionStream",{enumerable:!0,get:function(){return qc.ChatCompletionStream}});var As=class extends Ic.APIResource{parse(e,r){return(0,ia.validateInputTools)(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>(0,ia.parseChatCompletion)(n,e))}runFunctions(e,r){return e.stream?sa.ChatCompletionStreamingRunner.runFunctions(this._client,e,r):na.ChatCompletionRunner.runFunctions(this._client,e,r)}runTools(e,r){return e.stream?sa.ChatCompletionStreamingRunner.runTools(this._client,e,r):na.ChatCompletionRunner.runTools(this._client,e,r)}stream(e,r){return Fc.ChatCompletionStream.createChatCompletion(this._client,e,r)}};ie.Completions=As});var ca=m(Ce=>{"use strict";o();var Tc=Ce&&Ce.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Bc=Ce&&Ce.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Dc=Ce&&Ce.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Tc(e,t,r);return Bc(e,t),e};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Chat=void 0;var $c=I(),ua=Dc(oa()),qr=class extends $c.APIResource{constructor(){super(...arguments),this.completions=new ua.Completions(this._client)}};Ce.Chat=qr;(function(t){t.Completions=ua.Completions})(qr=Ce.Chat||(Ce.Chat={}))});var Es=m(ae=>{"use strict";o();var Nc=ae&&ae.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),xc=ae&&ae.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Lc=ae&&ae.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Nc(e,t,r);return xc(e,t),e},b=ae&&ae.__classPrivateFieldGet||function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},be=ae&&ae.__classPrivateFieldSet||function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Q,Ss,xe,Tr,qe,tt,gt,et,$r,ye,Br,Dr,Bt,Ft,qt,la,fa,da,ha,pa,_a,ma;Object.defineProperty(ae,"__esModule",{value:!0});ae.AssistantStream=void 0;var Cs=Lc(F()),ga=Wt(),Tt=we(),Uc=as(),Dt=class t extends Uc.EventStream{constructor(){super(...arguments),Q.add(this),Ss.set(this,[]),xe.set(this,{}),Tr.set(this,{}),qe.set(this,void 0),tt.set(this,void 0),gt.set(this,void 0),et.set(this,void 0),$r.set(this,void 0),ye.set(this,void 0),Br.set(this,void 0),Dr.set(this,void 0),Bt.set(this,void 0)}[(Ss=new WeakMap,xe=new WeakMap,Tr=new WeakMap,qe=new WeakMap,tt=new WeakMap,gt=new WeakMap,et=new WeakMap,$r=new WeakMap,ye=new WeakMap,Br=new WeakMap,Dr=new WeakMap,Bt=new WeakMap,Q=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let i=r.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let i of r)i.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>r.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new t;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=ga.Stream.fromReadableStream(e,this.controller);for await(let i of s)b(this,Q,"m",Ft).call(this,i);if(s.controller.signal?.aborted)throw new Tt.APIUserAbortError;return this._addRun(b(this,Q,"m",qt).call(this))}toReadableStream(){return new ga.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s,i){let a=new t;return a._run(()=>a._runToolAssistantStream(e,r,n,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,r,n,s,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let u={...s,stream:!0},l=await e.submitToolOutputs(r,n,u,{...i,signal:this.controller.signal});this._connected();for await(let p of l)b(this,Q,"m",Ft).call(this,p);if(l.controller.signal?.aborted)throw new Tt.APIUserAbortError;return this._addRun(b(this,Q,"m",qt).call(this))}static createThreadAssistantStream(e,r,n){let s=new t;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){let i=new t;return i._run(()=>i._runAssistantStream(e,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return b(this,Br,"f")}currentRun(){return b(this,Dr,"f")}currentMessageSnapshot(){return b(this,qe,"f")}currentRunStepSnapshot(){return b(this,Bt,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,xe,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,Tr,"f"))}async finalRun(){if(await this.done(),!b(this,tt,"f"))throw Error("Final run was not received.");return b(this,tt,"f")}async _createThreadAssistantStream(e,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let u of a)b(this,Q,"m",Ft).call(this,u);if(a.controller.signal?.aborted)throw new Tt.APIUserAbortError;return this._addRun(b(this,Q,"m",qt).call(this))}async _createAssistantStream(e,r,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},u=await e.create(r,a,{...s,signal:this.controller.signal});this._connected();for await(let l of u)b(this,Q,"m",Ft).call(this,l);if(u.controller.signal?.aborted)throw new Tt.APIUserAbortError;return this._addRun(b(this,Q,"m",qt).call(this))}static accumulateDelta(e,r){for(let[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Cs.isObj(i)&&Cs.isObj(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!Cs.isObj(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let u=a.index;if(u==null)throw new Error("Expected array delta entry to have an `index` property");if(typeof u!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${u}`);let l=i[u];l==null?i.push(a):i[u]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s,i){return await this._createToolAssistantStream(n,e,r,s,i)}};ae.AssistantStream=Dt;Ft=function(e){if(!this.ended)switch(be(this,Br,e,"f"),b(this,Q,"m",da).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,Q,"m",ma).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,Q,"m",fa).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,Q,"m",la).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},qt=function(){if(this.ended)throw new Tt.OpenAIError("stream has ended, this shouldn't happen");if(!b(this,tt,"f"))throw Error("Final run has not been received");return b(this,tt,"f")},la=function(e){let[r,n]=b(this,Q,"m",pa).call(this,e,b(this,qe,"f"));be(this,qe,r,"f"),b(this,Tr,"f")[r.id]=r;for(let s of n){let i=r.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=r.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=b(this,gt,"f")){if(b(this,et,"f"))switch(b(this,et,"f").type){case"text":this._emit("textDone",b(this,et,"f").text,b(this,qe,"f"));break;case"image_file":this._emit("imageFileDone",b(this,et,"f").image_file,b(this,qe,"f"));break}be(this,gt,s.index,"f")}be(this,et,r.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,gt,"f")!==void 0){let s=e.data.content[b(this,gt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,b(this,qe,"f"));break;case"text":this._emit("textDone",s.text,b(this,qe,"f"));break}}b(this,qe,"f")&&this._emit("messageDone",e.data),be(this,qe,void 0,"f")}},fa=function(e){let r=b(this,Q,"m",ha).call(this,e);switch(be(this,Bt,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==b(this,$r,"f")?this._emit("toolCallDelta",i,r.step_details.tool_calls[i.index]):(b(this,ye,"f")&&this._emit("toolCallDone",b(this,ye,"f")),be(this,$r,i.index,"f"),be(this,ye,r.step_details.tool_calls[i.index],"f"),b(this,ye,"f")&&this._emit("toolCallCreated",b(this,ye,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":be(this,Bt,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,ye,"f")&&(this._emit("toolCallDone",b(this,ye,"f")),be(this,ye,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},da=function(e){b(this,Ss,"f").push(e),this._emit("event",e)},ha=function(e){switch(e.event){case"thread.run.step.created":return b(this,xe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=b(this,xe,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=Dt.accumulateDelta(r,n.delta);b(this,xe,"f")[e.data.id]=s}return b(this,xe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,xe,"f")[e.data.id]=e.data;break}if(b(this,xe,"f")[e.data.id])return b(this,xe,"f")[e.data.id];throw new Error("No snapshot available")},pa=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in r.content){let a=r.content[i.index];r.content[i.index]=b(this,Q,"m",_a).call(this,i,a)}else r.content[i.index]=i,n.push(i);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_a=function(e,r){return Dt.accumulateDelta(r,e)},ma=function(e){switch(be(this,Dr,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":be(this,tt,e.data,"f"),b(this,ye,"f")&&(this._emit("toolCallDone",b(this,ye,"f")),be(this,ye,void 0,"f"));break;case"thread.run.cancelling":break}}});var Rs=m(oe=>{"use strict";o();var Hc=oe&&oe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Wc=oe&&oe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Jc=oe&&oe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Hc(e,t,r);return Wc(e,t),e};Object.defineProperty(oe,"__esModule",{value:!0});oe.MessagesPage=oe.Messages=void 0;var Vc=I(),Xc=F(),Kc=Jc(Rs()),zc=ge(),Nr=class extends Vc.APIResource{create(e,r,n){return this._client.post(`/threads/${e}/messages`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/messages/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,r={},n){return(0,Xc.isRequestOptions)(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/messages`,xr,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r,n){return this._client.delete(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}};oe.Messages=Nr;var xr=class extends zc.CursorPage{};oe.MessagesPage=xr;(function(t){t.MessagesPage=Kc.MessagesPage})(Nr=oe.Messages||(oe.Messages={}))});var Is=m(ue=>{"use strict";o();var Qc=ue&&ue.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Gc=ue&&ue.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Yc=ue&&ue.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Qc(e,t,r);return Gc(e,t),e};Object.defineProperty(ue,"__esModule",{value:!0});ue.RunStepsPage=ue.Steps=void 0;var Zc=I(),ba=F(),kc=Yc(Is()),el=ge(),Lr=class extends Zc.APIResource{retrieve(e,r,n,s={},i){return(0,ba.isRequestOptions)(s)?this.retrieve(e,r,n,{},s):this._client.get(`/threads/${e}/runs/${r}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,r,n={},s){return(0,ba.isRequestOptions)(n)?this.list(e,r,{},n):this._client.getAPIList(`/threads/${e}/runs/${r}/steps`,Ur,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}};ue.Steps=Lr;var Ur=class extends el.CursorPage{};ue.RunStepsPage=Ur;(function(t){t.RunStepsPage=kc.RunStepsPage})(Lr=ue.Steps||(ue.Steps={}))});var Fs=m(ce=>{"use strict";o();var tl=ce&&ce.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),rl=ce&&ce.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ya=ce&&ce.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&tl(e,t,r);return rl(e,t),e};Object.defineProperty(ce,"__esModule",{value:!0});ce.RunsPage=ce.Runs=void 0;var nl=I(),sl=F(),Ms=Es(),il=F(),al=ya(Fs()),js=ya(Is()),ol=ge(),Hr=class extends nl.APIResource{constructor(){super(...arguments),this.steps=new js.Steps(this._client)}create(e,r,n){let{include:s,...i}=r;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:r.stream??!1})}retrieve(e,r,n){return this._client.get(`/threads/${e}/runs/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/runs/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,r={},n){return(0,sl.isRequestOptions)(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/runs`,Wr,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,r,n){return this._client.post(`/threads/${e}/runs/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}createAndStream(e,r,n){return Ms.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(n?.pollIntervalMs)u=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let p=parseInt(l);isNaN(p)||(u=p)}}await(0,il.sleep)(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,r,n){return Ms.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n,s){return this._client.post(`/threads/${e}/runs/${r}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,r,n,s){let i=await this.submitToolOutputs(e,r,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,r,n,s){return Ms.AssistantStream.createToolAssistantStream(e,r,this._client.beta.threads.runs,n,s)}};ce.Runs=Hr;var Wr=class extends ol.CursorPage{};ce.RunsPage=Wr;(function(t){t.RunsPage=al.RunsPage,t.Steps=js.Steps,t.RunStepsPage=js.RunStepsPage})(Hr=ce.Runs||(ce.Runs={}))});var Pa=m(Se=>{"use strict";o();var ul=Se&&Se.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),cl=Se&&Se.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),wa=Se&&Se.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ul(e,t,r);return cl(e,t),e};Object.defineProperty(Se,"__esModule",{value:!0});Se.Threads=void 0;var ll=I(),fl=F(),dl=Es(),qs=wa(Rs()),Ts=wa(Fs()),Jr=class extends ll.APIResource{constructor(){super(...arguments),this.runs=new Ts.Runs(this._client),this.messages=new qs.Messages(this._client)}create(e={},r){return(0,fl.isRequestOptions)(e)?this.create({},e):this._client.post("/threads",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/threads/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r){return this._client.delete(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.thread_id,n.id,r)}createAndRunStream(e,r){return dl.AssistantStream.createThreadAssistantStream(e,this._client.beta.threads,r)}};Se.Threads=Jr;(function(t){t.Runs=Ts.Runs,t.RunsPage=Ts.RunsPage,t.Messages=qs.Messages,t.MessagesPage=qs.MessagesPage})(Jr=Se.Threads||(Se.Threads={}))});var Oa=m(Vr=>{"use strict";o();Object.defineProperty(Vr,"__esModule",{value:!0});Vr.allSettledWithThrow=void 0;var hl=async t=>{let e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(let s of r);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n};Vr.allSettledWithThrow=hl});var zr=m(le=>{"use strict";o();var pl=le&&le.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),_l=le&&le.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ml=le&&le.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&pl(e,t,r);return _l(e,t),e};Object.defineProperty(le,"__esModule",{value:!0});le.VectorStoreFilesPage=le.Files=void 0;var gl=I(),va=F(),bl=ml(zr()),yl=ge(),Xr=class extends gl.APIResource{create(e,r,n){return this._client.post(`/vector_stores/${e}/files`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,r={},n){return(0,va.isRequestOptions)(r)?this.list(e,{},r):this._client.getAPIList(`/vector_stores/${e}/files`,Kr,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,r,n){return this._client.delete(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let i=await this.retrieve(e,r,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let u=5e3;if(n?.pollIntervalMs)u=n.pollIntervalMs;else{let l=i.response.headers.get("openai-poll-after-ms");if(l){let p=parseInt(l);isNaN(p)||(u=p)}}await(0,va.sleep)(u);break;case"failed":case"completed":return a}}}async upload(e,r,n){let s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){let s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}};le.Files=Xr;var Kr=class extends yl.CursorPage{};le.VectorStoreFilesPage=Kr;(function(t){t.VectorStoreFilesPage=bl.VectorStoreFilesPage})(Xr=le.Files||(le.Files={}))});var Ca=m(Qe=>{"use strict";o();Object.defineProperty(Qe,"__esModule",{value:!0});Qe.VectorStoreFilesPage=Qe.FileBatches=void 0;var wl=I(),Pl=F(),Ol=F(),vl=Oa(),Aa=zr();Object.defineProperty(Qe,"VectorStoreFilesPage",{enumerable:!0,get:function(){return Aa.VectorStoreFilesPage}});var Qr=class extends wl.APIResource{create(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/file_batches/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n={},s){return(0,Pl.isRequestOptions)(n)?this.listFiles(e,r,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${r}/files`,Aa.VectorStoreFilesPage,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,r,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,r,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let u=5e3;if(n?.pollIntervalMs)u=n.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let p=parseInt(l);isNaN(p)||(u=p)}}await(0,Ol.sleep)(u);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,r.length),u=this._client,l=r.values(),p=[...n];async function v(g){for(let _ of g){let R=await u.files.create({file:_,purpose:"assistants"},s);p.push(R.id)}}let c=Array(a).fill(l).map(v);return await(0,vl.allSettledWithThrow)(c),await this.createAndPoll(e,{file_ids:p})}};Qe.FileBatches=Qr;Qr=Qe.FileBatches||(Qe.FileBatches={})});var $s=m(fe=>{"use strict";o();var Al=fe&&fe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Cl=fe&&fe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ds=fe&&fe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Al(e,t,r);return Cl(e,t),e};Object.defineProperty(fe,"__esModule",{value:!0});fe.VectorStoresPage=fe.VectorStores=void 0;var Sl=I(),El=F(),Rl=Ds($s()),Sa=Ds(Ca()),Bs=Ds(zr()),Il=ge(),Gr=class extends Sl.APIResource{constructor(){super(...arguments),this.files=new Bs.Files(this._client),this.fileBatches=new Sa.FileBatches(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,r){return this._client.get(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,r,n){return this._client.post(`/vector_stores/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},r){return(0,El.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/vector_stores",Yr,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,r){return this._client.delete(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}};fe.VectorStores=Gr;var Yr=class extends Il.CursorPage{};fe.VectorStoresPage=Yr;(function(t){t.VectorStoresPage=Rl.VectorStoresPage,t.Files=Bs.Files,t.VectorStoreFilesPage=Bs.VectorStoreFilesPage,t.FileBatches=Sa.FileBatches})(Gr=fe.VectorStores||(fe.VectorStores={}))});var Ia=m(Ee=>{"use strict";o();var Ml=Ee&&Ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),jl=Ee&&Ee.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),kr=Ee&&Ee.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Ml(e,t,r);return jl(e,t),e};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.Beta=void 0;var Fl=I(),Ns=kr(kn()),Ea=kr(ca()),Ra=kr(Pa()),xs=kr($s()),Zr=class extends Fl.APIResource{constructor(){super(...arguments),this.vectorStores=new xs.VectorStores(this._client),this.chat=new Ea.Chat(this._client),this.assistants=new Ns.Assistants(this._client),this.threads=new Ra.Threads(this._client)}};Ee.Beta=Zr;(function(t){t.VectorStores=xs.VectorStores,t.VectorStoresPage=xs.VectorStoresPage,t.Chat=Ea.Chat,t.Assistants=Ns.Assistants,t.AssistantsPage=Ns.AssistantsPage,t.Threads=Ra.Threads})(Zr=Ee.Beta||(Ee.Beta={}))});var Ma=m(bt=>{"use strict";o();Object.defineProperty(bt,"__esModule",{value:!0});bt.Completions=void 0;var ql=I(),en=class extends ql.APIResource{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};bt.Completions=en;en=bt.Completions||(bt.Completions={})});var ja=m(yt=>{"use strict";o();Object.defineProperty(yt,"__esModule",{value:!0});yt.Embeddings=void 0;var Tl=I(),tn=class extends Tl.APIResource{create(e,r){return this._client.post("/embeddings",{body:e,...r})}};yt.Embeddings=tn;tn=yt.Embeddings||(yt.Embeddings={})});var Ls=m(de=>{"use strict";o();var Bl=de&&de.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Dl=de&&de.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Fa=de&&de.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Bl(e,t,r);return Dl(e,t),e};Object.defineProperty(de,"__esModule",{value:!0});de.FileObjectsPage=de.Files=void 0;var $l=I(),Nl=F(),xl=F(),Ll=we(),Ul=Fa(F()),Hl=Fa(Ls()),Wl=ge(),rn=class extends $l.APIResource{create(e,r){return this._client.post("/files",Ul.multipartFormRequestOptions({body:e,...r}))}retrieve(e,r){return this._client.get(`/files/${e}`,r)}list(e={},r){return(0,Nl.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/files",nn,{query:e,...r})}del(e,r){return this._client.delete(`/files/${e}`,r)}content(e,r){return this._client.get(`/files/${e}/content`,{...r,__binaryResponse:!0})}retrieveContent(e,r){return this._client.get(`/files/${e}/content`,{...r,headers:{Accept:"application/json",...r?.headers}})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await(0,xl.sleep)(r),a=await this.retrieve(e),Date.now()-i>n)throw new Ll.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};de.Files=rn;var nn=class extends Wl.Page{};de.FileObjectsPage=nn;(function(t){t.FileObjectsPage=Hl.FileObjectsPage})(rn=de.Files||(de.Files={}))});var Us=m(he=>{"use strict";o();var Jl=he&&he.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Vl=he&&he.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Xl=he&&he.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Jl(e,t,r);return Vl(e,t),e};Object.defineProperty(he,"__esModule",{value:!0});he.FineTuningJobCheckpointsPage=he.Checkpoints=void 0;var Kl=I(),zl=F(),Ql=Xl(Us()),Gl=ge(),sn=class extends Kl.APIResource{list(e,r={},n){return(0,zl.isRequestOptions)(r)?this.list(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,an,{query:r,...n})}};he.Checkpoints=sn;var an=class extends Gl.CursorPage{};he.FineTuningJobCheckpointsPage=an;(function(t){t.FineTuningJobCheckpointsPage=Ql.FineTuningJobCheckpointsPage})(sn=he.Checkpoints||(he.Checkpoints={}))});var Ws=m(ee=>{"use strict";o();var Yl=ee&&ee.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Zl=ee&&ee.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ba=ee&&ee.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Yl(e,t,r);return Zl(e,t),e};Object.defineProperty(ee,"__esModule",{value:!0});ee.FineTuningJobEventsPage=ee.FineTuningJobsPage=ee.Jobs=void 0;var kl=I(),qa=F(),Ta=Ba(Ws()),Hs=Ba(Us()),Da=ge(),on=class extends kl.APIResource{constructor(){super(...arguments),this.checkpoints=new Hs.Checkpoints(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(`/fine_tuning/jobs/${e}`,r)}list(e={},r){return(0,qa.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",un,{query:e,...r})}cancel(e,r){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return(0,qa.isRequestOptions)(r)?this.listEvents(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,cn,{query:r,...n})}};ee.Jobs=on;var un=class extends Da.CursorPage{};ee.FineTuningJobsPage=un;var cn=class extends Da.CursorPage{};ee.FineTuningJobEventsPage=cn;(function(t){t.FineTuningJobsPage=Ta.FineTuningJobsPage,t.FineTuningJobEventsPage=Ta.FineTuningJobEventsPage,t.Checkpoints=Hs.Checkpoints,t.FineTuningJobCheckpointsPage=Hs.FineTuningJobCheckpointsPage})(on=ee.Jobs||(ee.Jobs={}))});var $a=m(Re=>{"use strict";o();var ef=Re&&Re.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),tf=Re&&Re.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),rf=Re&&Re.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&ef(e,t,r);return tf(e,t),e};Object.defineProperty(Re,"__esModule",{value:!0});Re.FineTuning=void 0;var nf=I(),ln=rf(Ws()),fn=class extends nf.APIResource{constructor(){super(...arguments),this.jobs=new ln.Jobs(this._client)}};Re.FineTuning=fn;(function(t){t.Jobs=ln.Jobs,t.FineTuningJobsPage=ln.FineTuningJobsPage,t.FineTuningJobEventsPage=ln.FineTuningJobEventsPage})(fn=Re.FineTuning||(Re.FineTuning={}))});var xa=m(Ie=>{"use strict";o();var sf=Ie&&Ie.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),af=Ie&&Ie.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),of=Ie&&Ie.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&sf(e,t,r);return af(e,t),e};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.Images=void 0;var uf=I(),Na=of(F()),dn=class extends uf.APIResource{createVariation(e,r){return this._client.post("/images/variations",Na.multipartFormRequestOptions({body:e,...r}))}edit(e,r){return this._client.post("/images/edits",Na.multipartFormRequestOptions({body:e,...r}))}generate(e,r){return this._client.post("/images/generations",{body:e,...r})}};Ie.Images=dn;dn=Ie.Images||(Ie.Images={})});var Js=m(pe=>{"use strict";o();var cf=pe&&pe.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),lf=pe&&pe.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ff=pe&&pe.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&cf(e,t,r);return lf(e,t),e};Object.defineProperty(pe,"__esModule",{value:!0});pe.ModelsPage=pe.Models=void 0;var df=I(),hf=ff(Js()),pf=ge(),hn=class extends df.APIResource{retrieve(e,r){return this._client.get(`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",pn,e)}del(e,r){return this._client.delete(`/models/${e}`,r)}};pe.Models=hn;var pn=class extends pf.Page{};pe.ModelsPage=pn;(function(t){t.ModelsPage=hf.ModelsPage})(hn=pe.Models||(pe.Models={}))});var La=m(wt=>{"use strict";o();Object.defineProperty(wt,"__esModule",{value:!0});wt.Moderations=void 0;var _f=I(),_n=class extends _f.APIResource{create(e,r){return this._client.post("/moderations",{body:e,...r})}};wt.Moderations=_n;_n=wt.Moderations||(wt.Moderations={})});var Ua=m(Me=>{"use strict";o();var mf=Me&&Me.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),gf=Me&&Me.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),bf=Me&&Me.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&mf(e,t,r);return gf(e,t),e};Object.defineProperty(Me,"__esModule",{value:!0});Me.Parts=void 0;var yf=I(),wf=bf(F()),mn=class extends yf.APIResource{create(e,r,n){return this._client.post(`/uploads/${e}/parts`,wf.multipartFormRequestOptions({body:r,...n}))}};Me.Parts=mn;mn=Me.Parts||(Me.Parts={})});var Wa=m(je=>{"use strict";o();var Pf=je&&je.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Of=je&&je.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),vf=je&&je.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Pf(e,t,r);return Of(e,t),e};Object.defineProperty(je,"__esModule",{value:!0});je.Uploads=void 0;var Af=I(),Ha=vf(Ua()),gn=class extends Af.APIResource{constructor(){super(...arguments),this.parts=new Ha.Parts(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(`/uploads/${e}/complete`,{body:r,...n})}};je.Uploads=gn;(function(t){t.Parts=Ha.Parts})(gn=je.Uploads||(je.Uploads={}))});var za=m(A=>{"use strict";o();var Cf=A&&A.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ja=A&&A.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Cf(e,t,r)};Object.defineProperty(A,"__esModule",{value:!0});A.Uploads=A.Moderations=A.Models=A.ModelsPage=A.Images=A.FineTuning=A.Files=A.FileObjectsPage=A.Embeddings=A.Completions=A.Beta=A.Batches=A.BatchesPage=A.Audio=void 0;Ja(Oi(),A);Ja(Ai(),A);var Sf=ji();Object.defineProperty(A,"Audio",{enumerable:!0,get:function(){return Sf.Audio}});var Va=Zn();Object.defineProperty(A,"BatchesPage",{enumerable:!0,get:function(){return Va.BatchesPage}});Object.defineProperty(A,"Batches",{enumerable:!0,get:function(){return Va.Batches}});var Ef=Ia();Object.defineProperty(A,"Beta",{enumerable:!0,get:function(){return Ef.Beta}});var Rf=Ma();Object.defineProperty(A,"Completions",{enumerable:!0,get:function(){return Rf.Completions}});var If=ja();Object.defineProperty(A,"Embeddings",{enumerable:!0,get:function(){return If.Embeddings}});var Xa=Ls();Object.defineProperty(A,"FileObjectsPage",{enumerable:!0,get:function(){return Xa.FileObjectsPage}});Object.defineProperty(A,"Files",{enumerable:!0,get:function(){return Xa.Files}});var Mf=$a();Object.defineProperty(A,"FineTuning",{enumerable:!0,get:function(){return Mf.FineTuning}});var jf=xa();Object.defineProperty(A,"Images",{enumerable:!0,get:function(){return jf.Images}});var Ka=Js();Object.defineProperty(A,"ModelsPage",{enumerable:!0,get:function(){return Ka.ModelsPage}});Object.defineProperty(A,"Models",{enumerable:!0,get:function(){return Ka.Models}});var Ff=La();Object.defineProperty(A,"Moderations",{enumerable:!0,get:function(){return Ff.Moderations}});var qf=Wa();Object.defineProperty(A,"Uploads",{enumerable:!0,get:function(){return qf.Uploads}})});var Za=m((O,Vs)=>{"use strict";o();var Tf=O&&O.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(e,r);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,s)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Bf=O&&O.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Pt=O&&O.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Tf(e,t,r);return Bf(e,t),e},Ya;Object.defineProperty(O,"__esModule",{value:!0});O.AzureOpenAI=O.fileFromPath=O.toFile=O.UnprocessableEntityError=O.PermissionDeniedError=O.InternalServerError=O.AuthenticationError=O.BadRequestError=O.RateLimitError=O.ConflictError=O.NotFoundError=O.APIUserAbortError=O.APIConnectionTimeoutError=O.APIConnectionError=O.APIError=O.OpenAIError=O.OpenAI=void 0;var C=Pt(we()),yn=Pt(Jt()),Df=Pt(bi()),Le=Pt(F()),Qa=Pt(ge()),j=Pt(za()),q=class extends Le.APIClient{constructor({baseURL:e=Le.readEnv("OPENAI_BASE_URL"),apiKey:r=Le.readEnv("OPENAI_API_KEY"),organization:n=Le.readEnv("OPENAI_ORG_ID")??null,project:s=Le.readEnv("OPENAI_PROJECT_ID")??null,...i}={}){if(r===void 0)throw new C.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:r,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Le.isRunningInBrowser())throw new C.OpenAIError(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new j.Completions(this),this.chat=new j.Chat(this),this.embeddings=new j.Embeddings(this),this.files=new j.Files(this),this.images=new j.Images(this),this.audio=new j.Audio(this),this.moderations=new j.Moderations(this),this.models=new j.Models(this),this.fineTuning=new j.FineTuning(this),this.beta=new j.Beta(this),this.batches=new j.Batches(this),this.uploads=new j.Uploads(this),this._options=a,this.apiKey=r,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Df.stringify(e,{arrayFormat:"brackets"})}};O.OpenAI=q;Ya=q;q.OpenAI=Ya;q.DEFAULT_TIMEOUT=6e5;q.OpenAIError=C.OpenAIError;q.APIError=C.APIError;q.APIConnectionError=C.APIConnectionError;q.APIConnectionTimeoutError=C.APIConnectionTimeoutError;q.APIUserAbortError=C.APIUserAbortError;q.NotFoundError=C.NotFoundError;q.ConflictError=C.ConflictError;q.RateLimitError=C.RateLimitError;q.BadRequestError=C.BadRequestError;q.AuthenticationError=C.AuthenticationError;q.InternalServerError=C.InternalServerError;q.PermissionDeniedError=C.PermissionDeniedError;q.UnprocessableEntityError=C.UnprocessableEntityError;q.toFile=yn.toFile;q.fileFromPath=yn.fileFromPath;O.OpenAIError=C.OpenAIError,O.APIError=C.APIError,O.APIConnectionError=C.APIConnectionError,O.APIConnectionTimeoutError=C.APIConnectionTimeoutError,O.APIUserAbortError=C.APIUserAbortError,O.NotFoundError=C.NotFoundError,O.ConflictError=C.ConflictError,O.RateLimitError=C.RateLimitError,O.BadRequestError=C.BadRequestError,O.AuthenticationError=C.AuthenticationError,O.InternalServerError=C.InternalServerError,O.PermissionDeniedError=C.PermissionDeniedError,O.UnprocessableEntityError=C.UnprocessableEntityError;O.toFile=yn.toFile;O.fileFromPath=yn.fileFromPath;(function(t){t.Page=Qa.Page,t.CursorPage=Qa.CursorPage,t.Completions=j.Completions,t.Chat=j.Chat,t.Embeddings=j.Embeddings,t.Files=j.Files,t.FileObjectsPage=j.FileObjectsPage,t.Images=j.Images,t.Audio=j.Audio,t.Moderations=j.Moderations,t.Models=j.Models,t.ModelsPage=j.ModelsPage,t.FineTuning=j.FineTuning,t.Beta=j.Beta,t.Batches=j.Batches,t.BatchesPage=j.BatchesPage,t.Uploads=j.Uploads})(q=O.OpenAI||(O.OpenAI={}));var bn=class extends q{constructor({baseURL:e=Le.readEnv("OPENAI_BASE_URL"),apiKey:r=Le.readEnv("AZURE_OPENAI_API_KEY"),apiVersion:n=Le.readEnv("OPENAI_API_VERSION"),endpoint:s,deployment:i,azureADTokenProvider:a,dangerouslyAllowBrowser:u,...l}={}){if(!n)throw new C.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof a=="function"&&(u=!0),!a&&!r)throw new C.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(a&&r)throw new C.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(r??(r=Ga),l.defaultQuery={...l.defaultQuery,"api-version":n},e){if(s)throw new C.OpenAIError("baseURL and endpoint are mutually exclusive")}else{if(s||(s=d.env.AZURE_OPENAI_ENDPOINT),!s)throw new C.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${s}/openai`}super({apiKey:r,baseURL:e,...l,...u!==void 0?{dangerouslyAllowBrowser:u}:{}}),this.apiVersion="",this._azureADTokenProvider=a,this.apiVersion=n,this._deployment=i}buildRequest(e){if($f.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!Le.isObj(e.body))throw new Error("Expected request body to be an object");let r=this._deployment||e.body.model;r!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${r}${e.path}`)}return super.buildRequest(e)}async _getAzureADToken(){if(typeof this._azureADTokenProvider=="function"){let e=await this._azureADTokenProvider();if(!e||typeof e!="string")throw new C.OpenAIError(`Expected 'azureADTokenProvider' argument to return a string but it returned ${e}`);return e}}authHeaders(e){return{}}async prepareOptions(e){if(e.headers?.["api-key"])return super.prepareOptions(e);let r=await this._getAzureADToken();if(e.headers??(e.headers={}),r)e.headers.Authorization=`Bearer ${r}`;else if(this.apiKey!==Ga)e.headers["api-key"]=this.apiKey;else throw new C.OpenAIError("Unable to handle auth");return super.prepareOptions(e)}};O.AzureOpenAI=bn;var $f=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]),Ga="<Missing Key>";O=Vs.exports=q;Vs.exports.AzureOpenAI=bn;O.default=q});var xf=m(Ge=>{o();Object.defineProperty(Ge,"__esModule",{value:!0});Ge.apply=Ge.Config=Ge.name=void 0;var G=(Gs(),so(rt)),ka=Za();Ge.name="openrouter-chatgpt";Ge.Config=G.Schema.object({apiKey:G.Schema.string().required().description("OpenAI API Key: https://openrouter.ai/keys"),apiAddress:G.Schema.string().required().default("https://openrouter.ai/api/v1").description("API Запросить адрес."),triggerWord:G.Schema.string().default("chat").description("Ключевые слова, которые вызывают ответ бота."),model:G.Schema.union(["gpt-3.5-turbo","google/gemini-pro","nousresearch/nous-capybara-7b","mistralai/mistral-7b-instruct","openchat/openchat-7b","rwkv/rwkv-5-world-3b"]).default("gpt-3.5-turbo"),temperature:G.Schema.number().default(1).description("Температура, более высокие значения означают, что модель будет подвергаться большему риску. Для более творческих приложений попробуйте 0,9, а для приложений, где есть четкий ответ, попробуйте 0 (выборка argmax)."),maxTokens:G.Schema.number().default(100).description("Максимальное количество сгенерированных токенов."),topP:G.Schema.number().default(1),frequencyPenalty:G.Schema.number().default(0).description("Значение находится в диапазоне от -2,0 до 2,0. Положительные значения наказывают новые токены на основе их существующей частоты в тексте, уменьшая вероятность того, что модель будет дословно повторять одну и ту же строку."),presencePenalty:G.Schema.number().default(0).description("Значение находится в диапазоне от -2,0 до 2,0. Положительные значения штрафуют новые токены на основе их существующей частоты в тексте, уменьшая вероятность того, что модель будет дословно повторять одну и ту же строку."),stop:G.Schema.array(G.Schema.string()).default(null).description("Сгенерированный текст остановится при обнаружении любого маркера остановки."),errorMessage:G.Schema.string().default("В ответе ошибка, свяжитесь с администратором.。").description("Подсказка при ответе на ошибку."),pictureMode:G.Schema.boolean().default(!1).description("Включите режим изображения."),defaultHeaders:G.Schema.object({"HTTP-Referer":G.Schema.string(),"X-Title":G.Schema.string()}).default({"HTTP-Referer":"https://github.com/seoeaa/koishi-plugin-openrouter-chatgpt","X-Title":"koishi-plugin"})});async function Nf(t,e){let r=new ka.Configuration({apiKey:e.apiKey,basePath:e.apiAddress});if(e.defaultHeaders){let{defaultHeaders:s}=e;r.baseOptions={headers:{...r.baseOptions.headers,"HTTP-Referer":s["HTTP-Referer"],"X-Title":s["X-Title"]}}}let n=new ka.OpenAIApi(r);t.command(e.triggerWord+" <message:text>").action(async({session:s},i)=>{let a=i;s.send("Запрос выполняется, пожалуйста, подождите...");try{return(await n.createChatCompletion({model:e.model,messages:[{role:"system",content:"Ты полезный помошник поэт."},{role:"user",content:a}],temperature:e.temperature,max_tokens:e.maxTokens,top_p:e.topP,frequency_penalty:e.frequencyPenalty,presence_penalty:e.presencePenalty,stop:e.stop})).data.choices[0].message.content}catch(u){return u.response,e.errorMessage}})}Ge.apply=Nf});export default xf();
