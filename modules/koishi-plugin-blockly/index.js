var je=Object.defineProperty;var gt=Object.getOwnPropertyDescriptor;var _t=Object.getOwnPropertyNames;var pt=Object.prototype.hasOwnProperty;var Te=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var F=(e,r)=>()=>(e&&(r=e(e=0)),r);var _=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var se=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of _t(r))!pt.call(e,i)&&i!==t&&je(e,i,{get:()=>r[i],enumerable:!(n=gt(r,i))||n.enumerable});return e},M=(e,r,t)=>(se(e,r,"default"),t&&se(t,r,"default"));var I=e=>se(je({},"__esModule",{value:!0}),e);import{Buffer as f}from"https://registry.koishi.chat/modules/buffer/index.js";import d from"https://registry.koishi.chat/modules/process/index.js";var a=F(()=>{});var D={};import*as nn from"https://registry.koishi.chat/modules/koishi/index.js";var V=F(()=>{a();M(D,nn)});import yt from"https://registry.koishi.chat/modules/@cordiverse/path/index.js";var ce=_((un,Ce)=>{a();Ce.exports=yt});var ge=_(A=>{"use strict";a();Object.defineProperty(A,"__esModule",{value:!0});A.esModuleToCommonJs=A.rewriteImport=void 0;var vt=/\/\*[^]*?\*\//g,ht=/(\bdefault\s+)?\b(let|const|class|function(?:\s*\*)?)(\s+)(\*?\s*[$\w][$\w\s\d,.=]+)([^]*?)$/i,bt=/(^|\s+)export(?!\w)\s*(\{[^{}]*?\}.*?(?=;\n?|$)|[^]*?(?=[\n;]|$))/gi,fe=/\bfrom\s+(["'])([^"']*)\1/gi,Be=/\bdefault(\s+as\s+(\w+))?\b/i,C=/\b(\w+)\s+as\s+(\w+)\b/gi;function de(e){return typeof e=="string"?de(e.replace(/{|}/g,"").split(/\s*,\s*/).map(r=>r.trim())):e.reduce((r,t)=>r.concat(t.split(/\s*,\s*/).map(n=>n.trim())),[])}function mt(e){return e.replace(/[{\s}]+/g,"").split(",").reduce((r,t)=>Object.assign(r,{[t.split(":")[0]]:t.split(":")[1]}),{})}function qt(e,r,t,n){return e=e||"module.exports",r=r||"require",t=t||"Object.assign",(i,u,l)=>{let s=`${u}${e}`;l=l.replace(vt,c=>c.replace(/\S/g," "));let o=l.match(ht);if(o){if(o[2]==="let"||o[2]==="const"){let c=o[4].split("=").filter(Boolean),h="";return c.length!==1&&(h=c[c.length-1],c=c.slice(0,c.length-1)),!o[4].includes("=")&&o[4].includes(",")?`${u}${l};${o[2]==="let"&&n?n("let",de(c),null,e,r,t):`${t}(${e},{${c.join(",")}})`}`:(c[0].includes(",")&&(c=c[0].split(",")),`${u}${o[2]}${o[3]}${c.map(p=>`${p}=${e}.${p.trim()}`).join("=void 0,")}=${h}${o[5]}`)}(o[2]==="class"||o[2].includes("function"))&&(s=s.replace(u,`${u}const ${o[4].split(/[({\s]+/)[0].replace("*","")}=`)),o[1]||(s+=`.${o[4].trim().replace("*","")}`)}let g=l.match(Be);if(l.match(fe)){let c=l.replace(C,"$2").replace(fe,"").replace(/\s+/g,""),h;l=l.replace(fe,(v,ae,oe)=>`=${r}("${h=oe}")`),l=l.replace(C,"$1:$2");let p=l.split("=").pop().trim();return c==="*"?`${s}=${n?n("*",p,h,e,r,t):p}`:g?(g[2]&&(s+=`.${g[2]}`),`${s}=${n?n("default",p,h,e,r,t):p}`):`${u}const ${l};${n?n("const",de(c),h,e,r,t):`${t}(${e},${c})`}`}return g?o||!l.match(C)?l=l.replace(Be,"").trim():l=l.match(C)[0].split(" ").shift():l=l.replace(C,"$2:$1"),!g&&l.charAt()==="{"?l.includes("}")?`${u}${n?n("object",mt(l),null,e,r,t):`${t}(${e},${l.replace(/\s+/g,"")})`}`:`${u}${e}=${l}`:`${s}=${l}`}}var wt=(e,r,t,n,i)=>e.replace(bt,qt(r,t,n,i));function Le(e,r){for(var t=[];e.length;)t.push(e.shift().trim().replace(/ as /g,":"));return"const { "+t.join(", ")+" } = "+r}function $t(e,r,t){return e.length&&!t?Le(e,r):"const "+t+" = "+r+(e.length?`;
`+Le(e,t):"")}function Ne(e,r){return r=r||"require",e.replace(/(^|;\s*|\r?\n+)import\s*((?:\*\s*as)?\s*([a-z$_][\w$]*)?\s*,?\s*(?:{([\s\S]*?)})?)?\s*(from)?\s*(['"`][^'"`]+['"`])(?=;?)(?=([^"'`]*["'`][^"'`]*["'`])*[^"'`]*$)/gi,function(t,n,i,u,l,s,o){return o=r+"("+o+")",(n||"")+(s?$t(l?l.split(","):[],o,u):o)})}A.rewriteImport=Ne;function Mt(e){return Ne(wt(e))}A.esModuleToCommonJs=Mt});var pe=_(z=>{"use strict";a();Object.defineProperty(z,"__esModule",{value:!0});z.PluginManager=void 0;var Ot=(V(),I(D)),Pt=ge(),_e=class{constructor(r){this.ctx=r,this.plugins=[],this.runningPlugins=[],this.restart(),this.logger=this.ctx.logger("blockly")}restart(){if(this.runningPlugins.forEach(r=>r.dispose()),this.runningPlugins=[],this.plugins.length==0){this.logger?.info("No plugin loaded");return}this.logger.info("Loading "+this.plugins.length+" plugin(s)"),this.plugins.forEach(r=>{let t={};t.module={exports:{}},t.require=Te,t.segment=Ot.segment;let n=null;try{let i=`const {${Object.keys(t).join(",")}} = this;${(0,Pt.esModuleToCommonJs)(r)}`;new Function(i).call(t),n=t.module.exports}catch(i){this.ctx.logger("blockly").warn(i)}n&&n.apply&&this.runningPlugins.push(this.ctx.plugin(n))}),this.logger.info("Loaded "+this.runningPlugins.length+" plugin(s)")}};z.PluginManager=_e});var ve=_(J=>{"use strict";a();Object.defineProperty(J,"__esModule",{value:!0});J.BlocklyService=void 0;var Dt=(V(),I(D)),Rt=pe(),ye=class extends Dt.Service{constructor(r){super(r,"blockly"),this.vendors={},this.manager=new Rt.PluginManager(r)}async reload(r){r&&(this.manager.plugins=(await this.ctx.database.get("blockly",{enabled:!0},["code","enabled"])).filter(t=>t.enabled).map(t=>t.code),this.manager.restart()),this.ctx["console.blockly"]&&await this.ctx["console.blockly"].refresh()}async registerVendor(r){this.vendors[r.id]=r,this.ctx["console.blockly_console"]&&await this.ctx["console.blockly_console"].patch(Object.fromEntries([[r.id,r]]))}};J.BlocklyService=ye});var k={};import*as yn from"https://registry.koishi.chat/modules/@koishijs/plugin-console/index.js";var he=F(()=>{a();M(k,yn)});var me=_(be=>{"use strict";a();Object.defineProperty(be,"__esModule",{value:!0});be.default=kt;var W,St=new Uint8Array(16);function kt(){if(!W&&(W=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!W))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return W(St)}});var Fe=_(H=>{"use strict";a();Object.defineProperty(H,"__esModule",{value:!0});H.default=void 0;var Ut=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;H.default=Ut});var B=_(K=>{"use strict";a();Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;var It=At(Fe());function At(e){return e&&e.__esModule?e:{default:e}}function Et(e){return typeof e=="string"&&It.default.test(e)}var jt=Et;K.default=jt});var N=_(L=>{"use strict";a();Object.defineProperty(L,"__esModule",{value:!0});L.default=void 0;L.unsafeStringify=Ve;var Tt=Ct(B());function Ct(e){return e&&e.__esModule?e:{default:e}}var b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function Ve(e,r=0){return b[e[r+0]]+b[e[r+1]]+b[e[r+2]]+b[e[r+3]]+"-"+b[e[r+4]]+b[e[r+5]]+"-"+b[e[r+6]]+b[e[r+7]]+"-"+b[e[r+8]]+b[e[r+9]]+"-"+b[e[r+10]]+b[e[r+11]]+b[e[r+12]]+b[e[r+13]]+b[e[r+14]]+b[e[r+15]]}function Bt(e,r=0){let t=Ve(e,r);if(!(0,Tt.default)(t))throw TypeError("Stringified UUID is invalid");return t}var Lt=Bt;L.default=Lt});var Je=_(X=>{"use strict";a();Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var Nt=Vt(me()),Ft=N();function Vt(e){return e&&e.__esModule?e:{default:e}}var ze,qe,we=0,$e=0;function zt(e,r,t){let n=r&&t||0,i=r||new Array(16);e=e||{};let u=e.node||ze,l=e.clockseq!==void 0?e.clockseq:qe;if(u==null||l==null){let p=e.random||(e.rng||Nt.default)();u==null&&(u=ze=[p[0]|1,p[1],p[2],p[3],p[4],p[5]]),l==null&&(l=qe=(p[6]<<8|p[7])&16383)}let s=e.msecs!==void 0?e.msecs:Date.now(),o=e.nsecs!==void 0?e.nsecs:$e+1,g=s-we+(o-$e)/1e4;if(g<0&&e.clockseq===void 0&&(l=l+1&16383),(g<0||s>we)&&e.nsecs===void 0&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");we=s,$e=o,qe=l,s+=122192928e5;let c=((s&268435455)*1e4+o)%4294967296;i[n++]=c>>>24&255,i[n++]=c>>>16&255,i[n++]=c>>>8&255,i[n++]=c&255;let h=s/4294967296*1e4&268435455;i[n++]=h>>>8&255,i[n++]=h&255,i[n++]=h>>>24&15|16,i[n++]=h>>>16&255,i[n++]=l>>>8|128,i[n++]=l&255;for(let p=0;p<6;++p)i[n+p]=u[p];return r||(0,Ft.unsafeStringify)(i)}var Jt=zt;X.default=Jt});var Me=_(Y=>{"use strict";a();Object.defineProperty(Y,"__esModule",{value:!0});Y.default=void 0;var Wt=Ht(B());function Ht(e){return e&&e.__esModule?e:{default:e}}function Kt(e){if(!(0,Wt.default)(e))throw TypeError("Invalid UUID");let r,t=new Uint8Array(16);return t[0]=(r=parseInt(e.slice(0,8),16))>>>24,t[1]=r>>>16&255,t[2]=r>>>8&255,t[3]=r&255,t[4]=(r=parseInt(e.slice(9,13),16))>>>8,t[5]=r&255,t[6]=(r=parseInt(e.slice(14,18),16))>>>8,t[7]=r&255,t[8]=(r=parseInt(e.slice(19,23),16))>>>8,t[9]=r&255,t[10]=(r=parseInt(e.slice(24,36),16))/1099511627776&255,t[11]=r/4294967296&255,t[12]=r>>>24&255,t[13]=r>>>16&255,t[14]=r>>>8&255,t[15]=r&255,t}var Xt=Kt;Y.default=Xt});var Oe=_(U=>{"use strict";a();Object.defineProperty(U,"__esModule",{value:!0});U.URL=U.DNS=void 0;U.default=xt;var Yt=N(),Gt=Qt(Me());function Qt(e){return e&&e.__esModule?e:{default:e}}function Zt(e){e=unescape(encodeURIComponent(e));let r=[];for(let t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}var We="6ba7b810-9dad-11d1-80b4-00c04fd430c8";U.DNS=We;var He="6ba7b811-9dad-11d1-80b4-00c04fd430c8";U.URL=He;function xt(e,r,t){function n(i,u,l,s){var o;if(typeof i=="string"&&(i=Zt(i)),typeof u=="string"&&(u=(0,Gt.default)(u)),((o=u)===null||o===void 0?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let g=new Uint8Array(16+i.length);if(g.set(u),g.set(i,u.length),g=t(g),g[6]=g[6]&15|r,g[8]=g[8]&63|128,l){s=s||0;for(let c=0;c<16;++c)l[s+c]=g[c];return l}return(0,Yt.unsafeStringify)(g)}try{n.name=e}catch{}return n.DNS=We,n.URL=He,n}});var Xe=_(Q=>{"use strict";a();Object.defineProperty(Q,"__esModule",{value:!0});Q.default=void 0;function er(e){if(typeof e=="string"){let r=unescape(encodeURIComponent(e));e=new Uint8Array(r.length);for(let t=0;t<r.length;++t)e[t]=r.charCodeAt(t)}return tr(rr(nr(e),e.length*8))}function tr(e){let r=[],t=e.length*32,n="0123456789abcdef";for(let i=0;i<t;i+=8){let u=e[i>>5]>>>i%32&255,l=parseInt(n.charAt(u>>>4&15)+n.charAt(u&15),16);r.push(l)}return r}function Ke(e){return(e+64>>>9<<4)+14+1}function rr(e,r){e[r>>5]|=128<<r%32,e[Ke(r)-1]=r;let t=1732584193,n=-271733879,i=-1732584194,u=271733878;for(let l=0;l<e.length;l+=16){let s=t,o=n,g=i,c=u;t=m(t,n,i,u,e[l],7,-680876936),u=m(u,t,n,i,e[l+1],12,-389564586),i=m(i,u,t,n,e[l+2],17,606105819),n=m(n,i,u,t,e[l+3],22,-1044525330),t=m(t,n,i,u,e[l+4],7,-176418897),u=m(u,t,n,i,e[l+5],12,1200080426),i=m(i,u,t,n,e[l+6],17,-1473231341),n=m(n,i,u,t,e[l+7],22,-45705983),t=m(t,n,i,u,e[l+8],7,1770035416),u=m(u,t,n,i,e[l+9],12,-1958414417),i=m(i,u,t,n,e[l+10],17,-42063),n=m(n,i,u,t,e[l+11],22,-1990404162),t=m(t,n,i,u,e[l+12],7,1804603682),u=m(u,t,n,i,e[l+13],12,-40341101),i=m(i,u,t,n,e[l+14],17,-1502002290),n=m(n,i,u,t,e[l+15],22,1236535329),t=q(t,n,i,u,e[l+1],5,-165796510),u=q(u,t,n,i,e[l+6],9,-1069501632),i=q(i,u,t,n,e[l+11],14,643717713),n=q(n,i,u,t,e[l],20,-373897302),t=q(t,n,i,u,e[l+5],5,-701558691),u=q(u,t,n,i,e[l+10],9,38016083),i=q(i,u,t,n,e[l+15],14,-660478335),n=q(n,i,u,t,e[l+4],20,-405537848),t=q(t,n,i,u,e[l+9],5,568446438),u=q(u,t,n,i,e[l+14],9,-1019803690),i=q(i,u,t,n,e[l+3],14,-187363961),n=q(n,i,u,t,e[l+8],20,1163531501),t=q(t,n,i,u,e[l+13],5,-1444681467),u=q(u,t,n,i,e[l+2],9,-51403784),i=q(i,u,t,n,e[l+7],14,1735328473),n=q(n,i,u,t,e[l+12],20,-1926607734),t=w(t,n,i,u,e[l+5],4,-378558),u=w(u,t,n,i,e[l+8],11,-2022574463),i=w(i,u,t,n,e[l+11],16,1839030562),n=w(n,i,u,t,e[l+14],23,-35309556),t=w(t,n,i,u,e[l+1],4,-1530992060),u=w(u,t,n,i,e[l+4],11,1272893353),i=w(i,u,t,n,e[l+7],16,-155497632),n=w(n,i,u,t,e[l+10],23,-1094730640),t=w(t,n,i,u,e[l+13],4,681279174),u=w(u,t,n,i,e[l],11,-358537222),i=w(i,u,t,n,e[l+3],16,-722521979),n=w(n,i,u,t,e[l+6],23,76029189),t=w(t,n,i,u,e[l+9],4,-640364487),u=w(u,t,n,i,e[l+12],11,-421815835),i=w(i,u,t,n,e[l+15],16,530742520),n=w(n,i,u,t,e[l+2],23,-995338651),t=$(t,n,i,u,e[l],6,-198630844),u=$(u,t,n,i,e[l+7],10,1126891415),i=$(i,u,t,n,e[l+14],15,-1416354905),n=$(n,i,u,t,e[l+5],21,-57434055),t=$(t,n,i,u,e[l+12],6,1700485571),u=$(u,t,n,i,e[l+3],10,-1894986606),i=$(i,u,t,n,e[l+10],15,-1051523),n=$(n,i,u,t,e[l+1],21,-2054922799),t=$(t,n,i,u,e[l+8],6,1873313359),u=$(u,t,n,i,e[l+15],10,-30611744),i=$(i,u,t,n,e[l+6],15,-1560198380),n=$(n,i,u,t,e[l+13],21,1309151649),t=$(t,n,i,u,e[l+4],6,-145523070),u=$(u,t,n,i,e[l+11],10,-1120210379),i=$(i,u,t,n,e[l+2],15,718787259),n=$(n,i,u,t,e[l+9],21,-343485551),t=R(t,s),n=R(n,o),i=R(i,g),u=R(u,c)}return[t,n,i,u]}function nr(e){if(e.length===0)return[];let r=e.length*8,t=new Uint32Array(Ke(r));for(let n=0;n<r;n+=8)t[n>>5]|=(e[n/8]&255)<<n%32;return t}function R(e,r){let t=(e&65535)+(r&65535);return(e>>16)+(r>>16)+(t>>16)<<16|t&65535}function ir(e,r){return e<<r|e>>>32-r}function G(e,r,t,n,i,u){return R(ir(R(R(r,e),R(n,u)),i),t)}function m(e,r,t,n,i,u,l){return G(r&t|~r&n,e,r,i,u,l)}function q(e,r,t,n,i,u,l){return G(r&n|t&~n,e,r,i,u,l)}function w(e,r,t,n,i,u,l){return G(r^t^n,e,r,i,u,l)}function $(e,r,t,n,i,u,l){return G(t^(r|~n),e,r,i,u,l)}var lr=er;Q.default=lr});var Ge=_(Z=>{"use strict";a();Object.defineProperty(Z,"__esModule",{value:!0});Z.default=void 0;var ur=Ye(Oe()),ar=Ye(Xe());function Ye(e){return e&&e.__esModule?e:{default:e}}var or=(0,ur.default)("v3",48,ar.default),sr=or;Z.default=sr});var Qe=_(x=>{"use strict";a();Object.defineProperty(x,"__esModule",{value:!0});x.default=void 0;var cr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fr={randomUUID:cr};x.default=fr});var et=_(ee=>{"use strict";a();Object.defineProperty(ee,"__esModule",{value:!0});ee.default=void 0;var Ze=xe(Qe()),dr=xe(me()),gr=N();function xe(e){return e&&e.__esModule?e:{default:e}}function _r(e,r,t){if(Ze.default.randomUUID&&!r&&!e)return Ze.default.randomUUID();e=e||{};let n=e.random||(e.rng||dr.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,r){t=t||0;for(let i=0;i<16;++i)r[t+i]=n[i];return r}return(0,gr.unsafeStringify)(n)}var pr=_r;ee.default=pr});var tt=_(te=>{"use strict";a();Object.defineProperty(te,"__esModule",{value:!0});te.default=void 0;function yr(e,r,t,n){switch(e){case 0:return r&t^~r&n;case 1:return r^t^n;case 2:return r&t^r&n^t&n;case 3:return r^t^n}}function Pe(e,r){return e<<r|e>>>32-r}function vr(e){let r=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){let l=unescape(encodeURIComponent(e));e=[];for(let s=0;s<l.length;++s)e.push(l.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=e.length/4+2,i=Math.ceil(n/16),u=new Array(i);for(let l=0;l<i;++l){let s=new Uint32Array(16);for(let o=0;o<16;++o)s[o]=e[l*64+o*4]<<24|e[l*64+o*4+1]<<16|e[l*64+o*4+2]<<8|e[l*64+o*4+3];u[l]=s}u[i-1][14]=(e.length-1)*8/Math.pow(2,32),u[i-1][14]=Math.floor(u[i-1][14]),u[i-1][15]=(e.length-1)*8&4294967295;for(let l=0;l<i;++l){let s=new Uint32Array(80);for(let v=0;v<16;++v)s[v]=u[l][v];for(let v=16;v<80;++v)s[v]=Pe(s[v-3]^s[v-8]^s[v-14]^s[v-16],1);let o=t[0],g=t[1],c=t[2],h=t[3],p=t[4];for(let v=0;v<80;++v){let ae=Math.floor(v/20),oe=Pe(o,5)+yr(ae,g,c,h)+p+r[ae]+s[v]>>>0;p=h,h=c,c=Pe(g,30)>>>0,g=o,o=oe}t[0]=t[0]+o>>>0,t[1]=t[1]+g>>>0,t[2]=t[2]+c>>>0,t[3]=t[3]+h>>>0,t[4]=t[4]+p>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var hr=vr;te.default=hr});var nt=_(re=>{"use strict";a();Object.defineProperty(re,"__esModule",{value:!0});re.default=void 0;var br=rt(Oe()),mr=rt(tt());function rt(e){return e&&e.__esModule?e:{default:e}}var qr=(0,br.default)("v5",80,mr.default),wr=qr;re.default=wr});var it=_(ne=>{"use strict";a();Object.defineProperty(ne,"__esModule",{value:!0});ne.default=void 0;var $r="00000000-0000-0000-0000-000000000000";ne.default=$r});var lt=_(ie=>{"use strict";a();Object.defineProperty(ie,"__esModule",{value:!0});ie.default=void 0;var Mr=Or(B());function Or(e){return e&&e.__esModule?e:{default:e}}function Pr(e){if(!(0,Mr.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var Dr=Pr;ie.default=Dr});var De=_(O=>{"use strict";a();Object.defineProperty(O,"__esModule",{value:!0});Object.defineProperty(O,"NIL",{enumerable:!0,get:function(){return Ir.default}});Object.defineProperty(O,"parse",{enumerable:!0,get:function(){return Tr.default}});Object.defineProperty(O,"stringify",{enumerable:!0,get:function(){return jr.default}});Object.defineProperty(O,"v1",{enumerable:!0,get:function(){return Rr.default}});Object.defineProperty(O,"v3",{enumerable:!0,get:function(){return Sr.default}});Object.defineProperty(O,"v4",{enumerable:!0,get:function(){return kr.default}});Object.defineProperty(O,"v5",{enumerable:!0,get:function(){return Ur.default}});Object.defineProperty(O,"validate",{enumerable:!0,get:function(){return Er.default}});Object.defineProperty(O,"version",{enumerable:!0,get:function(){return Ar.default}});var Rr=P(Je()),Sr=P(Ge()),kr=P(et()),Ur=P(nt()),Ir=P(it()),Ar=P(lt()),Er=P(B()),jr=P(N()),Tr=P(Me());function P(e){return e&&e.__esModule?e:{default:e}}});var Se=_(E=>{"use strict";a();Object.defineProperty(E,"__esModule",{value:!0});E.initializeDatabase=E.BlocklyProvider=void 0;var Cr=(he(),I(k)),Br=De(),Re=class extends Cr.DataService{constructor(r){super(r,"blockly")}async get(){return await this.ctx.database.get("blockly",{id:{$not:-1}},["id","name","enabled","edited","uuid"])}};E.BlocklyProvider=Re;async function Lr(e){e.database.extend("blockly",{id:"integer",name:"string",body:"text",code:"text",enabled:"boolean",edited:"boolean",uuid:"string"},{autoInc:!0});let r=await e.database.get("blockly",{id:{$not:-1}}),t=e.logger("blockly");for(let n of r)if(!n.uuid){let i=(0,Br.v4)();t.info(`block ${n.id} has no uuid ->  ${i}`),await e.database.set("blockly",n.id,{uuid:i})}}E.initializeDatabase=Lr});var ke=_(le=>{"use strict";a();Object.defineProperty(le,"__esModule",{value:!0});le.initializeConsoleApiBacked=void 0;var Nr=De();function Fr(e){e.console.addListener("load-blockly-block",async r=>JSON.parse((await e.database.get("blockly",r,["body"]))[0].body),{authority:5}),e.console.addListener("save-blockly-block",async(r,t)=>{let n={};t.body&&(n.body=JSON.stringify(t.body)),t.code&&(n.code=t.code),t.name&&(n.name=t.name),n.edited=!t.code,await e.database.set("blockly",r,n),setTimeout(()=>e.blockly.reload(!!t.code),0)},{authority:5}),e.console.addListener("rename-blockly-block",async(r,t)=>{await e.database.set("blockly",r,{name:t}),await e.blockly.reload()},{authority:5}),e.console.addListener("rename-blockly-block",async(r,t)=>{await e.database.set("blockly",r,{name:t}),await e.blockly.reload()},{authority:5}),e.console.addListener("delete-blockly-block",async r=>{await e.database.remove("blockly",{id:r}),await e.blockly.reload()},{authority:5}),e.console.addListener("create-blockly-block",async r=>{if(r){let n=await e.database.get("blockly",{uuid:r},["id"]);if(n.length>0)return n[0].id}let t=await e.database.create("blockly",{name:"未命名Koishi代码",code:"",body:"{}",enabled:!1,edited:!1,uuid:r??(0,Nr.v4)()});return await e.blockly.reload(),t.id},{authority:5}),e.console.addListener("set-blockly-block-state",async(r,t)=>{await e.database.set("blockly",r,{enabled:t}),await e.blockly.reload(!0)},{authority:5})}le.initializeConsoleApiBacked=Fr});var j={};import*as ei from"https://registry.koishi.chat/modules/@cordiverse/fs/index.js";var ut=F(()=>{a();M(j,ei)});var Ie=_(T=>{"use strict";a();var ot=T&&T.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});T.registerStaticFileRoute=void 0;var Ue=ot(ce()),at=ot((ut(),I(j)));function Vr(e){e.router.get(/\/static\/blockly\/([a-z0-9-]+.[a-z0-9]+)/,async function(r){let t=Ue.default.resolve(import.meta.url,"../media/"+r.params[0]);Ue.default.relative(Ue.default.resolve(import.meta.url+"/../"),t).startsWith("..")||at.default.existsSync(t)&&(r.body=await at.default.promises.readFile(t))})}T.registerStaticFileRoute=Vr});var Ee=_(ue=>{"use strict";a();Object.defineProperty(ue,"__esModule",{value:!0});ue.BlocklyVendorDataService=void 0;var zr=(he(),I(k)),Ae=class extends zr.DataService{constructor(r){super(r,"blockly_vendors")}async get(){return this.ctx.blockly.vendors}};ue.BlocklyVendorDataService=Ae});var ct=_(st=>{"use strict";a();Object.defineProperty(st,"__esModule",{value:!0})});var Qr=_(y=>{a();var Jr=y&&y.__createBinding||(Object.create?function(e,r,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(r,t);(!i||("get"in i?!r.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,i)}:function(e,r,t,n){n===void 0&&(n=t),e[n]=r[t]}),S=y&&y.__exportStar||function(e,r){for(var t in e)t!=="default"&&!Object.prototype.hasOwnProperty.call(r,t)&&Jr(r,e,t)};Object.defineProperty(y,"__esModule",{value:!0});y.apply=y.using=y.Config=y.name=void 0;var Wr=(V(),I(D)),ft=ce(),Hr=ve(),dt=Se(),Kr=ke(),Xr=Ie(),Yr=Ee();y.name="blockly";y.Config=Wr.Schema.object({});y.using=["database","console"];async function Gr(e){e.plugin(Hr.BlocklyService),e.plugin(dt.BlocklyProvider),e.using(["blockly"],()=>e.plugin(Yr.BlocklyVendorDataService)),await(0,dt.initializeDatabase)(e),e.using(["console","blockly"],r=>{r.console.addEntry({dev:(0,ft.resolve)(import.meta.url,"../client/index.ts"),prod:(0,ft.resolve)(import.meta.url,"../dist")}),r.blockly.reload(!0)}),(0,Kr.initializeConsoleApiBacked)(e),(0,Xr.registerStaticFileRoute)(e)}y.apply=Gr;S(ct(),y);S(Se(),y);S(pe(),y);S(ve(),y);S(Ie(),y);S(ke(),y);S(ge(),y);S(Ee(),y)});export default Qr();
