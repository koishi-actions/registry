var w=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var u=(r,e)=>()=>(r&&(e=r(r=0)),e);var O=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var b=(r,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of A(e))!N.call(r,o)&&o!==a&&w(r,o,{get:()=>e[o],enumerable:!(s=k(e,o))||s.enumerable});return r},t=(r,e,a)=>(b(r,e,"default"),a&&b(a,e,"default"));var f=r=>b(w({},"__esModule",{value:!0}),r);import{Buffer as l}from"https://registry.koishi.chat/modules/buffer/index.js";import p from"https://registry.koishi.chat/modules/process/index.js";var i=u(()=>{});var c={};import*as te from"https://registry.koishi.chat/modules/koishi/index.js";var P=u(()=>{i();t(c,te)});var m={};import*as ie from"https://registry.koishi.chat/modules/@koishijs/console/index.js";var j=u(()=>{i();t(m,ie)});var _={};import*as ne from"https://registry.koishi.chat/modules/@cordiverse/fs/promises/index.js";var I=u(()=>{i();t(_,ne)});import $ from"https://registry.koishi.chat/modules/@cordiverse/path/index.js";var L=O((pe,x)=>{i();x.exports=$});var d={};import*as _e from"https://registry.koishi.chat/modules/js-yaml/index.js";var q=u(()=>{i();t(d,_e)});var X=O((ve,K)=>{i();var g=Object.defineProperty,F=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyNames,M=Object.prototype.hasOwnProperty,C=(r,e)=>g(r,"name",{value:e,configurable:!0}),V=(r,e)=>{for(var a in e)g(r,a,{get:e[a],enumerable:!0})},W=(r,e,a,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of J(e))!M.call(r,o)&&o!==a&&g(r,o,{get:()=>e[o],enumerable:!(s=F(e,o))||s.enumerable});return r},z=r=>W(g({},"__esModule",{value:!0}),r),D={};V(D,{Config:()=>U,apply:()=>H,name:()=>T});K.exports=z(D);var v=(P(),f(c)),G=(j(),f(m)),y=(I(),f(_)),S=L(),E=(q(),f(d)),Q=new v.Logger("locales"),B=class extends G.DataService{constructor(e,a){super(e,"locales",{authority:4}),this.config=a;let s=e.debounce(()=>this.refresh(),0);e.on("internal/i18n",s),e.console.addEntry(["https://registry.koishi.chat/modules/@koishijs/plugin-locales/dist/index.js","https://registry.koishi.chat/modules/@koishijs/plugin-locales/dist/style.css"]),e.console.addListener("l10n",async o=>{for(let n in o){e.i18n.define("$"+n,o[n]);let h=(0,E.dump)(o[n]);await(0,y.writeFile)((0,S.resolve)(e.baseDir,a.root[0],n+".yml"),h)}})}async get(){return this.ctx.i18n._data}};C(B,"LocaleProvider");var R=B,T="locales",U=v.Schema.object({root:v.Schema.union([v.Schema.array(v.Schema.path({filters:["directory"],allowCreate:!0})),v.Schema.transform(String,r=>[r])]).default(["data/locales","locales"]).description("存放本地化文件的根目录。")});async function H(r,e){for(let a of e.root.slice().reverse()){let s=(0,S.resolve)(r.baseDir,a);await(0,y.mkdir)(s,{recursive:!0});let o=await(0,y.readdir)(s);for(let n of o){if(!n.endsWith(".yml"))continue;Q.debug("loading locale %s",n);let h=await(0,y.readFile)((0,S.resolve)(s,n),"utf8");r.i18n.define("$"+n.split(".")[0],(0,E.load)(h))}}r.plugin(R,e)}C(H,"apply")});export default X();
