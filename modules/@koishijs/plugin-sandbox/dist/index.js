import{defineComponent as _e,computed as se,openBlock as V,createElementBlock as E,createElementVNode as M,withKeys as He,withModifiers as Le,h as U,toDisplayString as J,unref as B,createVNode as R,createCommentVNode as me,ref as T,watch as Se,resolveComponent as K,createBlock as X,withCtx as W,Fragment as Ae,renderList as Pe,normalizeClass as qe,KeepAlive as Ke}from"vue";import{useStorage as We,receive as be,send as Y,useMenu as Ye,useContext as Ge,Schema as $e,clone as Oe,deepEqual as Ze,VirtualList as Je,message as Qe,icons as Te}from"@koishijs/client";import{useEventListener as De}from"@vueuse/core";var Xe=Object.defineProperty,m=(e,t)=>Xe(e,"name",{value:t,configurable:true});function et(){}m(et,"noop");function I(e){return e==null}m(I,"isNullable");function tt(e){return e&&typeof e=="object"&&!Array.isArray(e)}m(tt,"isPlainObject");function nt(e,t){return Object.fromEntries(Object.entries(e).filter(([a,l])=>t(a,l)))}m(nt,"filterKeys");function Ve(e,t){return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,t(l,a)]))}m(Ve,"mapValues");function rt(e,t,a){if(!t)return{...e};const l={};for(const u of t)(a||e[u]!==void 0)&&(l[u]=e[u]);return l}m(rt,"pick");function at(e,t){if(!t)return{...e};const a={...e};for(const l of t)Reflect.deleteProperty(a,l);return a}m(at,"omit");function he(e,t,a){return Object.defineProperty(e,t,{writable:true,value:a,enumerable:false})}m(he,"defineProperty");function st(e,t){return t.every(a=>e.includes(a))}m(st,"contain");function ot(e,t){return e.filter(a=>t.includes(a))}m(ot,"intersection");function it(e,t){return e.filter(a=>!t.includes(a))}m(it,"difference");function lt(e,t){return Array.from(new Set([...e,...t]))}m(lt,"union");function ut(e){return[...new Set(e)]}m(ut,"deduplicate");function ft(e,t){const a=e.indexOf(t);return a>=0?(e.splice(a,1),true):false}m(ft,"remove");function ze(e){return Array.isArray(e)?e:I(e)?[]:[e]}m(ze,"makeArray");function N(e,t){return arguments.length===1?a=>N(e,a):e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}m(N,"is");function ne(e){return N("ArrayBuffer",e)||N("SharedArrayBuffer",e)}m(ne,"isArrayBufferLike");function Ie(e){return ne(e)||ArrayBuffer.isView(e)}m(Ie,"isArrayBufferSource");var H;(e=>{e.is=ne,e.isSource=Ie;function t(h){return ArrayBuffer.isView(h)?h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength):h}e.fromSource=t,m(t,"fromSource");function a(h){if(typeof Buffer<"u")return Buffer.from(h).toString("base64");let s="";const f=new Uint8Array(h);for(let c=0;c<f.byteLength;c++)s+=String.fromCharCode(f[c]);return btoa(s)}e.toBase64=a,m(a,"toBase64");function l(h){return typeof Buffer<"u"?t(Buffer.from(h,"base64")):Uint8Array.from(atob(h),s=>s.charCodeAt(0))}e.fromBase64=l,m(l,"fromBase64");function u(h){return typeof Buffer<"u"?Buffer.from(h).toString("hex"):Array.from(new Uint8Array(h),s=>s.toString(16).padStart(2,"0")).join("")}e.toHex=u,m(u,"toHex");function x(h){if(typeof Buffer<"u")return t(Buffer.from(h,"hex"));const s=h.length%2===0?h:h.slice(0,h.length-1),f=[];for(let c=0;c<s.length;c+=2)f.push(parseInt(`${s[c]}${s[c+1]}`,16));return Uint8Array.from(f).buffer}e.fromHex=x,m(x,"fromHex")})(H||(H={}));H.fromBase64;H.toBase64;H.fromHex;H.toHex;function ve(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(ve):N("Date",e)?new Date(e.valueOf()):N("RegExp",e)?new RegExp(e.source,e.flags):ne(e)?e.slice(0):ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):Ve(e,ve)}m(ve,"clone");function ye(e,t,a){if(e===t||!a&&I(e)&&I(t))return true;if(typeof e!=typeof t||typeof e!="object"||!e||!t)return false;function l(u,x){return u(e)?u(t)?x(e,t):false:u(t)?false:void 0}return m(l,"check"),l(Array.isArray,(u,x)=>u.length===x.length&&u.every((h,s)=>ye(h,x[s])))??l(N("Date"),(u,x)=>u.valueOf()===x.valueOf())??l(N("RegExp"),(u,x)=>u.source===x.source&&u.flags===x.flags)??l(ne,(u,x)=>{if(u.byteLength!==x.byteLength)return false;const h=new Uint8Array(u),s=new Uint8Array(x);for(let f=0;f<h.length;f++)if(h[f]!==s[f])return false;return true})??Object.keys({...e,...t}).every(u=>ye(e[u],t[u],a))}m(ye,"deepEqual");function ct(e){return e.charAt(0).toUpperCase()+e.slice(1)}m(ct,"capitalize");function xe(e){return e.charAt(0).toLowerCase()+e.slice(1)}m(xe,"uncapitalize");function Ne(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}m(Ne,"camelCase");function Fe(e){return xe(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}m(Fe,"paramCase");function pt(e){return xe(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}m(pt,"snakeCase");var dt=Ne,gt=Fe;function Ue(e){return e.replace(/\/$/,"")}m(Ue,"trimSlash");function mt(e){return e.startsWith("/")||(e="/"+e),Ue(e)}m(mt,"sanitize");var je;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function a(p){t=p}e.setTimezoneOffset=a,m(a,"setTimezoneOffset");function l(){return t}e.getTimezoneOffset=l,m(l,"getTimezoneOffset");function u(p=new Date,d){return typeof p=="number"&&(p=new Date(p)),d===void 0&&(d=t),Math.floor((p.valueOf()/e.minute-d)/1440)}e.getDateNumber=u,m(u,"getDateNumber");function x(p,d){const g=new Date(p*e.day);return d===void 0&&(d=t),new Date(+g+d*e.minute)}e.fromDateNumber=x,m(x,"fromDateNumber");const h=/\d+(?:\.\d+)?/.source,s=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(p=>`(${h}${p})?`).join("")}$`);function f(p){const d=s.exec(p);return d?(parseFloat(d[1])*e.week||0)+(parseFloat(d[2])*e.day||0)+(parseFloat(d[3])*e.hour||0)+(parseFloat(d[4])*e.minute||0)+(parseFloat(d[5])*e.second||0):0}e.parseTime=f,m(f,"parseTime");function c(p){const d=f(p);return d?p=Date.now()+d:/^\d{1,2}(:\d{1,2}){1,2}$/.test(p)?p=`${new Date().toLocaleDateString()}-${p}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(p)&&(p=`${new Date().getFullYear()}-${p}`),p?new Date(p):new Date}e.parseDate=c,m(c,"parseDate");function S(p){const d=Math.abs(p);return d>=e.day-e.hour/2?Math.round(p/e.day)+"d":d>=e.hour-e.minute/2?Math.round(p/e.hour)+"h":d>=e.minute-e.second/2?Math.round(p/e.minute)+"m":d>=e.second?Math.round(p/e.second)+"s":p+"ms"}e.format=S,m(S,"format");function b(p,d=2){return p.toString().padStart(d,"0")}e.toDigits=b,m(b,"toDigits");function D(p,d=new Date){return p.replace("yyyy",d.getFullYear().toString()).replace("yy",d.getFullYear().toString().slice(2)).replace("MM",b(d.getMonth()+1)).replace("dd",b(d.getDate())).replace("hh",b(d.getHours())).replace("mm",b(d.getMinutes())).replace("ss",b(d.getSeconds())).replace("SSS",b(d.getMilliseconds(),3))}e.template=D,m(D,"template")})(je||(je={}));var ht=Object.defineProperty,vt=Object.getOwnPropertyNames,w=(e,t)=>ht(e,"name",{value:t,configurable:true}),yt=(e,t)=>function(){return t||(0,e[vt(e)[0]])((t={exports:{}}).exports,t),t.exports},_t=yt({"src/index.ts"(e,t){var h;var a=Symbol.for("satori.element"),l=(h=class{get data(){return this.attrs}getTagName(){var f;return this.type==="component"?((f=this.attrs.is)==null?void 0:f.name)??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([f,c])=>I(c)?"":(f=gt(f),c===true?` ${f}`:c===false?` no-${f}`:` ${f}="${u.escape(""+c,true)}"`)).join("")}toString(f=false){if(this.type==="text"&&"content"in this.attrs)return f?this.attrs.content:u.escape(this.attrs.content);const c=this.children.map(D=>D.toString(f)).join("");if(f)return c;const S=this.toAttrString(),b=this.getTagName();return this.children.length?`<${b}${S}>${c}</${b}>`:`<${b}${S}/>`}},w(h,"ElementConstructor"),h);he(l,"name","Element"),he(l.prototype,a,true);function u(s,...f){const c=Object.create(l.prototype),S={},b=[];if(f[0]&&typeof f[0]=="object"&&!u.isElement(f[0])&&!Array.isArray(f[0])){const D=f.shift();for(const[p,d]of Object.entries(D))I(d)||(p==="children"?f.push(...ze(d)):S[dt(p)]=d)}for(const D of f)b.push(...u.toElementArray(D));return typeof s=="function"&&(S.is=s,s="component"),Object.assign(c,{type:s,attrs:S,children:b})}w(u,"Element");var x=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(s=>{s.jsx=s,s.jsxs=s,s.jsxDEV=s,s.Fragment="template";function f(r){return r&&typeof r=="object"&&r[a]}s.isElement=f,w(f,"isElement");function c(r){if(typeof r=="string"||typeof r=="number"||typeof r=="boolean"){if(r=""+r,r)return s("text",{content:r})}else{if(f(r))return r;if(!I(r))throw new TypeError(`Invalid content: ${r}`)}}s.toElement=c,w(c,"toElement");function S(r){return Array.isArray(r)?r.map(c).filter(n=>n):[c(r)].filter(n=>n)}s.toElementArray=S,w(S,"toElementArray");function b(r,n){return typeof r=="string"?$(r,n):S(r)}s.normalize=b,w(b,"normalize");function D(r,n=false){const o=(r??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return n?o.replace(/"/g,"&quot;"):o}s.escape=D,w(D,"escape");function p(r){return r.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(n,o)=>o==="38"?n:String.fromCharCode(+o)).replace(/&#x([0-9a-f]+);/gi,(n,o)=>o==="26"?n:String.fromCharCode(parseInt(o,16))).replace(/&(amp|#38|#x26);/g,"&")}s.unescape=p,w(p,"unescape");function d(r,n={}){var i;const o=$(r);return n.caret?n.type&&((i=o[0])==null?void 0:i.type)!==n.type?void 0:o[0]:L(o,n.type||"*")[0]}s.from=d,w(d,"from");const g=/ *([ >+~]) */g;function A(r){return r.split(",").map(n=>{const o=[];n=n.trim();let i,_=" ";for(;i=g.exec(n);)o.push({type:n.slice(0,i.index),combinator:_}),_=i[1],n=n.slice(i.index+i[0].length);return o.push({type:n,combinator:_}),o})}s.parseSelector=A,w(A,"parseSelector");function L(r,n){if(!r||!n)return[];if(typeof r=="string"&&(r=$(r)),typeof n=="string"&&(n=A(n)),!n.length)return[];let o=[];const i=[];for(const[_,v]of r.entries()){const k=[],j=[...n,...o];o=[];let O=false;for(const C of j){const{type:F,combinator:ge}=C[0];(F===v.type||F==="*")&&(C.length===1?O=true:[" ",">"].includes(C[1].combinator)?k.push(C.slice(1)):C[1].combinator==="+"?o.push(C.slice(1)):n.push(C.slice(1))),ge===" "&&k.push(C)}O&&i.push(r[_]),i.push(...L(v.children,k))}return i}s.select=L,w(L,"select");function z(r,n){if(r=r.trim(),!/^[\w.]+$/.test(r))return x(r,n)??"";let o=n;for(const i of r.split("."))if(o=o[i],I(o))return"";return o??""}s.interpolate=z,w(z,"interpolate");const ie=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,le=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,ue=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,fe=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=\{(?<curly>[^}]+)\})?/g;let re;(r=>{r[r.OPEN=0]="OPEN",r[r.CLOSE=1]="CLOSE",r[r.EMPTY=2]="EMPTY",r[r.CONTINUE=3]="CONTINUE"})(re||(re={}));function $(r,n){const o=[];function i(O){O&&o.push(O)}w(i,"pushText");const _=n?le:ie;let v,k=true;for(;v=_.exec(r);){const O=!v.groups.curly;j(r.slice(0,v.index),k,O),k=O,r=r.slice(v.index+v[0].length);const[C,,,F,ge,Re,Ee]=v;if(!v.groups.comment){if(v.groups.curly){let ke="",Ce=2;v.groups.derivative&&(ke=v.groups.derivative.slice(1),Ce={"@":2,"#":0,"/":1,":":3}[v.groups.derivative[0]]),o.push({type:"curly",name:ke,position:Ce,source:v.groups.curly,extra:v.groups.curly.slice(1+(v.groups.derivative??"").length,-1)});continue}o.push({type:"angle",source:C,name:ge||s.Fragment,position:F?1:Ee?2:0,extra:Re})}}j(r,k,true);function j(O,C,F){O=p(O),C&&(O=O.replace(/^\s*\n\s*/,"")),F&&(O=O.replace(/\s*\n\s*$/,"")),i(O)}return w(j,"parseContent"),q(P(o),n)}s.parse=$,w($,"parse");function P(r){const n=[[{type:"angle",name:s.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function o(...i){const[_,v]=n[0];_.children[v].push(...i)}w(o,"pushToken");for(const i of r){if(typeof i=="string"){o(i);continue}const{name:_,position:v}=i;v===1?n[0][0].name===_&&n.shift():v===3?(n[0][0].children[_]=[],n[0][1]=_):v===0?(o(i),i.children={default:[]},n.unshift([i,"default"])):o(i)}return n[n.length-1][0].children.default}w(P,"foldTokens");function q(r,n){const o=[];for(const i of r)if(typeof i=="string")o.push(s("text",{content:i}));else if(i.type==="angle"){const _={},v=n?fe:ue;let k;for(;k=v.exec(i.extra);){const[,j,O,C=O,F]=k;F?_[j]=z(F,n):I(C)?j.startsWith("no-")?_[j.slice(3)]=false:_[j]=true:_[j]=p(C)}o.push(s(i.name,_,i.children&&q(i.children.default,n)))}else if(!i.name)o.push(...S(z(i.extra,n)));else if(i.name==="if")x(i.extra,n)?o.push(...q(i.children.default,n)):o.push(...q(i.children.else||[],n));else if(i.name==="each"){const[_,v]=i.extra.split(/\s+as\s+/),k=z(_,n);if(!k||!k[Symbol.iterator])continue;for(const j of k)o.push(...q(i.children.default,{...n,[v]:j}))}return o}w(q,"parseTokens");function ce(r,n,o){const{type:i,attrs:_,children:v}=r;if(typeof n=="function")return n(r,o);{let k=n[typeof i=="string"?i:""]??n.default??true;return typeof k=="function"&&(k=k(_,v,o)),k}}w(ce,"visit");function pe(r,n,o){const i=typeof r=="string"?$(r):r,_=[];return i.forEach(v=>{const{type:k,attrs:j,children:O}=v,C=ce(v,n,o);C===true?_.push(s(k,j,pe(O,n,o))):C!==false&&_.push(...S(C))}),typeof r=="string"?_.join(""):_}s.transform=pe,w(pe,"transform");async function de(r,n,o){const i=typeof r=="string"?$(r):r,_=(await Promise.all(i.map(async v=>{const{type:k,attrs:j,children:O}=v,C=await ce(v,n,o);return C===true?[s(k,j,await de(O,n,o))]:C!==false?S(C):[]}))).flat(1);return typeof r=="string"?_.join(""):_}s.transformAsync=de,w(de,"transformAsync");function Q(r,...n){return(...o)=>{const i=s(r);return n.forEach((_,v)=>{I(o[v])||(i.attrs[_]=o[v])}),o[n.length]&&Object.assign(i.attrs,o[n.length]),i}}w(Q,"createFactory"),s.warn=w(()=>{},"warn");function G(r){return(n,...o)=>{let i="base64://";return typeof o[0]=="string"&&(i=`data:${o.shift()};base64,`),N("Buffer",n)?n=i+n.toString("base64"):N("ArrayBuffer",n)?n=i+H.toBase64(n):ArrayBuffer.isView(n)&&(n=i+H.toBase64(n.buffer)),n.startsWith("base64://")&&(0,s.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),s(r,{...o[0],src:n})}}w(G,"createAssetFactory"),s.text=Q("text","content"),s.at=Q("at","id"),s.sharp=Q("sharp","id"),s.quote=Q("quote","id"),s.image=G("img"),s.img=G("img"),s.video=G("video"),s.audio=G("audio"),s.file=G("file");function we(r,n){return s("i18n",typeof r=="string"?{path:r}:r,n)}s.i18n=we,w(we,"i18n")})(u||(u={})),t.exports=u}});const te=_t(),bt={class:"textarea"},xt=["value","placeholder","onKeydown"],wt=_e({__name:"input",props:{target:{default:()=>document},modelValue:{default:""},placeholder:{}},emits:["send","update:modelValue"],setup(e,{emit:t}){const a=t,l=e,u=se({get:()=>l.modelValue,set:c=>a("update:modelValue",c)});function x(){u.value&&(a("send",te.escape(u.value)),u.value="")}function h(c){u.value=c.target.value}function s(c,S){if(S)for(const b of S.items){if(b.kind!=="file")continue;const D=b.getAsFile();if(!D)continue;c.preventDefault();const[p]=D.type.split("/",1);if(!["image","audio","video"].includes(p)){console.warn("Unsupported file type:",D.type);return}const d=new FileReader;d.addEventListener("load",function(){a("send",te(p,{src:d.result}).toString())},false),d.readAsDataURL(D)}}De(l.target,"drop",c=>{s(c,c.dataTransfer)}),De(l.target,"dragover",c=>{c.preventDefault()});async function f(c){s(c,c.clipboardData)}return(c,S)=>(V(),E("div",bt,[M("input",{autocomplete:"off",step:"any",value:u.value,placeholder:c.placeholder,onInput:h,onPaste:f,onKeydown:He(Le(x,["stop"]),["enter"])},null,40,xt)]))}});const oe=(e,t)=>{const a=e.__vccOpts||e;for(const[l,u]of t)a[l]=u;return a},kt=oe(wt,[["__scopeId","data-v-76646135"]]),Ct=["b","strong","i","em","u","ins","s","del","code"],ee=(e,t)=>e.map(({type:a,attrs:l,children:u})=>{if(a==="text")return l.content;if(a==="at")return U("span",`@${l.name}`);if(a==="img"){const x={src:l.src,alt:l.alt};return U("img",x)}else return a==="audio"?U("audio",{src:l.src,controls:true}):a==="video"?U("video",{src:l.src,controls:true}):Ct.includes(a)?U(a,ee(u)):a==="spl"?U("span",{class:"spoiler"},ee(u)):a==="p"||a==="message"?U("p",ee(u)):a==="iframe"?U("iframe",{innerHTML:l.content}):ee(u)}),St={name:"message-content",props:{content:{type:String,required:true}},setup(e,t){return()=>U("div",{class:"message-content"},ee(te.parse(e.content)))}};const Be=oe(St,[["__scopeId","data-v-2f93ebf1"]]),At={private:"私聊模式",guild:"群聊模式",profile:"用户设置"},y=We("sandbox",1.1,()=>({platform:"sandbox:"+Math.random().toString(36).slice(2),user:"",index:0,messages:{},panelType:"private"})),Z=se(()=>y.value.panelType==="guild"?"#":"@"+y.value.user);be("sandbox/message",e=>{var t,a;e.platform===y.value.platform&&((t=y.value.messages)[a=e.channel]||(t[a]=[])).push(e)});be("sandbox/clear",()=>{y.value.messages[Z.value]=[]});const ae={deleteMessage({messageId:e,channelId:t}){const a=y.value.messages[t];a&&(y.value.messages[t]=a.filter(l=>l.id!==e))},getMessage({messageId:e,channelId:t}){var a;return(a=y.value.messages[t])==null?void 0:a.find(l=>l.id===e)},getChannel({channelId:e,guildId:t}){return{channelId:"#"}},getChannelList({guildId:e}){return{data:{channelId:"#"}}},getGuild({guildId:e}){return{guildId:"#"}},getGuildList(){return{data:{guildId:"#"}}},getGuildMember({guildId:e,userId:t}){return{userId:t,username:t}},getGuildMemberList({guildId:e}){return{data:Object.keys(y.value.messages).filter(a=>a.startsWith("@")).map(a=>{const l=a.slice(1);return{userId:l,username:l}})}}};be("sandbox/request",({method:e,nonce:t,data:a})=>{var u;const l=(u=ae[e])==null?void 0:u.call(ae,a);Y("sandbox/response",t,l)});const $t=["Alice","Bob","Carol","Dave","Eve","Frank","Grace","Hank","Ivy","Jack","Kathy","Lily","Mandy","Nancy","Oscar","Peggy","Quinn","Randy","Sandy","Toby","Uma","Vicky","Wendy","Xander","Yvonne","Zoe"],Ot={class:"chat-message"},Dt={class:"avatar"},jt={class:"nickname"},Bt={key:0,class:"quote"},Mt={class:"abstract"},Lt=_e({__name:"message",props:{data:{}},setup(e){const t=Ye("sandbox.message");return(a,l)=>(V(),E("div",Ot,[M("div",Dt,J(a.data.user[0]),1),M("div",jt,J(a.data.user),1),M("div",{class:"message-box",onContextmenu:l[0]||(l[0]=Le(u=>B(t)(u,a.data),["stop"]))},[a.data.quote?(V(),E("blockquote",Bt,[M("span",Mt,[R(B(Be),{content:a.data.quote.content},null,8,["content"])])])):me("v-if",true),R(B(Be),{content:a.data.content},null,8,["content"])],32)]))}});const Vt=oe(Lt,[["__scopeId","data-v-4057f070"]]),zt={class:"user-container"},It={class:"avatar"},Nt={class:"nick"},Ft=["onClick"],Ut={class:"card-header"},Rt=["onClick"],Et=M("div",null,"点击「添加用户」开始体验",-1),Ht={class:"card-footer"},Pt={key:0,class:"quote"},qt={class:"left"},Me=10,Kt=_e({__name:"layout",setup(e){const t=Ge();t.action("sandbox.message.delete",{action:({sandbox:g})=>d(g.message)}),t.action("sandbox.message.quote",{action:({sandbox:g})=>c.value=g.message});const a=$e.object({authority:$e.natural().description("权限等级")}),l=se(()=>Object.keys(y.value.messages).filter(g=>g.startsWith("@")).map(g=>g.slice(1))),u=se(()=>Object.fromEntries(l.value.map(g=>[g,{name:g}])));function x(){if(l.value.length>=Me)return Qe.error("可创建的用户数量已达上限。");let g;do g=$t[y.value.index++],y.value.index%=Me;while(l.value.includes(g));y.value.user=g,y.value.messages["@"+g]=[],Y("sandbox/set-user",y.value.platform,y.value.user,{})}function h(g){const A=l.value.indexOf(g);delete y.value.messages["@"+g],Y("sandbox/set-user",y.value.platform,y.value.user,null),y.value.user===g&&(y.value.user=l.value[A]||"")}const s=T(""),f=T(0),c=T();function S(g){if(g.key==="ArrowUp"){const A=y.value.messages[Z.value].filter(z=>z.user===y.value.user);let L=A.length-f.value;A[L-1]&&(f.value++,s.value=te.unescape(A[L-1].content))}else if(g.key==="ArrowDown"){const A=y.value.messages[Z.value].filter(z=>z.user===y.value.user);let L=A.length-f.value;A[L+1]?(f.value--,s.value=te.unescape(A[L+1].content)):f.value&&(f.value=0,s.value="")}}const b=T(),D=T();Se(()=>y.value.user,async g=>{g&&(b.value=await Y("sandbox/get-user",y.value.platform,y.value.user),D.value=Oe(b.value))},{immediate:true}),Se(D,async g=>{Ze(g,b.value)||(await Y("sandbox/set-user",y.value.platform,y.value.user,g),b.value=Oe(g))},{deep:true});function p(g){f.value=0,Y("sandbox/send-message",y.value.platform,y.value.user,Z.value,g,c.value),c.value=null}async function d(g){await Y("sandbox/delete-message",g.platform,g.user,g.channel,g.id),ae.deleteMessage({messageId:g.id,channelId:g.channel})}return(g,A)=>{const L=K("k-icon"),z=K("k-tab-group"),ie=K("el-scrollbar"),le=K("k-empty"),ue=K("k-form"),fe=K("k-content"),re=K("k-layout");return V(),X(re,{class:"page-sandbox"},{left:W(()=>[M("div",{class:"card-header k-tab-menu-item",onClick:x},"添加用户"),M("div",zt,[R(ie,null,{default:W(()=>[R(z,{data:u.value,modelValue:B(y).user,"onUpdate:modelValue":A[0]||(A[0]=$=>B(y).user=$)},{default:W(({name:$})=>[M("div",It,J($[0]),1),M("div",Nt,J($),1),M("div",{class:"close",onClick:P=>h($)},[R(L,{name:"times-full"})],8,Ft)]),_:1},8,["data","modelValue"])]),_:1})])]),default:W(()=>[M("div",Ut,[(V(true),E(Ae,null,Pe(B(At),($,P)=>(V(),E("span",{key:P,class:qe(["k-horizontal-tab-item",{active:B(y).panelType===P}]),onClick:q=>B(y).panelType=P},J($),11,Rt))),128))]),(V(),X(Ke,null,[l.value.length?B(y).panelType==="profile"?(V(),X(fe,{key:"profile"+B(Z)},{default:W(()=>[b.value?(V(),X(ue,{key:0,initial:b.value,modelValue:D.value,"onUpdate:modelValue":A[1]||(A[1]=$=>D.value=$),schema:B(a),"show-header":false},null,8,["initial","modelValue","schema"])):me("v-if",true)]),_:1})):(V(),E(Ae,{key:2},[R(B(Je),{data:B(y).messages[B(Z)]||[],pinned:""},{default:W($=>[R(Vt,{data:$},null,8,["data"])]),_:1},8,["data"]),M("div",Ht,[c.value?(V(),E("div",Pt,[M("span",qt,"正在回复 @"+J(c.value.user),1),R(L,{name:"times-full",onClick:A[2]||(A[2]=$=>c.value=null)})])):me("v-if",true),R(B(kt),{modelValue:s.value,"onUpdate:modelValue":A[3]||(A[3]=$=>s.value=$),onSend:p,onKeydown:S,placeholder:"发送消息到沙盒"},null,8,["modelValue"])])],64)):(V(),X(le,{key:"empty"},{default:W(()=>[Et]),_:1}))],1024))]),_:1})}}});const Wt={},Yt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},Gt=M("path",{fill:"currentColor",d:"M437.2 403.5L319.1 215l.0001-135C319.1 71.16 312.8 64 303.1 64S288 71.16 288 79.1L287.1 215c0 5.973 1.672 11.83 4.826 16.9L347.6 320H100.4l54.79-88.1C158.3 226.8 160 220.1 160 215L160 79.1C160 71.16 152.8 64 144 64S128 71.16 128 79.1L128 215l-117.2 188.5C-18.48 450.6 15.27 512 70.89 512h306.2C432.7 512 466.5 450.5 437.2 403.5zM410.9 460C407.6 466 397.6 480 377.1 480H70.89c-20.51 0-30.48-13.95-33.82-19.95c-7.025-12.63-6.691-27.46 .873-39.65L80.48 352h287l42.55 68.41C417.6 432.6 417.1 447.4 410.9 460zM112 32h224C344.8 32 352 24.84 352 16S344.8 0 336 0h-224C103.2 0 96 7.156 96 16S103.2 32 112 32z"},null,-1),Zt=[Gt];function Jt(e,t){return V(),E("svg",Yt,Zt)}const Qt=oe(Wt,[["render",Jt]]);Te.register("activity:flask",Qt);const tn=e=>{e.page({name:"沙盒",path:"/sandbox",icon:"activity:flask",order:300,authority:4,component:Kt}),e.menu("sandbox.message",[{id:".delete",label:"删除消息"},{id:".quote",label:"引用回复"}])};export{tn as default};
