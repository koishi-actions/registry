var h=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var f=(r,e)=>()=>(r&&(e=r(r=0)),e);var I=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var p=(r,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of j(e))!C.call(r,t)&&t!==a&&h(r,t,{get:()=>e[t],enumerable:!(n=P(e,t))||n.enumerable});return r},i=(r,e,a)=>(p(r,e,"default"),a&&p(a,e,"default"));var N=r=>p(h({},"__esModule",{value:!0}),r);import{Buffer as m}from"https://registry.koishi.chat/modules/buffer/index.js";import s from"https://registry.koishi.chat/modules/process/index.js";var u=f(()=>{});var c={};import*as L from"https://registry.koishi.chat/modules/koishi/index.js";var _=f(()=>{u();i(c,L)});var F=I((Q,w)=>{u();var o=Object.defineProperty,D=Object.getOwnPropertyDescriptor,x=Object.getOwnPropertyNames,q=Object.prototype.hasOwnProperty,v=(r,e)=>o(r,"name",{value:e,configurable:!0}),z=(r,e)=>function(){return e||(0,r[x(r)[0]])((e={exports:{}}).exports,e),e.exports},S=(r,e)=>{for(var a in e)o(r,a,{get:e[a],enumerable:!0})},$=(r,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of x(e))!q.call(r,t)&&t!==a&&o(r,t,{get:()=>e[t],enumerable:!(n=D(e,t))||n.enumerable});return r},k=r=>$(o({},"__esModule",{value:!0}),r),J=z({"src/locales/zh-CN.yml"(r,e){e.exports={commands:{sudo:{description:"在特定上下文中触发指令",options:{user:"切换用户身份",channel:"切换触发频道",direct:"模拟私聊触发"},messages:{"expect-command":"请输入要触发的指令。","expect-context":"请提供新的上下文。","direct-channel":"--channel 和 --direct 无法同时使用。"}}}}}}),y={};S(y,{Config:()=>B,apply:()=>g,inject:()=>U,name:()=>M});w.exports=k(y);var b=(_(),N(c)),M="sudo",U=["database"],B=b.Schema.object({});function d(r){let e=r.indexOf(":"),a=r.slice(0,e),n=r.slice(e+1);return[a,n]}v(d,"parsePlatform");function g(r){r.i18n.define("zh-CN",J()),r.command("sudo <command:text>",{authority:3}).userFields(["authority"]).option("user","-u [id:user]").option("channel","-c [id:channel]").option("direct","-C, -d").action(async({session:e,options:a},n)=>{if(!n)return e.text(".expect-command");if(a.channel&&a.direct)return e.text(".direct-channel");if(!a.user&&!a.channel&&!a.direct)return e.text(".expect-context");let t=e.bot.session(e.event);if(t[b.Context.shadow]=e,a.direct?(t.subtype="private",t.isDirect=!0):a.channel&&a.channel!==e.cid?(t.channelId=d(a.channel)[1],t.subtype="group",await t.observeChannel([])):t.channel=e.channel,a.user&&a.user!==e.uid){t.userId=d(a.user)[1];let O=await t.observeUser(["authority"]);if(e.user.authority<=O.authority)return e.text("internal.low-authority");if(t.isDirect){let l=await e.bot.getUser?.(t.userId).catch(()=>({}));Object.assign(t.author,l)}else{let l=await e.bot.getGuildMember?.(t.guildId,t.userId).catch(()=>({}));Object.assign(t.author,l)}}else t.user=e.user,t.event=e.event;t.send=e.send,await t.execute(n),await Promise.all([t.user?.$update(),t.channel?.$update(),t.guild?.$update()])})}v(g,"apply")});export default F();
