var j=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var N=(e,n)=>()=>(e&&(n=e(e=0)),n);var d=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var q=(e,n,t,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of I(n))!E.call(e,o)&&o!==t&&j(e,o,{get:()=>n[o],enumerable:!(c=w(n,o))||c.enumerable});return e},m=(e,n,t)=>(q(e,n,"default"),t&&q(t,n,"default"));var M=e=>q(j({},"__esModule",{value:!0}),e);import{Buffer as h}from"https://registry.koishi.chat/modules/buffer/index.js";import p from"https://registry.koishi.chat/modules/process/index.js";var l=N(()=>{});var f={};import*as ne from"https://registry.koishi.chat/modules/koishi/index.js";var _=N(()=>{l();m(f,ne)});var U=d(S=>{"use strict";l();Object.defineProperty(S,"__esModule",{value:!0});S.curGeo=void 0;S.curGeo={ip:"",cc:"",region:""}});var B=d(a=>{"use strict";l();Object.defineProperty(a,"__esModule",{value:!0});a.bingURLSelect=a.bingLangSelect=a.bingChineseLang=a.bingL2CCMapping=a.bingLangMapping=void 0;var v=(_(),M(f)),H=U();a.bingLangMapping={zh:"zh-Hans","zh-CN":"zh-Hans","zh-TW":"zh-Hant","ja-JP":"ja",en:"en"};a.bingL2CCMapping={"zh-Hans":"CN","zh-Hant":"TW",ja:"jp",en:"us"};a.bingChineseLang=["zh-CN","zh"];function z(e,n){let t=[...n.channel?.locales||[],...n.guild?.locales||[]];e.root.config.i18n.output==="prefer-user"?t.unshift(...n.user?.locales||[]):t.push(...n.user?.locales||[]),t.unshift(...this.locales||[]),t=e.root.i18n.fallback(t);let c=t[0]||"",o=c.length>0;for(let r of t){if(r!==t[0]&&r=="")break;if(!o&&typeof a.bingLangMapping[(0,v.paramCase)(r)]<"u"){c=a.bingLangMapping[(0,v.paramCase)(r)];break}}return c}a.bingLangSelect=z;function Q(e,n,t){let c=a.bingChineseLang.some(u=>n.user?.locales[0]==u),o=e.config.useBingCN,r=H.curGeo.cc==="CN",b=z(e,n);return n.text(`engine.bing.${c||o||r?"chn_ml":"default"}.query`,{query:encodeURIComponent(t)||"%s",lang:b,cc:e.config.selectCCByLang?a.bingL2CCMapping[b]:""})}a.bingURLSelect=Q});var k=d(y=>{"use strict";l();Object.defineProperty(y,"__esModule",{value:!0});y.getQueryURL=void 0;function T(e,n){return e.indexOf("%s")===-1&&e.endsWith("=")?e+encodeURI(n):e.replace("%s",encodeURI(n))}y.getQueryURL=T});var P=d(s=>{"use strict";l();Object.defineProperty(s,"__esModule",{value:!0});s.googleURLSelect=s.googleLangCCSelect=s.googleL2CCMapping=void 0;s.googleL2CCMapping={zh:"CN","en-US":"US"};function G(e,n){let t=[...n.channel?.locales||[],...n.guild?.locales||[]];e.root.config.i18n.output==="prefer-user"?t.unshift(...n.user?.locales||[]):t.push(...n.user?.locales||[]),t.unshift(...this.locales||[]),t=e.root.i18n.fallback(t);let c=t[0]||"",o="",r=c.length>0,b=!e.config.selectCCByLang;if(!(b&&r))for(let u of t){if(u!==t[0]&&u==""){r=!0;continue}!r&&u.length>=0&&(c=u,r=!0);let R=u.split("-")[1];if(!b&&R){o=R;break}}return{lang:c,cc:o||""}}s.googleLangCCSelect=G;function W(e,n,t){let{lang:c,cc:o}=G(e,n);return n.text("engine.google.default.query",{query:encodeURIComponent(t)||"%s",lang:c,cc:o})}s.googleURLSelect=W});var O=d(L=>{"use strict";l();Object.defineProperty(L,"__esModule",{value:!0});L.getSearchURL=void 0;var $=B(),J=k(),A=P();function D(e,n,t){let c=e.config.queryString;switch(e.config.searchEngine){case"bing":c=(0,$.bingURLSelect)(e,n,t);break;case"google":c=(0,A.googleURLSelect)(e,n,t);break;case"custom":c=(0,J.getQueryURL)(c,t)}return c}L.getSearchURL=D});var V=d(g=>{l();Object.defineProperty(g,"__esModule",{value:!0});g.apply=g.Config=g.usage=g.name=void 0;var i=(_(),M(f)),F=O(),C=U();g.name="search-helper";g.usage=`## 地理位置  
由于部分国家或地区的政策  
本插件可能会获取您的 IP 以及所在的国家和地区信息  
保证您在使用 Bing搜索 时，使用正确的区域服务  
所有数据均在本地处理，不会上传  
`;g.Config=i.Schema.intersect([i.Schema.object({searchEngine:i.Schema.union(["bing","google","custom"]).description("默认使用的搜索引擎").default("bing")}),i.Schema.union([i.Schema.object({searchEngine:i.Schema.const("custom").required(),queryString:i.Schema.string().description("查询地址 例如: https://bing.com/?q=%s").required()}),i.Schema.object({searchEngine:i.Schema.const("bing"),useBingCN:i.Schema.dynamic("useBingCN").default(!1),selectCCByLang:i.Schema.boolean().description("根据语言自动选择国家").default(!1)}),i.Schema.object({searchEngine:i.Schema.const("google").required(),selectCCByLang:i.Schema.boolean().description("根据语言自动选择国家").default(!1)}),i.Schema.object({})])]);function K(e,n){let t=e.logger("search-helper");e.i18n.define("",{engine:{bing:{default:{query:"https://www.bing.com/search?q={query}&setlang={lang}&cc={countryCode}"},chn_ml:{query:"https://cn.bing.com/search?q={query}&setlang={lang}&cc=CN"}},google:{default:{query:"https://google.com/search?q={query}&hl={lang}&lr=lang_{lang}&gl={cc}"}}}}),e.i18n.define("zh-CN",{engine:{bing:{default:{query:"https://cn.bing.com/search?q={query}&setlang={lang}&cc={cc}"},chn_ml:{query:"https://cn.bing.com/search?q={query}&setlang={lang}&cc=CN"}}}}),e.http.get("https://api.ipify.org?format=json").then(async c=>(C.curGeo.ip=c.ip,await e.http.get(`https://ipinfo.io/widget/demo/${c.ip}`,{headers:{Referer:"https://ipinfo.io/","Content-Type":"application/json"}}))).then(c=>{let o=c.data;o&&(C.curGeo.ip=o.ip,C.curGeo.cc=o.country,C.curGeo.region=o.region,C.curGeo.ip==="CN"?e.schema.set("useBingCN",i.Schema.boolean().default(!0).disabled()):e.schema.set("useBingCN",i.Schema.boolean().default(!1).disabled()))}),e.command("search-helper <query: text>").alias("search","help-search","搜索","帮我搜索","hs").action(({session:c},o)=>(0,F.getSearchURL)(e,c,o))}g.apply=K});export default V();
