var u=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var l=(i,t)=>()=>(i&&(t=i(i=0)),t);var y=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var d=(i,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of x(t))!S.call(i,s)&&s!==e&&u(i,s,{get:()=>t[s],enumerable:!(a=g(t,s))||a.enumerable});return i},m=(i,t,e)=>(d(i,t,"default"),e&&d(e,t,"default"));var C=i=>d(u({},"__esModule",{value:!0}),i);import{Buffer as b}from"https://registry.koishi.chat/modules/buffer/index.js";import w from"https://registry.koishi.chat/modules/process/index.js";var c=l(()=>{});var n={};import*as q from"https://registry.koishi.chat/modules/koishi/index.js";var k=l(()=>{c();m(n,q)});var A=y(r=>{c();Object.defineProperty(r,"__esModule",{value:!0});r.apply=r.name=r.Config=void 0;var h=(k(),C(n));r.Config=h.Schema.object({cellSize:h.Schema.natural().default(8).description("每个单元占用的比特数。"),memorySize:h.Schema.natural().default(1024).description("允许的最大单元数目。"),maxSteps:h.Schema.natural().default(16384).description("允许的最大步数。")});var o=class extends Error{},f=class{constructor(t,e){this.source=t,this.options=e,this.data=[0],this.pointer=0,this.map={},this.mask=(1<<this.options.cellSize)-1}exec(t=""){let e="",a=0,s=0;for(;a<this.source.length;){switch(this.source.charCodeAt(a)){case 43:this.data[this.pointer]=++this.data[this.pointer]&this.mask;break;case 45:this.data[this.pointer]=--this.data[this.pointer]&this.mask;break;case 62:if(++this.pointer>=this.options.memorySize)throw new o("max memory exceed");this.data[this.pointer]===void 0&&(this.data[this.pointer]=0);break;case 60:if(!this.pointer)throw new o("negative pointer");--this.pointer;break;case 46:e+=String.fromCharCode(this.data[this.pointer]);break;case 44:this.data[this.pointer]=t.charCodeAt(0),t=t.slice(1);break;case 91:{let p=this.findMatch(a);this.data[this.pointer]||(a=p);break}case 93:if(this.map[a]===void 0)throw new o(`no matching "[" at position ${a}`);this.data[this.pointer]&&(a=this.map[a])}if(++a,++s===this.options.maxSteps)throw new o("max step exceeded")}return e}findMatch(t){let e=this.map[t];if(e)return e;for(e=t+1;e<this.source.length&&this.source.charCodeAt(e)!==93;)this.source.charCodeAt(e)===91&&(e=this.findMatch(e)),++e;if(e===this.source.length)throw new o(`no matching "]" at position ${t}`);return this.map[e]=t,this.map[t]=e}};r.name="brainfuck";function z(i,t){i.command("brainfuck <code>","运行 brainfuck 代码").alias("bf").option("input","-- <input:rawtext>  设置输入",{fallback:""}).usage("语言介绍：http://www.muppetlabs.com/~breadbox/bf").action(async({options:e},a)=>{if(!a)return"请输入源代码。";a=h.segment.unescape(a);let s=e.input;try{return h.segment.escape(new f(a,t).exec(s))}catch(p){if(p.name==="BFError")return p.message}})}r.apply=z});export default A();
