var f=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var h=(a,t)=>()=>(a&&(t=a(a=0)),t);var j=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports);var s=(a,t,n,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of O(t))!P.call(a,r)&&r!==n&&f(a,r,{get:()=>t[r],enumerable:!(e=G(t,r))||e.enumerable});return a},d=(a,t,n)=>(s(a,t,"default"),n&&s(n,t,"default"));var C=a=>s(f({},"__esModule",{value:!0}),a);import{Buffer as x}from"https://registry.koishi.chat/modules/buffer/index.js";import w from"https://registry.koishi.chat/modules/process/index.js";var l=h(()=>{});var c={};import*as V from"https://registry.koishi.chat/modules/koishi/index.js";var y=h(()=>{l();d(c,V)});var A=j((X,I)=>{l();var p=Object.defineProperty,M=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,q=Object.prototype.hasOwnProperty,_=(a,t)=>p(a,"name",{value:t,configurable:!0}),B=(a,t)=>function(){return t||(0,a[k(a)[0]])((t={exports:{}}).exports,t),t.exports},N=(a,t)=>{for(var n in t)p(a,n,{get:t[n],enumerable:!0})},W=(a,t,n,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of k(t))!q.call(a,r)&&r!==n&&p(a,r,{get:()=>t[r],enumerable:!(e=M(t,r))||e.enumerable});return a},z=a=>W(p({},"__esModule",{value:!0}),a),E=B({"src/locales/zh-CN.yml"(a,t){t.exports={"group-manage":{"blocking-word":{hit:"检测到违禁词",recall:"已执行撤回",mute:"已执行禁言"}},commands:{"group-manage":{description:"群组管理"},ban:{description:"禁言指定用户",usage:"示例：ban @user 1 分钟",messages:{"missing-user":"请指定被禁言的用户","missing-duration":"请指定禁言时长的单位为秒/分钟/小时/天",executed:"已执行禁言"}},"ban-me":{description:"禁言自己",usage:"示例：ban-me 1 分钟",messages:{"missing-duration":"请指定禁言时长的单位为秒/分钟/小时/天",executed:"已执行禁言"}},unban:{description:"取消指定用户的禁言",usage:"示例：unban @user",messages:{"missing-user":"请指定被取消禁言的用户",executed:"已执行取消禁言"}},delmsg:{description:"撤回指定消息",usage:"示例：回复一条消息，内容有且仅有“delmsg”",messages:{"missing-quote":"请回复被撤回的消息",executed:"已执行撤回"}},kick:{description:"将指定用户踢出群聊",usage:"示例：kick @user",messages:{"missing-user":"请指定被踢出群聊的用户",executed:"已执行踢出群聊"}},"mute-all":{description:"开启全员禁言",messages:{"unsupported-platform":"暂不支持该平台",executed:"已执行全员禁言"}},"unmute-all":{description:"取消全员禁言",messages:{"unsupported-platform":"暂不支持该平台",executed:"已执行取消全员禁言"}}}}}}),v={};N(v,{Config:()=>J,apply:()=>S,name:()=>R,usage:()=>T});I.exports=z(v);var i=(y(),C(c)),R="group-manage",J=i.Schema.intersect([i.Schema.object({blockingRules:i.Schema.dict(i.Schema.object({enable:i.Schema.boolean().description("是否启用").default(!0),blockingWords:i.Schema.array(String).description("违禁词列表 (可使用正则表达式)").default([]),mute:i.Schema.boolean().description("检测到违禁词后是否禁言").default(!1),muteDuration:i.Schema.natural().role("ms").description("禁言时长 (单位为毫秒)").default(10*i.Time.minute),recall:i.Schema.boolean().description("检测到违禁词后是否撤回").default(!1),tip:i.Schema.boolean().description("是否在检测到违禁词后进行提示").default(!0)}).description("群组平台与群组 ID, 格式:`platform:guildId`, 例如:`red:123456`")).description("规则列表")}).description("违禁词检测设置"),i.Schema.object({banDuration:i.Schema.natural().role("ms").description("ban 和 ban-me 指令默认禁言时长 (单位为毫秒)").default(15*i.Time.hour)}).description("指令默认值设置")]),T=`
使用本插件对他人进行操作时，需要操作者的权限等级 (authority) 为 3 及以上。

权限设置教程: https://koishi.chat/zh-CN/manual/usage/customize.html#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90
`;function S(a,t){a.i18n.define("zh-CN",E()),a.middleware(async(e,r)=>{if(e.gid in t.blockingRules){let u=t.blockingRules[e.gid];if(!u.enable)return r();let m=!1;for(let o of u.blockingWords){let D=new RegExp(o);if(e.event.message.elements.some(b=>b.type==="text"?D.test(b.attrs.content):!1)){m=!0;break}}if(m){u.tip&&await e.send(e.text("group-manage.blocking-word.hit"));let{event:o}=e;u.recall&&(await e.bot.deleteMessage(o.channel.id,o.message.id),u.tip&&await e.send(e.text("group-manage.blocking-word.recall"))),u.mute&&(await e.bot.muteGuildMember(o.guild.id,o.user.id,u.muteDuration),u.tip&&await e.send(e.text("group-manage.blocking-word.mute")));return}}return r()});let n=a.command("group-manage");n.subcommand("ban <user:user> <duration:posint> <unit>",{authority:3}).alias("mute","禁言").action(async({session:e},r,u,m)=>{if(!r)return e.text(".missing-user");if(!u)u=t.banDuration;else if(u=g(u,m),u===void 0)return e.text(".missing-duration");let o=r.replace(e.platform+":","");return await e.bot.muteGuildMember(e.guildId,o,u),e.text(".executed")}),n.subcommand("ban-me <duration:posint> <unit>").alias("self-ban","mute-me","自我禁言").action(async({session:e},r,u)=>{if(!r)r=t.banDuration;else if(r=g(r,u),r===void 0)return e.text(".missing-duration");return await e.bot.muteGuildMember(e.guildId,e.userId,r),e.text(".executed")}),n.subcommand("unban <user:user>",{authority:3}).alias("unmute","取消禁言").action(async({session:e},r)=>{if(!r)return e.text(".missing-user");let u=r.replace(e.platform+":","");return await e.bot.muteGuildMember(e.guildId,u,0),e.text(".executed")}),n.subcommand("delmsg",{authority:3}).alias("撤回消息").action(async({session:e})=>e.quote?(await e.bot.deleteMessage(e.channelId,e.quote.id),e.text(".executed")):e.text(".missing-quote")),n.subcommand("kick <user:user>",{authority:3}).alias("踢","踢出群聊").action(async({session:e},r)=>{if(!r)return e.text(".missing-user");let u=r.replace(e.platform+":","");return await e.bot.kickGuildMember(e.guildId,u),e.text(".executed")}),n.subcommand("mute-all",{authority:3}).alias("全员禁言").action(async({session:e})=>{let{platform:r,guildId:u}=e;switch(r){case"red":await e.bot.internal.muteGroup({group:u,enable:!0});break;case"onebot":await e.bot.internal.setGroupWholeBan(u,!0);break;case"kritor":await e.bot.internal.setGroupWholeBan(u,!0);break;default:return e.text(".unsupported-platform")}return e.text(".executed")}),n.subcommand("unmute-all",{authority:3}).alias("取消全员禁言").action(async({session:e})=>{let{platform:r,guildId:u}=e;switch(r){case"red":await e.bot.internal.muteGroup({group:u,enable:!1});break;case"onebot":await e.bot.internal.setGroupWholeBan(u,!1);break;case"kritor":await e.bot.internal.setGroupWholeBan(u,!1);break;default:return e.text(".unsupported-platform")}return e.text(".executed")})}_(S,"apply");function g(a,t){switch(t){case"秒":case"秒钟":case"s":return a*1e3;case"分":case"分钟":case"min":return a*60*1e3;case"时":case"小时":case"h":return a*60*60*1e3;case"天":case"d":return a*24*60*60*1e3;default:return}}_(g,"parseDuration")});export default A();
