var y=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var h=(r,e)=>()=>(r&&(e=r(r=0)),e);var S=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var g=(r,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of N(e))!M.call(r,a)&&a!==o&&y(r,a,{get:()=>e[a],enumerable:!(n=q(e,a))||n.enumerable});return r},d=(r,e,o)=>(g(r,e,"default"),o&&g(o,e,"default"));var z=r=>g(y({},"__esModule",{value:!0}),r);import{Buffer as v}from"https://registry.koishi.chat/modules/buffer/index.js";import b from"https://registry.koishi.chat/modules/process/index.js";var u=h(()=>{});var i={};import*as V from"https://registry.koishi.chat/modules/koishi/index.js";var w=h(()=>{u();d(i,V)});var G=S((W,C)=>{u();var _=Object.defineProperty,k=Object.getOwnPropertyDescriptor,O=Object.getOwnPropertyNames,D=Object.prototype.hasOwnProperty,P=(r,e)=>_(r,"name",{value:e,configurable:!0}),J=(r,e)=>function(){return e||(0,r[O(r)[0]])((e={exports:{}}).exports,e),e.exports},T=(r,e)=>{for(var o in e)_(r,o,{get:e[o],enumerable:!0})},B=(r,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of O(e))!D.call(r,a)&&a!==o&&_(r,a,{get:()=>e[a],enumerable:!(n=k(e,a))||n.enumerable});return r},Q=r=>B(_({},"__esModule",{value:!0}),r),A=J({"src/locales/zh-CN.yml"(r,e){e.exports={commands:{recall:{description:"撤回机器人发送的消息",messages:{"no-recent":"近期没有发送消息。"}}}}}}),x={};T(x,{Config:()=>E,apply:()=>I,name:()=>F});C.exports=Q(x);var f=(w(),z(i)),E=f.Schema.object({timeout:f.Schema.natural().role("ms").default(f.Time.hour).description("消息保留的时间。")}),F="recall";function I(r,{timeout:e}){let o=r.logger("recall");r.i18n.define("zh-CN",A()),r=r.guild();let n={};r.on("send",t=>{let p=n[t.channelId]||=[];p.unshift(t.messageId),r.setTimeout(()=>(0,f.remove)(p,t.messageId),e)}),r.command("recall [count:number]",{authority:2,captureQuote:!1}).action(async({session:t},p=1)=>{let l=n[t.channelId];if(t.quote){let c=l?.findIndex(j=>j===t.quote.id);c&&l.splice(c,1),await a(t.bot,t.channelId,t.quote.id);return}if(!l)return t.text(".no-recent");let m=l.splice(0,p),s=r.root.config.delay.broadcast;l.length||delete n[t.channelId];for(let c=0;c<m.length;c++)c&&s&&await(0,f.sleep)(s),await a(t.bot,t.channelId,m[c])});async function a(t,p,l){try{await t.deleteMessage(p,l)}catch(m){o.warn(m)}}P(a,"deleteMessage")}P(I,"apply")});export default G();
