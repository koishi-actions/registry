var S=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var q=(r,n)=>()=>(r&&(n=r(r=0)),n);var k=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var w=(r,n,a,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of L(n))!D.call(r,e)&&e!==a&&S(r,e,{get:()=>n[e],enumerable:!(t=E(n,e))||t.enumerable});return r},x=(r,n,a)=>(w(r,n,"default"),a&&w(a,n,"default"));var N=r=>w(S({},"__esModule",{value:!0}),r);import{Buffer as A}from"https://registry.koishi.chat/modules/buffer/index.js";import j from"https://registry.koishi.chat/modules/process/index.js";var o=q(()=>{});var g={};import*as T from"https://registry.koishi.chat/modules/koishi/index.js";var B=q(()=>{o();x(g,T)});var C=k((V,P)=>{P.exports={commands:{"guess-number":{description:"猜数字",options:{base:"设置进制数",length:"设置答案长度",chances:"设置猜测次数",quit:"退出游戏"},usage:`输入要猜测的数字，将得到一个形如 xAyB 的匹配结果：
x 为本次猜测的四位数字中，答案包含的且所处位置正确的数字个数；
y 为本次猜测的四位数字中，答案包含的但所处位置不正确的数字个数。
例如：生成的数字为 0637，猜测 2730，则返回 1A2B。
这是因为 3 在答案中包含且位置正确，7 和 0 在答案中包含但位置不正确。`,messages:{idle:"没有正在进行的猜数字游戏。输入“猜数字”开始一轮游戏。",start:"{length} 位 {base} 进制猜数字游戏开始。",stop:"游戏结束。","invalid-base":"进制应为 2 到 36 之间的整数。","invalid-length":"长度应为不大于进制数的正整数。","invalid-chances":"猜测次数应为正整数。","history-empty":"本轮猜数字暂时没有历史记录。","history-item":"第 {3} 次猜测内容：{0}，匹配结果：{1}A{2}B",result:"数字 {0} 的匹配结果为：{1}A{2}B。",win:"恭喜 {0} 回答正确！",lose:"游戏失败！正确答案为：{answer}。","used-input":"该数字已经使用过，换一个叭~","expect-input":"请输入由不同数字构成的 {length} 位 {base} 进制数。"}}}}});var F=k(u=>{o();Object.defineProperty(u,"__esModule",{value:!0});u.apply=u.Config=u.name=void 0;var s=(B(),N(g));u.name="guess-number";u.Config=s.Schema.object({base:s.Schema.number().default(10).description("标准开局下的进制数。"),length:s.Schema.number().default(4).description("标准开局下的答案长度。"),chances:s.Schema.number().default(10).description("标准开局下的猜测次数。"),submission:s.Schema.union([s.Schema.const("strict").description("只接受指令输入"),s.Schema.const("loose").description("允许直接输入答案文本"),s.Schema.const("mention").description("仅在私聊或被提及时接受直接输入")]).role("radio").description("答案提交方式。").default("mention")});function R(r,n){let a="",t=r.split("");for(let e=0;e<n;e++)a+=t.splice(Math.floor(Math.random()*t.length),1);return a}function U(r,n){let a=Object.create(null);r.i18n.define("zh-CN",C()),r.middleware(async(t,e)=>{let h=a[t.cid];if(!h||n.submission==="strict")return e();let{content:i,atSelf:b}=t.stripped;return!t.isDirect&&!b&&n.submission!=="loose"||!h.regexp.test(i.toLowerCase())?e():t.execute({name:"guess-number",args:[i]})}),r.command("guess-number [...number:string]").alias("猜数字").alias("gn").option("base","-b <base>",{fallback:n.base}).option("length","-l <length>",{fallback:n.length}).option("chances","-c <count>",{fallback:n.chances}).option("quit","-q",{notUsage:!0}).action(async({session:t,options:e},...h)=>{let i=t.cid;if(!a[i]){if(h.length||e.quit)return t.text(".idle");if(!(0,s.isInteger)(e.base)||e.base<2||e.base>36)return t.text(".invalid-base");if(!(0,s.isInteger)(e.length)||e.length<1||e.length>e.base)return t.text(".invalid-length");if(!(0,s.isInteger)(e.chances)||e.chances<1)return t.text(".invalid-chances");let l="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,e.base),m=R(l,e.length);return a[i]={answer:m,counter:Array(e.base).fill(0),history:[],base:e.base,length:e.length,chances:e.chances,regexp:new RegExp(`^[${l}]{${e.length}}$`)},t.text(".start",a[i])}let{answer:b,history:f,base:I,length:z,regexp:M,counter:O}=a[i];if(e.quit)return delete a[i],t.text(".stop");let v=!1,c=[];for(let l of h){l=l.toLowerCase();let m=l.split("");if(f.some(d=>d[0]===l))continue;if(!M.exec(l)||new Set(m).size!==l.length){v=!0;continue}let p=0,y=0;if(m.forEach((d,_)=>{let $=parseInt(d,I);O[$]+=1,d===b[_]?p+=1:b.indexOf(d)>=0&&(y+=1)}),f.push([l,p,y]),c.push(t.text(".result",[l,p,y])),p===z){c.push(t.text(".win",[t.username])),r.emit(t,"guess-number/win",a[i],c),delete a[i];break}else if(f.length>=a[i].chances){c.push(t.text(".lose",a[i])),r.emit(t,"guess-number/lose",a[i],c),delete a[i];break}}return c.length||(!h.length||v?(c.push(t.text(".expect-input",a[i])),h.length||(f.length?c.push(...f.map((l,m)=>t.text(".history-item",[...l,m+1]))):c.push(t.text(".history-empty")))):c.push(t.text(".used-input"))),c.join(`
`)})}u.apply=U});export default F();
