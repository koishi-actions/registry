var _=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var m=(r,e)=>()=>(r&&(e=r(r=0)),e);var j=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var u=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of O(e))!P.call(r,i)&&i!==t&&_(r,i,{get:()=>e[i],enumerable:!(s=S(e,i))||s.enumerable});return r},p=(r,e,t)=>(u(r,e,"default"),t&&u(t,e,"default"));var k=r=>u(_({},"__esModule",{value:!0}),r);import{Buffer as b}from"https://registry.koishi.chat/modules/buffer/index.js";import v from"https://registry.koishi.chat/modules/process/index.js";var n=m(()=>{});var c={};import*as J from"https://registry.koishi.chat/modules/koishi/index.js";var g=m(()=>{n();p(c,J)});var M=j((T,l)=>{n();var d=Object.defineProperty,x=Object.getOwnPropertyDescriptor,A=Object.getOwnPropertyNames,q=Object.prototype.hasOwnProperty,y=(r,e)=>d(r,"name",{value:e,configurable:!0}),C=(r,e)=>{for(var t in e)d(r,t,{get:e[t],enumerable:!0})},F=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of A(e))!q.call(r,i)&&i!==t&&d(r,i,{get:()=>e[i],enumerable:!(s=x(e,i))||s.enumerable});return r},N=r=>F(d({},"__esModule",{value:!0}),r),w={};C(w,{default:()=>z});l.exports=N(w);var a=(g(),k(c)),h=class extends a.Service{constructor(r,e){super(r,"vits",!0),this.config=e;for(let t of e.command)r.command(`${t.name} <content:text>`,t.description).action(async({session:s},i)=>i?/<.*\/>/gm.test(i)?"输入的内容不是纯文本。":await f(r,i,t,e.api_key):"内容未输入。")}static{y(this,"Main")}static inject={required:["http"]};async say(r){let{vits_service_speaker:e,api_key:t}=this.config;return await f(this.ctx,r.input,{reference_id:e},t)}};async function f(r,e,t,s){let i={text:e,format:"wav",reference_id:t.reference_id};try{let o=await r.http.post("https://api.fish.audio/v1/tts",i,{headers:{Authorization:`Bearer ${s}`}});return a.h.audio(o,"audio/wav")}catch(o){throw r.http.isError(o)&&o.response.data?.message?new Error(o.response.data.message):o}}y(f,"generate");(r=>{r.Config=a.Schema.object({api_key:a.Schema.string().description("Fish Audio [API 令牌密钥](https://fish.audio/zh-CN/go-api/)").required(),command:a.Schema.array(a.Schema.object({name:a.Schema.string().description("指令名").required(),description:a.Schema.string().description("指令的描述").default(""),reference_id:a.Schema.string().description("Fish Audio 参考标识，可从 Fish Audio 模型主页链接中取得，如 https://fish.audio/zh-CN/m/bcbb6d60721c44a489bc33dd59ce7cfc").required()})).description("指令列表").default([{name:"say",description:"语音生成（流萤）",reference_id:"bcbb6d60721c44a489bc33dd59ce7cfc"}]),vits_service_speaker:a.Schema.string().description("用于 VITS 服务的 Fish Audio 参考标识").default("bcbb6d60721c44a489bc33dd59ce7cfc")})})(h||(h={}));var z=h});export default M();
