var qe=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var st=Object.prototype.hasOwnProperty;var Oe=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var T=(e,r)=>()=>(e&&(r=e(e=0)),r);var _=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var ne=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ut(r))!st.call(e,i)&&i!==t&&qe(e,i,{get:()=>r[i],enumerable:!(n=ot(r,i))||n.enumerable});return e},O=(e,r,t)=>(ne(e,r,"default"),t&&ne(t,r,"default"));var U=e=>ne(qe({},"__esModule",{value:!0}),e);import{Buffer as p}from"https://registry.koishi.chat/modules/buffer/index.js";import g from"https://registry.koishi.chat/modules/process/index.js";var u=T(()=>{});var M={};import*as Hr from"https://registry.koishi.chat/modules/koishi/index.js";var L=T(()=>{u();O(M,Hr)});import ct from"https://registry.koishi.chat/modules/@cordiverse/path/index.js";var ie=_((Xr,ke)=>{u();ke.exports=ct});var D={};import*as Qr from"https://registry.koishi.chat/modules/@koishijs/plugin-console/index.js";var ae=T(()=>{u();O(D,Qr)});var oe=_(le=>{"use strict";u();Object.defineProperty(le,"__esModule",{value:!0});le.default=dt;var N,ft=new Uint8Array(16);function dt(){if(!N&&(N=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!N))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(ft)}});var Pe=_(V=>{"use strict";u();Object.defineProperty(V,"__esModule",{value:!0});V.default=void 0;var pt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;V.default=pt});var A=_(F=>{"use strict";u();Object.defineProperty(F,"__esModule",{value:!0});F.default=void 0;var gt=vt(Pe());function vt(e){return e&&e.__esModule?e:{default:e}}function _t(e){return typeof e=="string"&&gt.default.test(e)}var yt=_t;F.default=yt});var B=_(E=>{"use strict";u();Object.defineProperty(E,"__esModule",{value:!0});E.default=void 0;E.unsafeStringify=Me;var mt=ht(A());function ht(e){return e&&e.__esModule?e:{default:e}}var m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function Me(e,r=0){return m[e[r+0]]+m[e[r+1]]+m[e[r+2]]+m[e[r+3]]+"-"+m[e[r+4]]+m[e[r+5]]+"-"+m[e[r+6]]+m[e[r+7]]+"-"+m[e[r+8]]+m[e[r+9]]+"-"+m[e[r+10]]+m[e[r+11]]+m[e[r+12]]+m[e[r+13]]+m[e[r+14]]+m[e[r+15]]}function bt(e,r=0){let t=Me(e,r);if(!(0,mt.default)(t))throw TypeError("Stringified UUID is invalid");return t}var wt=bt;E.default=wt});var De=_(z=>{"use strict";u();Object.defineProperty(z,"__esModule",{value:!0});z.default=void 0;var $t=Ot(oe()),qt=B();function Ot(e){return e&&e.__esModule?e:{default:e}}var Se,ue,se=0,ce=0;function kt(e,r,t){let n=r&&t||0,i=r||new Array(16);e=e||{};let l=e.node||Se,a=e.clockseq!==void 0?e.clockseq:ue;if(l==null||a==null){let d=e.random||(e.rng||$t.default)();l==null&&(l=Se=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),a==null&&(a=ue=(d[6]<<8|d[7])&16383)}let s=e.msecs!==void 0?e.msecs:Date.now(),o=e.nsecs!==void 0?e.nsecs:ce+1,f=s-se+(o-ce)/1e4;if(f<0&&e.clockseq===void 0&&(a=a+1&16383),(f<0||s>se)&&e.nsecs===void 0&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");se=s,ce=o,ue=a,s+=122192928e5;let c=((s&268435455)*1e4+o)%4294967296;i[n++]=c>>>24&255,i[n++]=c>>>16&255,i[n++]=c>>>8&255,i[n++]=c&255;let y=s/4294967296*1e4&268435455;i[n++]=y>>>8&255,i[n++]=y&255,i[n++]=y>>>24&15|16,i[n++]=y>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(let d=0;d<6;++d)i[n+d]=l[d];return r||(0,qt.unsafeStringify)(i)}var Pt=kt;z.default=Pt});var fe=_(J=>{"use strict";u();Object.defineProperty(J,"__esModule",{value:!0});J.default=void 0;var Mt=St(A());function St(e){return e&&e.__esModule?e:{default:e}}function Dt(e){if(!(0,Mt.default)(e))throw TypeError("Invalid UUID");let r,t=new Uint8Array(16);return t[0]=(r=parseInt(e.slice(0,8),16))>>>24,t[1]=r>>>16&255,t[2]=r>>>8&255,t[3]=r&255,t[4]=(r=parseInt(e.slice(9,13),16))>>>8,t[5]=r&255,t[6]=(r=parseInt(e.slice(14,18),16))>>>8,t[7]=r&255,t[8]=(r=parseInt(e.slice(19,23),16))>>>8,t[9]=r&255,t[10]=(r=parseInt(e.slice(24,36),16))/1099511627776&255,t[11]=r/4294967296&255,t[12]=r>>>24&255,t[13]=r>>>16&255,t[14]=r>>>8&255,t[15]=r&255,t}var Rt=Dt;J.default=Rt});var de=_(R=>{"use strict";u();Object.defineProperty(R,"__esModule",{value:!0});R.URL=R.DNS=void 0;R.default=Bt;var Ut=B(),It=At(fe());function At(e){return e&&e.__esModule?e:{default:e}}function Et(e){e=unescape(encodeURIComponent(e));let r=[];for(let t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}var Re="6ba7b810-9dad-11d1-80b4-00c04fd430c8";R.DNS=Re;var Ue="6ba7b811-9dad-11d1-80b4-00c04fd430c8";R.URL=Ue;function Bt(e,r,t){function n(i,l,a,s){var o;if(typeof i=="string"&&(i=Et(i)),typeof l=="string"&&(l=(0,It.default)(l)),((o=l)===null||o===void 0?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+i.length);if(f.set(l),f.set(i,l.length),f=t(f),f[6]=f[6]&15|r,f[8]=f[8]&63|128,a){s=s||0;for(let c=0;c<16;++c)a[s+c]=f[c];return a}return(0,Ut.unsafeStringify)(f)}try{n.name=e}catch{}return n.DNS=Re,n.URL=Ue,n}});var Ae=_(H=>{"use strict";u();Object.defineProperty(H,"__esModule",{value:!0});H.default=void 0;function jt(e){if(typeof e=="string"){let r=unescape(encodeURIComponent(e));e=new Uint8Array(r.length);for(let t=0;t<r.length;++t)e[t]=r.charCodeAt(t)}return Ct(Tt(Lt(e),e.length*8))}function Ct(e){let r=[],t=e.length*32,n="0123456789abcdef";for(let i=0;i<t;i+=8){let l=e[i>>5]>>>i%32&255,a=parseInt(n.charAt(l>>>4&15)+n.charAt(l&15),16);r.push(a)}return r}function Ie(e){return(e+64>>>9<<4)+14+1}function Tt(e,r){e[r>>5]|=128<<r%32,e[Ie(r)-1]=r;let t=1732584193,n=-271733879,i=-1732584194,l=271733878;for(let a=0;a<e.length;a+=16){let s=t,o=n,f=i,c=l;t=h(t,n,i,l,e[a],7,-680876936),l=h(l,t,n,i,e[a+1],12,-389564586),i=h(i,l,t,n,e[a+2],17,606105819),n=h(n,i,l,t,e[a+3],22,-1044525330),t=h(t,n,i,l,e[a+4],7,-176418897),l=h(l,t,n,i,e[a+5],12,1200080426),i=h(i,l,t,n,e[a+6],17,-1473231341),n=h(n,i,l,t,e[a+7],22,-45705983),t=h(t,n,i,l,e[a+8],7,1770035416),l=h(l,t,n,i,e[a+9],12,-1958414417),i=h(i,l,t,n,e[a+10],17,-42063),n=h(n,i,l,t,e[a+11],22,-1990404162),t=h(t,n,i,l,e[a+12],7,1804603682),l=h(l,t,n,i,e[a+13],12,-40341101),i=h(i,l,t,n,e[a+14],17,-1502002290),n=h(n,i,l,t,e[a+15],22,1236535329),t=b(t,n,i,l,e[a+1],5,-165796510),l=b(l,t,n,i,e[a+6],9,-1069501632),i=b(i,l,t,n,e[a+11],14,643717713),n=b(n,i,l,t,e[a],20,-373897302),t=b(t,n,i,l,e[a+5],5,-701558691),l=b(l,t,n,i,e[a+10],9,38016083),i=b(i,l,t,n,e[a+15],14,-660478335),n=b(n,i,l,t,e[a+4],20,-405537848),t=b(t,n,i,l,e[a+9],5,568446438),l=b(l,t,n,i,e[a+14],9,-1019803690),i=b(i,l,t,n,e[a+3],14,-187363961),n=b(n,i,l,t,e[a+8],20,1163531501),t=b(t,n,i,l,e[a+13],5,-1444681467),l=b(l,t,n,i,e[a+2],9,-51403784),i=b(i,l,t,n,e[a+7],14,1735328473),n=b(n,i,l,t,e[a+12],20,-1926607734),t=w(t,n,i,l,e[a+5],4,-378558),l=w(l,t,n,i,e[a+8],11,-2022574463),i=w(i,l,t,n,e[a+11],16,1839030562),n=w(n,i,l,t,e[a+14],23,-35309556),t=w(t,n,i,l,e[a+1],4,-1530992060),l=w(l,t,n,i,e[a+4],11,1272893353),i=w(i,l,t,n,e[a+7],16,-155497632),n=w(n,i,l,t,e[a+10],23,-1094730640),t=w(t,n,i,l,e[a+13],4,681279174),l=w(l,t,n,i,e[a],11,-358537222),i=w(i,l,t,n,e[a+3],16,-722521979),n=w(n,i,l,t,e[a+6],23,76029189),t=w(t,n,i,l,e[a+9],4,-640364487),l=w(l,t,n,i,e[a+12],11,-421815835),i=w(i,l,t,n,e[a+15],16,530742520),n=w(n,i,l,t,e[a+2],23,-995338651),t=$(t,n,i,l,e[a],6,-198630844),l=$(l,t,n,i,e[a+7],10,1126891415),i=$(i,l,t,n,e[a+14],15,-1416354905),n=$(n,i,l,t,e[a+5],21,-57434055),t=$(t,n,i,l,e[a+12],6,1700485571),l=$(l,t,n,i,e[a+3],10,-1894986606),i=$(i,l,t,n,e[a+10],15,-1051523),n=$(n,i,l,t,e[a+1],21,-2054922799),t=$(t,n,i,l,e[a+8],6,1873313359),l=$(l,t,n,i,e[a+15],10,-30611744),i=$(i,l,t,n,e[a+6],15,-1560198380),n=$(n,i,l,t,e[a+13],21,1309151649),t=$(t,n,i,l,e[a+4],6,-145523070),l=$(l,t,n,i,e[a+11],10,-1120210379),i=$(i,l,t,n,e[a+2],15,718787259),n=$(n,i,l,t,e[a+9],21,-343485551),t=S(t,s),n=S(n,o),i=S(i,f),l=S(l,c)}return[t,n,i,l]}function Lt(e){if(e.length===0)return[];let r=e.length*8,t=new Uint32Array(Ie(r));for(let n=0;n<r;n+=8)t[n>>5]|=(e[n/8]&255)<<n%32;return t}function S(e,r){let t=(e&65535)+(r&65535);return(e>>16)+(r>>16)+(t>>16)<<16|t&65535}function Nt(e,r){return e<<r|e>>>32-r}function W(e,r,t,n,i,l){return S(Nt(S(S(r,e),S(n,l)),i),t)}function h(e,r,t,n,i,l,a){return W(r&t|~r&n,e,r,i,l,a)}function b(e,r,t,n,i,l,a){return W(r&n|t&~n,e,r,i,l,a)}function w(e,r,t,n,i,l,a){return W(r^t^n,e,r,i,l,a)}function $(e,r,t,n,i,l,a){return W(t^(r|~n),e,r,i,l,a)}var Vt=jt;H.default=Vt});var Be=_(K=>{"use strict";u();Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;var Ft=Ee(de()),zt=Ee(Ae());function Ee(e){return e&&e.__esModule?e:{default:e}}var Jt=(0,Ft.default)("v3",48,zt.default),Wt=Jt;K.default=Wt});var je=_(X=>{"use strict";u();Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var Ht=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Kt={randomUUID:Ht};X.default=Kt});var Le=_(Y=>{"use strict";u();Object.defineProperty(Y,"__esModule",{value:!0});Y.default=void 0;var Ce=Te(je()),Xt=Te(oe()),Yt=B();function Te(e){return e&&e.__esModule?e:{default:e}}function Gt(e,r,t){if(Ce.default.randomUUID&&!r&&!e)return Ce.default.randomUUID();e=e||{};let n=e.random||(e.rng||Xt.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,r){t=t||0;for(let i=0;i<16;++i)r[t+i]=n[i];return r}return(0,Yt.unsafeStringify)(n)}var Qt=Gt;Y.default=Qt});var Ne=_(G=>{"use strict";u();Object.defineProperty(G,"__esModule",{value:!0});G.default=void 0;function Zt(e,r,t,n){switch(e){case 0:return r&t^~r&n;case 1:return r^t^n;case 2:return r&t^r&n^t&n;case 3:return r^t^n}}function pe(e,r){return e<<r|e>>>32-r}function xt(e){let r=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){let a=unescape(encodeURIComponent(e));e=[];for(let s=0;s<a.length;++s)e.push(a.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=e.length/4+2,i=Math.ceil(n/16),l=new Array(i);for(let a=0;a<i;++a){let s=new Uint32Array(16);for(let o=0;o<16;++o)s[o]=e[a*64+o*4]<<24|e[a*64+o*4+1]<<16|e[a*64+o*4+2]<<8|e[a*64+o*4+3];l[a]=s}l[i-1][14]=(e.length-1)*8/Math.pow(2,32),l[i-1][14]=Math.floor(l[i-1][14]),l[i-1][15]=(e.length-1)*8&4294967295;for(let a=0;a<i;++a){let s=new Uint32Array(80);for(let v=0;v<16;++v)s[v]=l[a][v];for(let v=16;v<80;++v)s[v]=pe(s[v-3]^s[v-8]^s[v-14]^s[v-16],1);let o=t[0],f=t[1],c=t[2],y=t[3],d=t[4];for(let v=0;v<80;++v){let te=Math.floor(v/20),re=pe(o,5)+Zt(te,f,c,y)+d+r[te]+s[v]>>>0;d=y,y=c,c=pe(f,30)>>>0,f=o,o=re}t[0]=t[0]+o>>>0,t[1]=t[1]+f>>>0,t[2]=t[2]+c>>>0,t[3]=t[3]+y>>>0,t[4]=t[4]+d>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var er=xt;G.default=er});var Fe=_(Q=>{"use strict";u();Object.defineProperty(Q,"__esModule",{value:!0});Q.default=void 0;var tr=Ve(de()),rr=Ve(Ne());function Ve(e){return e&&e.__esModule?e:{default:e}}var nr=(0,tr.default)("v5",80,rr.default),ir=nr;Q.default=ir});var ze=_(Z=>{"use strict";u();Object.defineProperty(Z,"__esModule",{value:!0});Z.default=void 0;var ar="00000000-0000-0000-0000-000000000000";Z.default=ar});var Je=_(x=>{"use strict";u();Object.defineProperty(x,"__esModule",{value:!0});x.default=void 0;var lr=or(A());function or(e){return e&&e.__esModule?e:{default:e}}function ur(e){if(!(0,lr.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var sr=ur;x.default=sr});var ge=_(k=>{"use strict";u();Object.defineProperty(k,"__esModule",{value:!0});Object.defineProperty(k,"NIL",{enumerable:!0,get:function(){return gr.default}});Object.defineProperty(k,"parse",{enumerable:!0,get:function(){return mr.default}});Object.defineProperty(k,"stringify",{enumerable:!0,get:function(){return yr.default}});Object.defineProperty(k,"v1",{enumerable:!0,get:function(){return cr.default}});Object.defineProperty(k,"v3",{enumerable:!0,get:function(){return fr.default}});Object.defineProperty(k,"v4",{enumerable:!0,get:function(){return dr.default}});Object.defineProperty(k,"v5",{enumerable:!0,get:function(){return pr.default}});Object.defineProperty(k,"validate",{enumerable:!0,get:function(){return _r.default}});Object.defineProperty(k,"version",{enumerable:!0,get:function(){return vr.default}});var cr=P(De()),fr=P(Be()),dr=P(Le()),pr=P(Fe()),gr=P(ze()),vr=P(Je()),_r=P(A()),yr=P(B()),mr=P(fe());function P(e){return e&&e.__esModule?e:{default:e}}});var I={};import*as In from"https://registry.koishi.chat/modules/@cordiverse/fs/index.js";var We=T(()=>{u();O(I,In)});var Nr=_((An,lt)=>{u();var hr=Object.create,C=Object.defineProperty,br=Object.getOwnPropertyDescriptor,wr=Object.getOwnPropertyNames,$r=Object.getPrototypeOf,qr=Object.prototype.hasOwnProperty,q=(e,r)=>C(e,"name",{value:r,configurable:!0}),Or=(e,r)=>{for(var t in r)C(e,t,{get:r[t],enumerable:!0})},Ye=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of wr(r))!qr.call(e,i)&&i!==t&&C(e,i,{get:()=>r[i],enumerable:!(n=br(r,i))||n.enumerable});return e},Ge=(e,r,t)=>(t=e!=null?hr($r(e)):{},Ye(r||!e||!e.__esModule?C(t,"default",{value:e,enumerable:!0}):t,e)),kr=e=>Ye(C({},"__esModule",{value:!0}),e),Qe={};Or(Qe,{BlocklyProvider:()=>nt,BlocklyService:()=>rt,BlocklyVendorDataService:()=>it,Config:()=>Tr,PluginManager:()=>tt,apply:()=>at,esModuleToCommonJs:()=>he,initializeConsoleApiBacked:()=>we,initializeDatabase:()=>be,inject:()=>Lr,name:()=>Cr,registerStaticFileRoute:()=>$e,rewriteImport:()=>me});lt.exports=kr(Qe);var Pr=(L(),U(M)),He=ie(),Mr=(L(),U(M)),Sr=(L(),U(M)),Dr=/\/\*[^]*?\*\//g,Rr=/(\bdefault\s+)?\b(let|const|class|function(?:\s*\*)?)(\s+)(\*?\s*[$\w][$\w\s\d,.=]+)([^]*?)$/i,Ur=/(^|\s+)export(?!\w)\s*(\{[^{}]*?\}.*?(?=;\n?|$)|[^]*?(?=[\n;]|$))/gi,ve=/\bfrom\s+(["'])([^"']*)\1/gi,Ke=/\bdefault(\s+as\s+(\w+))?\b/i,j=/\b(\w+)\s+as\s+(\w+)\b/gi;function ee(e){return typeof e=="string"?ee(e.replace(/{|}/g,"").split(/\s*,\s*/).map(r=>r.trim())):e.reduce((r,t)=>r.concat(t.split(/\s*,\s*/).map(n=>n.trim())),[])}q(ee,"allVars");function Ze(e){return e.replace(/[{\s}]+/g,"").split(",").reduce((r,t)=>Object.assign(r,{[t.split(":")[0]]:t.split(":")[1]}),{})}q(Ze,"mapVars");function xe(e,r,t,n){return e=e||"module.exports",r=r||"require",t=t||"Object.assign",(i,l,a)=>{let s=`${l}${e}`;a=a.replace(Dr,c=>c.replace(/\S/g," "));let o=a.match(Rr);if(o){if(o[2]==="let"||o[2]==="const"){let c=o[4].split("=").filter(Boolean),y="";return c.length!==1&&(y=c[c.length-1],c=c.slice(0,c.length-1)),!o[4].includes("=")&&o[4].includes(",")?`${l}${a};${o[2]==="let"&&n?n("let",ee(c),null,e,r,t):`${t}(${e},{${c.join(",")}})`}`:(c[0].includes(",")&&(c=c[0].split(",")),`${l}${o[2]}${o[3]}${c.map(d=>`${d}=${e}.${d.trim()}`).join("=void 0,")}=${y}${o[5]}`)}(o[2]==="class"||o[2].includes("function"))&&(s=s.replace(l,`${l}const ${o[4].split(/[({\s]+/)[0].replace("*","")}=`)),o[1]||(s+=`.${o[4].trim().replace("*","")}`)}let f=a.match(Ke);if(a.match(ve)){let c=a.replace(j,"$2").replace(ve,"").replace(/\s+/g,""),y;a=a.replace(ve,(v,te,re)=>`=${r}("${y=re}")`),a=a.replace(j,"$1:$2");let d=a.split("=").pop().trim();return c==="*"?`${s}=${n?n("*",d,y,e,r,t):d}`:f?(f[2]&&(s+=`.${f[2]}`),`${s}=${n?n("default",d,y,e,r,t):d}`):`${l}const ${a};${n?n("const",ee(c),y,e,r,t):`${t}(${e},${c})`}`}return f?o||!a.match(j)?a=a.replace(Ke,"").trim():a=a.match(j)[0].split(" ").shift():a=a.replace(j,"$2:$1"),!f&&a.charAt()==="{"?a.includes("}")?`${l}${n?n("object",Ze(a),null,e,r,t):`${t}(${e},${a.replace(/\s+/g,"")})`}`:`${l}${e}=${a}`:`${s}=${a}`}}q(xe,"rewriteExportBuilder");var Ir=q((e,r,t,n,i)=>e.replace(Ur,xe(r,t,n,i)),"rewriteExport");function ye(e,r){for(var t=[];e.length;)t.push(e.shift().trim().replace(/ as /g,":"));return"const { "+t.join(", ")+" } = "+r}q(ye,"destruct");function et(e,r,t){return e.length&&!t?ye(e,r):"const "+t+" = "+r+(e.length?`;
`+ye(e,t):"")}q(et,"generate");function me(e,r){return r=r||"require",e.replace(/(^|;\s*|\r?\n+)import\s*((?:\*\s*as)?\s*([a-z$_][\w$]*)?\s*,?\s*(?:{([\s\S]*?)})?)?\s*(from)?\s*(['"`][^'"`]+['"`])(?=;?)(?=([^"'`]*["'`][^"'`]*["'`])*[^"'`]*$)/gi,function(t,n,i,l,a,s,o){return o=r+"("+o+")",(n||"")+(s?et(a?a.split(","):[],o,l):o)})}q(me,"rewriteImport");function he(e){return me(Ir(e))}q(he,"esModuleToCommonJs");var tt=class{constructor(e){this.ctx=e,this.restart(),this.logger=this.ctx.logger("blockly")}static{q(this,"PluginManager")}plugins=[];runningPlugins=[];logger;restart(){if(this.runningPlugins.forEach(e=>e.dispose()),this.runningPlugins=[],this.plugins.length==0){this.logger?.info("No plugin loaded");return}this.logger.info("Loading "+this.plugins.length+" plugin(s)"),this.plugins.forEach(e=>{let r={};r.module={exports:{}},r.require=Oe,r.segment=Sr.segment;let t=null;try{let n=`const {${Object.keys(r).join(",")}} = this;${he(e)}`;new Function(n).call(r),t=r.module.exports}catch(n){this.ctx.logger("blockly").warn(n)}t&&t.apply&&this.runningPlugins.push(this.ctx.plugin(t))}),this.logger.info("Loaded "+this.runningPlugins.length+" plugin(s)")}},rt=class extends Mr.Service{static{q(this,"BlocklyService")}manager;vendors={};constructor(e){super(e,"blockly"),this.manager=new tt(e)}async reload(e){e&&(this.manager.plugins=(await this.ctx.database.get("blockly",{enabled:!0},["code","enabled"])).filter(r=>r.enabled).map(r=>r.code),this.manager.restart()),this.ctx["console.blockly"]&&await this.ctx["console.blockly"].refresh()}async registerVendor(e){this.vendors[e.id]=e,this.ctx["console.blockly_console"]&&await this.ctx["console.blockly_console"].patch(Object.fromEntries([[e.id,e]]))}},Ar=(ae(),U(D)),Er=ge(),nt=class extends Ar.DataService{static{q(this,"BlocklyProvider")}constructor(e){super(e,"blockly")}async get(){return await this.ctx.database.get("blockly",{id:{$not:-1}},["id","name","enabled","edited","uuid"])}};async function be(e){e.database.extend("blockly",{id:"integer",name:"string",body:"text",code:"text",enabled:"boolean",edited:"boolean",uuid:"string"},{autoInc:!0});let r=await e.database.get("blockly",{id:{$not:-1}}),t=e.logger("blockly");for(let n of r)if(!n.uuid){let i=(0,Er.v4)();t.info(`block ${n.id} has no uuid ->  ${i}`),await e.database.set("blockly",n.id,{uuid:i})}}q(be,"initializeDatabase");var Br=ge();function we(e){e.console.addListener("load-blockly-block",async r=>JSON.parse((await e.database.get("blockly",r,["body"]))[0].body),{authority:5}),e.console.addListener("save-blockly-block",async(r,t)=>{let n={};t.body&&(n.body=JSON.stringify(t.body)),t.code&&(n.code=t.code),t.name&&(n.name=t.name),n.edited=!t.code,await e.database.set("blockly",r,n),setTimeout(()=>e.blockly.reload(!!t.code),0)},{authority:5}),e.console.addListener("rename-blockly-block",async(r,t)=>{await e.database.set("blockly",r,{name:t}),await e.blockly.reload()},{authority:5}),e.console.addListener("rename-blockly-block",async(r,t)=>{await e.database.set("blockly",r,{name:t}),await e.blockly.reload()},{authority:5}),e.console.addListener("delete-blockly-block",async r=>{await e.database.remove("blockly",{id:r}),await e.blockly.reload()},{authority:5}),e.console.addListener("create-blockly-block",async r=>{if(r){let n=await e.database.get("blockly",{uuid:r},["id"]);if(n.length>0)return n[0].id}let t=await e.database.create("blockly",{name:"未命名Koishi代码",code:"",body:"{}",enabled:!1,edited:!1,uuid:r??(0,Br.v4)()});return await e.blockly.reload(),t.id},{authority:5}),e.console.addListener("set-blockly-block-state",async(r,t)=>{await e.database.set("blockly",r,{enabled:t}),await e.blockly.reload(!0)},{authority:5})}q(we,"initializeConsoleApiBacked");var _e=Ge(ie()),Xe=Ge((We(),U(I)));function $e(e){e.server.get(/\/static\/blockly\/([a-z0-9-]+.[a-z0-9]+)/,async function(r){let t=_e.default.resolve(import.meta.url,"../media/"+r.params[0]);_e.default.relative(_e.default.resolve(import.meta.url+"/../"),t).startsWith("..")||Xe.default.existsSync(t)&&(r.body=await Xe.default.promises.readFile(t))})}q($e,"registerStaticFileRoute");var jr=(ae(),U(D)),it=class extends jr.DataService{static{q(this,"BlocklyVendorDataService")}constructor(e){super(e,"blockly_vendors")}async get(){return this.ctx.blockly.vendors}},Cr="blockly",Tr=Pr.Schema.object({}),Lr={optional:["blockly","console.blockly","puppeteer"],required:["database","console","server"]};async function at(e){e.plugin(rt),e.plugin(nt),e.inject(["blockly"],()=>e.plugin(it)),await be(e),e.inject(["console","blockly","server"],r=>{r.console.addEntry({dev:(0,He.resolve)(import.meta.url,"../client/index.ts"),prod:(0,He.resolve)(import.meta.url,"../dist")}),r.blockly.reload(!0)}),we(e),$e(e)}q(at,"apply")});export default Nr();
