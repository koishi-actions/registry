var k=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(t&&(e=t(t=0)),e);var E=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var y=(t,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of _(e))!N.call(t,c)&&c!==s&&k(t,c,{get:()=>e[c],enumerable:!(o=S(e,c))||o.enumerable});return t},n=(t,e,s)=>(y(t,e,"default"),s&&y(s,e,"default"));var C=t=>y(k({},"__esModule",{value:!0}),t);import{Buffer as j}from"https://registry.koishi.chat/modules/buffer/index.js";import x from"https://registry.koishi.chat/modules/process/index.js";var p=b(()=>{});var h={};import*as H from"https://registry.koishi.chat/modules/@satorijs/element/jsx-runtime/index.js";var B=b(()=>{p();n(h,H)});var d={};import*as L from"https://registry.koishi.chat/modules/koishi/index.js";var w=b(()=>{p();n(d,L)});var $=E((R,Q)=>{Q.exports={name:"koishi-plugin-music",description:"Share Music in Koishi",version:"2.2.2",main:"lib/index.js",typings:"lib/index.d.ts",files:["lib","dist"],author:"Shigma <shigma10826@gmail.com>",license:"MIT",repository:{type:"git",url:"git+https://github.com/koishijs/koishi-plugin-music.git"},bugs:{url:"https://github.com/koishijs/koishi-plugin-music/issues"},homepage:"https://github.com/koishijs/koishi-plugin-music",scripts:{build:"tsc -b"},keywords:["chatbot","koishi","plugin","music","share","search","netease","qq"],koishi:{browser:!0,description:{en:"Share music (supports QQ Music and Netease Cloud Music)",zh:"分享音乐（目前支持 QQ 音乐和网易云音乐）"},service:{optional:["puppeteer"]}},peerDependencies:{koishi:"^4.10.3","koishi-plugin-puppeteer":"^3.4.11"},peerDependenciesMeta:{"koishi-plugin-puppeteer":{optional:!0}},devDependencies:{"@types/node":"^18.16.13",koishi:"^4.13.0",typescript:"^4.9.5"}}});var W=E(a=>{p();Object.defineProperty(a,"__esModule",{value:!0});a.apply=a.name=a.Config=void 0;var i=(B(),C(h)),l=(w(),C(d)),{version:K}=$();a.Config=l.Schema.object({platform:l.Schema.union(["netease","qq"]).default("qq").description("默认的点歌平台。"),imageMode:l.Schema.boolean().default(!0).description("是否使用图片模式 (需要 puppeteer 服务)。"),showWarning:l.Schema.boolean().default(!1).description("点歌失败时是否发送提示。")});var v={async netease(t){let e=await this.http.get("http://music.163.com/api/cloudsearch/pc",{params:{s:t,type:1,offset:0,limit:5}});if(!(e.code!==200||e.result.songCount===0))return e.result.songs.map(s=>({type:"163",id:s.id,name:s.name,artist:s.ar.map(o=>o.name).join("/"),url:`https://music.163.com/#/song?id=${s.id}`,album:s.al.name}))},async qq(t){let e=await this.http.get("https://c.y.qq.com/splcloud/fcgi-bin/smartbox_new.fcg",{params:{key:t,format:"json"}});if(!(e.code||e.data.song.count===0))return e.data.song.itemlist.map(s=>({type:"qq",id:s.id,name:s.name,artist:s.singer,url:`https://y.qq.com/n/ryqq/songDetail/${s.mid}`,album:""}))}};a.name="music";function O(t,e){let{showWarning:s,platform:o,imageMode:c}=e;function D(f){return c&&t.puppeteer?(0,i.jsxs)("html",{style:{color:"#ffffff",background:"#333333",padding:"1rem"},children:[(0,i.jsx)("style",{children:`
          th, td {
            padding: 0.25rem 0.5rem;
          }
          .index, .title {
            text-align: center;
          }
        `}),(0,i.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),(0,i.jsxs)("table",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{class:"index",children:"编号"}),(0,i.jsx)("th",{class:"title",children:"名称"}),(0,i.jsx)("th",{children:"歌手"})]}),f.map((u,m)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:m+1}),(0,i.jsx)("td",{children:u.name}),(0,i.jsx)("td",{children:u.artist})]}))]}),(0,i.jsxs)("p",{children:["Generated by Koishi v",l.version," / koishi-plugin-music v",K]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"我们找到了多个可能符合条件的歌曲，请输入序号进行选择："}),f.map((u,m)=>(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("p",{children:[m+1,". ",u.name," ",u.artist," ",u.album]})}))]})}t.command("music <name:text>","点歌").option("platform",`-p <platform>  点歌平台，目前支持 qq, netease，默认为 ${o}`,{type:Object.keys(v)}).alias("点歌").shortcut("来一首",{fuzzy:!0}).shortcut("点一首",{fuzzy:!0}).shortcut("整一首",{fuzzy:!0}).action(async({session:f,options:u},m)=>{u.platform||(u.platform=o);let q=v[u.platform];if(!q)return`目前不支持平台 ${u.platform}。`;if(!m)return"请输入歌曲相关信息。";try{let r=await q.call(t,m);if(Array.isArray(r)&&r.length>0){if(r.length>1){await f.send(D(r));let F=await f.prompt();if(!F||Number.isNaN(+F))return"请输入正确的序号。";let g=+F-1;return r[g]?(0,l.segment)("onebot:music",r[g],`${r[g].name}
${r[g].artist}
${r[g].url}`):"请输入正确的序号。"}let{name:A,artist:M,url:z}=r[0];return(0,l.segment)("onebot:music",r[0],`${A}
${M}
${z}`)}}catch{}if(s)return"点歌失败，请尝试更换平台。"})}a.apply=O});export default W();
