var q=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var $=(e,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of O(t))!P.call(e,r)&&r!==i&&q(e,r,{get:()=>t[r],enumerable:!(s=N(t,r))||s.enumerable});return e},c=(e,t,i)=>($(e,t,"default"),i&&$(i,t,"default"));var v=e=>$(q({},"__esModule",{value:!0}),e);import{Buffer as g}from"https://registry.koishi.chat/modules/buffer/index.js";import f from"https://registry.koishi.chat/modules/process/index.js";var n=k(()=>{});var d={};import*as ie from"https://registry.koishi.chat/modules/@satorijs/element/jsx-runtime/index.js";var S=k(()=>{n();c(d,ie)});var _={};import*as se from"https://registry.koishi.chat/modules/koishi/index.js";var U=k(()=>{n();c(_,se)});var I=b(m=>{"use strict";n();Object.defineProperty(m,"__esModule",{value:!0});m.getImgUrl=m.msg=m.div_items=void 0;var C=(S(),v(d)),F=e=>{let t=[];for(var i in e){var s=e[i].location,r=`transform: rotate(${s.rotation}deg);position: absolute;font-size: 10px;width: ${s.width}px;height: ${s.height}px;left: ${s.left}px;top: ${s.top}px;rotation: ${s.rotation}deg;background: transparent;border: 5px solid green`;t.push(r)}return t.map((o,y)=>(0,C.jsxs)("div",{style:o,children:["face",y]}))};m.div_items=F;var G=e=>{let t=[];for(var i in e){var s=e[i].gender,r=e[i].beauty;t.push(`第${i}张脸,颜值:${r} 性别:${s.type}｜概率:${s.probability}`)}return t.map((o,y)=>(0,C.jsx)("p",{children:o}))};m.msg=G;function H(e){let t;for(var i of e)if(i.type==="img"){t=i.attrs.src;break}return t}m.getImgUrl=H});var h={};import*as pe from"https://registry.koishi.chat/modules/@cordiverse/fs/index.js";var T=k(()=>{n();c(h,pe)});import D from"https://registry.koishi.chat/modules/@cordiverse/path/index.js";var z=b((ue,M)=>{n();M.exports=D});var A=b((de,J)=>{J.exports={commands:{facercg:{description:"人脸识别,百度api",messages:{noimg:"请发送图片",running:"正在预测",noface:"未从图片中发现人脸"}}}}});var X=b(a=>{n();Object.defineProperty(a,"__esModule",{value:!0});a.apply=a.get_access_token=a.Config=a.logger=a.usage=a.inject=a.name=void 0;var E=(S(),v(d)),u=(U(),v(_)),x=I(),Q=(T(),v(h)),R=z();a.name="facercg";a.inject={required:["http"],optional:["puppeteer","notifier"]};var w={headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64); AppleWebKit/537.36 (KHTML, like Gecko); Chrome/54.0.2840.99 Safari/537.36"}},W={image_type:"BASE64",face_field:"gender,beauty",max_face_num:120};a.usage=(0,Q.readFileSync)((0,R.resolve)(import.meta.url,"../readme.md")).toString("utf-8").split("更新日志")[0];a.logger=new u.Logger(a.name);a.Config=u.Schema.object({key:u.Schema.string().description("api_key").required(),secret_key:u.Schema.string().description("secret_key").required(),authority:u.Schema.number().description("允许使用的最低权限").default(3),usage:u.Schema.number().description("每人每日可用次数").default(10),cmd:u.Schema.string().description("触发命令").default("face")});async function j(e,t){return await(await e.http.axios(`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${t.key}&&client_secret=${t.secret_key}`,w)).data.access_token}a.get_access_token=j;async function V(e,t){let i;if(!i)if(e.notifier){let r=e.notifier.create({type:"success"}),p=e.notifier.create({type:"warning"});try{i=await j(e,t),r.update("token 获取成功"),setTimeout(()=>{r.dispose()},3e4)}catch(o){p.update(o.toString()),setTimeout(()=>{p.dispose()},3e4)}}else i=await j(e,t);let s="https://aip.baidubce.com/rest/2.0/face/v3/detect";e.i18n.define("zh",A()),e.command("facercg <prompt:text>",{authority:t.authority,maxUsage:t.usage,usageName:"face"}).alias(t.cmd).action(async({session:r})=>{let p=(0,x.getImgUrl)(r.elements);if(!p){r.send(r.text(".noimg"));let l=await r.prompt(6e4);if(p=(0,x.getImgUrl)(u.Element.parse(l)),!p)return"请重新触发指令！"}r.send(r.text(".running"));let o;try{let l=await e.http.get(p,{responseType:"arraybuffer",headers:w}),L=g.from(l).toString("base64");W.image=L,o=await e.http.post(`${s}?access_token=${i}`,W,w)}catch(l){return a.logger.error(l),String(l)}if(o.error_msg=="pic not has face")return r.text(".noface");if(o.error_msg!="SUCCESS")return a.logger.warn(`错误信息: ${o.error_msg}`),`错误信息: ${o.error_msg}`;let y=o.result.face_list,B=(0,x.div_items)(y),K=(0,x.msg)(y);if(r.send(K),e.puppeteer)return(0,E.jsxs)("html",{children:[(0,E.jsx)("img",{src:p}),B]})})}a.apply=V});export default X();
